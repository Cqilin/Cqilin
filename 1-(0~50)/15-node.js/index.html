<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|Amita:300,300italic,400,400italic,700,700italic|Montserrat:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-loading-bar.min.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cqilin.gitee.io","root":"/","scheme":"Gemini","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"path":"search.xml"};
  </script>

  <meta name="description" content="1. Node.js 基础">
<meta property="og:type" content="article">
<meta property="og:title" content="15-node.js">
<meta property="og:url" content="https://cqilin.gitee.io/1-(0~50)/15-node.js/index.html">
<meta property="og:site_name" content="qilin&#39;s blog">
<meta property="og:description" content="1. Node.js 基础">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/1.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/2.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/5.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/3.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/4.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/6.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/7.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/8.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/9.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/10.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/11.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/12.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/13.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/14.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/15.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/16.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/17.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/20.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/21.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/22.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/23.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/24.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/25.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/55.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/19.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/56.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/26.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/27.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/28.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/53.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/29.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/54.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/30.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/31.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/33.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/32.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/34.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/35.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/36.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/37.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/38.jpg">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/39.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/40.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/42.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/41.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/43.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/44.png">
<meta property="article:published_time" content="2020-08-22T10:11:30.000Z">
<meta property="article:modified_time" content="2021-05-23T15:58:52.910Z">
<meta property="article:author" content="qilin">
<meta property="article:tag" content="node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cqilin.gitee.io/img/15/1.png">

<link rel="canonical" href="https://cqilin.gitee.io/1-(0~50)/15-node.js/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>15-node.js | qilin's blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">qilin's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">web学习笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于我</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">23</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">9</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">50</span></a>

  </li>
        <li class="menu-item menu-item-guestbook">

    <a href="/guestbook/" rel="section"><i class="fa fa-comment fa-fw"></i>留言</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Node-js-%E5%9F%BA%E7%A1%80"><span class="nav-text">1. Node.js 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-Node%E5%BC%80%E5%8F%91%E6%A6%82%E8%BF%B0"><span class="nav-text">1.1 Node开发概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80"><span class="nav-text">1. 为什么要学习服务器端开发基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E8%A6%81%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85"><span class="nav-text">2. 服务器端开发要做的事情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9Node"><span class="nav-text">3. 为什么选择Node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Node%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">4. Node是什么</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Node%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-text">1.2 Node运行环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Node-js%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="nav-text">1. Node.js运行环境安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%8A%A5%E9%94%99"><span class="nav-text">2. 报错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="nav-text">3. 命令行工具</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-Node-js%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="nav-text">1.3 Node.js快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%BB%84%E6%88%90"><span class="nav-text">1. 组成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Node-js%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-text">2. Node.js基础语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Node-js%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1global-1"><span class="nav-text">3. Node.js全局对象global[^1]</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E5%8F%8A%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85"><span class="nav-text">2. 模块加载及第三方包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-Node-js%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91"><span class="nav-text">2.1 Node.js模块化开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-JavaScript%E5%BC%80%E5%8F%91%E5%BC%8A%E7%AB%AF"><span class="nav-text">1. JavaScript开发弊端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%94%9F%E6%B4%BB%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91"><span class="nav-text">2. 生活中的模块化开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%BD%AF%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91"><span class="nav-text">3. 软件中的模块化开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Node-js%E4%B8%AD%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83"><span class="nav-text">4. Node.js中模块化开发规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%A8%A1%E5%9D%97%E6%88%90%E5%91%98%E5%AF%BC%E5%87%BA"><span class="nav-text">5. 模块成员导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%A8%A1%E5%9D%97%E6%88%90%E5%91%98%E5%AF%BC%E5%85%A5"><span class="nav-text">6. 模块成员导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E6%A8%A1%E5%9D%97%E6%88%90%E5%91%98%E5%AF%BC%E5%87%BA%E7%9A%84%E5%8F%A6%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-text">7. 模块成员导出的另一种方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97"><span class="nav-text">2.2 系统模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97"><span class="nav-text">1. 什么是系统模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97fs-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">2. 系统模块fs 文件操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="nav-text">2. 读取文件内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%86%99%E5%85%A5%E5%86%85%E5%AE%B9"><span class="nav-text">3. 写入内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97path-%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C"><span class="nav-text">3. 系统模块path 路径操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E8%B7%AF%E5%BE%84%E6%8B%BC%E6%8E%A5%E8%AF%AD%E6%B3%95"><span class="nav-text">3.1 路径拼接语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84VS%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84"><span class="nav-text">3.2 相对路径VS绝对路径</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97"><span class="nav-text">2.3 第三方模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97"><span class="nav-text">1. 什么是第三方模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97%E6%9C%89%E4%B8%A4%E7%A7%8D%E5%AD%98%E5%9C%A8%E5%BD%A2%E5%BC%8F%EF%BC%9A"><span class="nav-text">1.1 第三方模块有两种存在形式：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%8E%B7%E5%8F%96%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97"><span class="nav-text">2. 获取第三方模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97-nodemon"><span class="nav-text">3. 第三方模块 nodemon</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97-nrm"><span class="nav-text">4. 第三方模块 nrm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97-Gulp"><span class="nav-text">5. 第三方模块 Gulp</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-Gulp%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88"><span class="nav-text">5.1 Gulp能做什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-%E4%BD%BF%E7%94%A8"><span class="nav-text">5.2 使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-gulp%E6%8F%90%E4%BE%9B%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-text">5.3 gulp提供的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%8A%BD%E5%8F%96%E5%85%AC%E5%85%B1%E4%BB%A3%E7%A0%81"><span class="nav-text">3. 抽取公共代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-CSS%E4%BB%BB%E5%8A%A1"><span class="nav-text">4. CSS任务</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-pipe"><span class="nav-text">3. pipe</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E7%BC%96%E5%86%99JS%E4%BB%BB%E5%8A%A1"><span class="nav-text">4. 编写JS任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%8B%B7%E8%B4%9D%E4%BB%BB%E5%8A%A1"><span class="nav-text">5. 拷贝任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E6%9E%84%E5%BB%BA%E4%BB%BB%E5%8A%A1"><span class="nav-text">6. 构建任务</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-package-json%E6%96%87%E4%BB%B6"><span class="nav-text">2.4 package.json文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-node-modules%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">1. node_modules文件夹的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-package-json%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">2. package.json文件的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96"><span class="nav-text">3. 项目依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%BC%80%E5%8F%91%E4%BE%9D%E8%B5%96"><span class="nav-text">4. 开发依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-package-lock-json%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">5. package-lock.json文件的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-scripts-%E5%88%AB%E5%90%8D"><span class="nav-text">6. scripts 别名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-Node-js%E4%B8%AD%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="nav-text">2.5 Node.js中模块的加载机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%A8%A1%E5%9D%97%E6%9F%A5%E6%89%BE%E8%A7%84%E5%88%99"><span class="nav-text">1. 模块查找规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%A8%A1%E5%9D%97%E6%9F%A5%E6%89%BE%E8%A7%84%E5%88%99-%E5%BD%93%E6%A8%A1%E5%9D%97%E6%B2%A1%E6%9C%89%E8%B7%AF%E5%BE%84%E4%B8%94%E6%B2%A1%E6%9C%89%E5%90%8E%E7%BC%80%E6%97%B6"><span class="nav-text">2. 模块查找规则-当模块没有路径且没有后缀时</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%90%8C%E7%BA%A7%E6%89%BE%E4%B8%8D%E5%88%B0"><span class="nav-text">3. 同级找不到</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-node%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1global"><span class="nav-text">2.6 node全局对象global</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%8E%9F%E7%90%86%E5%8F%8AHTTP%E5%8D%8F%E8%AE%AE"><span class="nav-text">3. 请求响应原理及HTTP协议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-0-B-S%E7%BB%93%E6%9E%84"><span class="nav-text">3.0 B&#x2F;S结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">3.1 服务器端基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%BD%91%E7%AB%99%E7%9A%84%E7%BB%84%E6%88%90"><span class="nav-text">1. 网站的组成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Node%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">2. Node网站服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-IP%E5%9C%B0%E5%9D%80"><span class="nav-text">3. IP地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%9F%9F%E5%90%8D"><span class="nav-text">4. 域名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E7%AB%AF%E5%8F%A3"><span class="nav-text">5. 端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-URL"><span class="nav-text">6. URL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-URL%E7%9A%84%E7%BB%84%E6%88%90"><span class="nav-text">6.2 URL的组成</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B4%E6%98%8E"><span class="nav-text">7. 开发过程中客户端和服务器端说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%88%9B%E5%BB%BAweb%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">3.2 创建web服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-HTTP%E5%8D%8F%E8%AE%AE"><span class="nav-text">3.3 HTTP协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-HTTP%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">1. HTTP协议的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%8A%A5%E6%96%87"><span class="nav-text">2. 报文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87"><span class="nav-text">3. 请求报文</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-req-on"><span class="nav-text">3.2 req.on</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-req-url%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80"><span class="nav-text">4. req.url请求地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-res-end%E6%8A%A5%E9%94%99"><span class="nav-text">5. res.end报错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87"><span class="nav-text">6. 响应报文</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-%E4%B9%B1%E7%A0%81"><span class="nav-text">6.2 乱码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-HTTP%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86"><span class="nav-text">3.4 HTTP请求与响应处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="nav-text">1. 请求参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-GET%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="nav-text">2. GET请求参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-url-parse"><span class="nav-text">2.1 url.parse</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-url-query"><span class="nav-text">1.url.query</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%BC%83%E7%94%A8%E4%BA%86%E6%80%8E%E5%8A%9E"><span class="nav-text">2. 弃用了怎办</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-pathname"><span class="nav-text">2.2 pathname</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-POST%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="nav-text">3. POST请求参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E9%9D%99%E6%80%81%E8%B5%84"><span class="nav-text">5. 静态资</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-%E5%88%9B%E5%BB%BA"><span class="nav-text">5.1 创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-%E7%BB%A7%E7%BB%AD%E5%AE%8C%E5%96%84"><span class="nav-text">5.2 继续完善</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E8%AE%A9localhost-%E7%AB%AF%E5%8F%A3%E5%8F%B7%E3%80%82%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE%E6%9F%90%E4%B8%AA%E9%A1%B5%E9%9D%A2%EF%BC%9B"><span class="nav-text">1. 让localhost:端口号。直接访问某个页面；</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87"><span class="nav-text">2.添加响应报文</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#2-4-%E4%BD%BF%E7%94%A8MIME"><span class="nav-text">2.4 使用MIME</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90"><span class="nav-text">6. 动态资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E8%B7%AF%E7%94%B1"><span class="nav-text">7. 路由</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-%E5%AE%9E%E7%8E%B0%E8%B7%AF%E7%94%B1%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="nav-text">7.1 实现路由的核心代码</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E7%BB%83%E4%B9%A0"><span class="nav-text">3.练习</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-Node-js%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="nav-text">8. Node.js异步编程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-%E5%90%8C%E6%AD%A5API-%E5%BC%82%E6%AD%A5API"><span class="nav-text">8.1 同步API, 异步API</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%90%8C%E6%AD%A5API%EF%BC%9A"><span class="nav-text">1.同步API：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%BC%82%E6%AD%A5API%EF%BC%9A"><span class="nav-text">2.异步API：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-%E8%8E%B7%E5%8F%96%E8%BF%94%E5%9B%9E%E5%80%BC%E5%8C%BA%E5%88%AB"><span class="nav-text">8.2 获取返回值区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="nav-text">8.3 回调函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-%E4%BD%BF%E7%94%A8%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E8%8E%B7%E5%8F%96%E5%BC%82%E6%AD%A5API%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="nav-text">8.4 使用回调函数获取异步API执行结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E5%8C%BA%E5%88%AB"><span class="nav-text">8.5 代码执行顺序区别</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E5%88%86%E6%9E%90"><span class="nav-text">1. 代码执行顺序分析</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-6-Node-js%E4%B8%AD%E7%9A%84%E5%BC%82%E6%AD%A5API"><span class="nav-text">8.6 Node.js中的异步API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-7-%E5%BC%82%E6%AD%A5%E5%9C%B0%E7%8B%B1"><span class="nav-text">8.7. 异步地狱</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-Promise"><span class="nav-text">1. Promise</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%A7%A3%E5%86%B3%E5%9C%B0%E7%8B%B1"><span class="nav-text">2. 解决地狱</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-8-%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0"><span class="nav-text">8.8 异步函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-15-async%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">2.15 async关键字</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-await%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">4.await关键字</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-%E5%BA%94%E7%94%A8"><span class="nav-text">5. 应用</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">4. 数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0%E5%8F%8A%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-text">4.1 数据库概述及环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">1. 为什么要使用数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">2. 什么是数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="nav-text">3. MongoDB数据库下载安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-MongoDB%E5%8F%AF%E8%A7%86%E5%8C%96%E8%BD%AF%E4%BB%B6"><span class="nav-text">4. MongoDB可视化软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="nav-text">5. 数据库相关概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Mongoose%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85"><span class="nav-text">6. Mongoose第三方包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%90%AF%E5%8A%A8MongoDB"><span class="nav-text">7. 启动MongoDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="nav-text">8. 数据库连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">9. 创建数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-MongoDB%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%93%8D%E4%BD%9C"><span class="nav-text">4.2 MongoDB增删改查操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E9%9B%86%E5%90%88"><span class="nav-text">1. 创建集合</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-mongoose-model"><span class="nav-text">2.mongoose.model</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3%E2%80%93%E5%A2%9E"><span class="nav-text">2. 创建文档–增</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-mongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-text">3. mongoDB数据库导入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="nav-text">4. 查询文档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-find-%E6%96%B9%E6%B3%95"><span class="nav-text">4.1 .find()方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-findOne%E6%96%B9%E6%B3%95"><span class="nav-text">4.2 findOne方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-%E5%A4%A7%E4%BA%8E%E5%B0%8F%E4%BA%8E"><span class="nav-text">4.3 大于小于</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-%E5%8C%B9%E9%85%8D%E5%8C%85%E5%90%AB"><span class="nav-text">4.4 匹配包含</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-%E9%80%89%E6%8B%A9%E8%A6%81%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="nav-text">4.5 选择要查询的字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6-%E5%B0%86%E6%95%B0%E6%8D%AE%E6%8C%89%E7%85%A7%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F"><span class="nav-text">4.6 将数据按照年龄进行排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-7-%E8%B7%B3%E8%BF%87%E4%B8%8E%E9%99%90%E5%88%B6"><span class="nav-text">4.7 跳过与限制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="nav-text">5. 删除文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="nav-text">6. 更新文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-mongoose%E9%AA%8C%E8%AF%81"><span class="nav-text">7. mongoose验证</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-required-true-%E5%BF%85%E4%BC%A0%E5%AD%97%E6%AE%B5"><span class="nav-text">7.1 required: true 必传字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-%E9%95%BF%E5%BA%A6"><span class="nav-text">7.2 长度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-%E6%95%B0%E5%80%BC"><span class="nav-text">7.3 数值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-default-%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="nav-text">7.4 default: 默认值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-5-%E6%9E%9A%E4%B8%BE"><span class="nav-text">7.5 枚举</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-6-validate-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="nav-text">7.6 validate: 自定义验证器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E8%8E%B7%E5%8F%96%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF"><span class="nav-text">8. 获取报错信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-%E7%9B%B4%E6%8E%A5-catch"><span class="nav-text">8.1 直接.catch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-%E8%8E%B7%E5%8F%96errors%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%80%BC"><span class="nav-text">8.2 获取errors对象的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-%E8%8E%B7%E5%8F%96%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="nav-text">8.3 获取错误信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E9%9B%86%E5%90%88%E5%85%B3%E8%81%94"><span class="nav-text">9. 集合关联</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-2-%E4%BB%A3%E7%A0%81%E9%AA%8C%E8%AF%81"><span class="nav-text">9.2 代码验证</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#X-%E9%A2%98%E6%B3%A8"><span class="nav-text">X. 题注</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AB%E5%B0%BE"><span class="nav-text">末尾</span></a></li></ol></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="qilin"
      src="/images/7.jpg">
  <p class="site-author-name" itemprop="name">qilin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://cqilin.gitee.io/1-(0~50)/15-node.js/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/7.jpg">
      <meta itemprop="name" content="qilin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qilin's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          15-node.js
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-22 18:11:30" itemprop="dateCreated datePublished" datetime="2020-08-22T18:11:30+08:00">2020-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-23 23:58:52" itemprop="dateModified" datetime="2021-05-23T23:58:52+08:00">2021-05-23</time>
              </span>

          
            <span id="/1-(0~50)/15-node.js/" class="post-meta-item leancloud_visitors" data-flag-title="15-node.js" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/1-(0~50)/15-node.js/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/1-(0~50)/15-node.js/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>106k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:36</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="1-Node-js-基础"><a href="#1-Node-js-基础" class="headerlink" title="1. Node.js 基础"></a>1. Node.js 基础</h1><a id="more"></a>

<h2 id="1-1-Node开发概述"><a href="#1-1-Node开发概述" class="headerlink" title="1.1 Node开发概述"></a>1.1 Node开发概述</h2><h3 id="1-为什么要学习服务器端开发基础"><a href="#1-为什么要学习服务器端开发基础" class="headerlink" title="1. 为什么要学习服务器端开发基础"></a>1. 为什么要学习服务器端开发基础</h3><p>1.能够和后端程序员更加紧密的配合</p>
<p>2.网站业务逻辑前置，学习前端技术需要后端技术支撑（Ajax）</p>
<p>3.扩宽知识视野，能够站在更高的角度审视整个项目</p>
<h3 id="2-服务器端开发要做的事情"><a href="#2-服务器端开发要做的事情" class="headerlink" title="2. 服务器端开发要做的事情"></a>2. 服务器端开发要做的事情</h3><p>1.实现网站的业务逻辑</p>
<p>2.数据的增删改查</p>
<h3 id="3-为什么选择Node"><a href="#3-为什么选择Node" class="headerlink" title="3. 为什么选择Node"></a>3. 为什么选择Node</h3><p>1.使用JavaScript语法开发后端应用</p>
<p>2.一些公司要求前端工程师掌握Node开发</p>
<p>3.生态系统活跃，有大量开源库可以使用++++++</p>
<p>4.前端开发工具大多基于Node开发</p>
<p>2021-3-18 09:41:24</p>
<h3 id="4-Node是什么"><a href="#4-Node是什么" class="headerlink" title="4. Node是什么"></a>4. Node是什么</h3><p>1.Node是一个基于Chrome V8引擎的JavaScript代码运行环境。</p>
<img src="../../img/15/1.png" alt="1" style="zoom:67%;" />

<p>2.运行环境</p>
<ul>
<li>浏览器（软件）能够运行JavaScript代码，浏览器就是JavaScript代码的运行环境</li>
<li>Node（软件）能够运行JavaScript代码，Node就是JavaScript代码的运行环境</li>
</ul>
<hr>
<h2 id="1-2-Node运行环境搭建"><a href="#1-2-Node运行环境搭建" class="headerlink" title="1.2 Node运行环境搭建"></a>1.2 Node运行环境搭建</h2><h3 id="1-Node-js运行环境安装"><a href="#1-Node-js运行环境安装" class="headerlink" title="1. Node.js运行环境安装"></a>1. Node.js运行环境安装</h3><p>1.官网：<a target="_blank" rel="noopener" href="https://nodejs.org/en/">https://nodejs.org/en/</a></p>
<ul>
<li>LTS = Long Term Support 长期支持版 稳定版</li>
<li>Current 拥有最新特性 实验版</li>
</ul>
<p>2.中文网：<a target="_blank" rel="noopener" href="http://nodejs.cn/">http://nodejs.cn/</a></p>
<h3 id="2-报错"><a href="#2-报错" class="headerlink" title="2. 报错"></a>2. 报错</h3><p>1.我没报错；2021-3-18 10:05:01</p>
<p>2.就没笔记了；</p>
<p>3.PATH环境变量</p>
<img src="../../img/15/2.png" alt="2" />

<p>存储系统中的目录，在命令行中执行命令的时候系统会自动去这些目录中查找命令的位置。</p>
<ul>
<li>如果把软件的安装路径写在path里，那么在Windows PowerShell 里，直接输入 软件exe的名称，就可以打开软件；</li>
</ul>
<h3 id="3-命令行工具"><a href="#3-命令行工具" class="headerlink" title="3. 命令行工具"></a>3. 命令行工具</h3><p>1.Windows PowerShell</p>
<blockquote>
<p>百度百科:<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Windows%20Power%20Shell/693789?fromtitle=windows%20powershell&amp;fromid=4118072&amp;fr=aladdin">https://baike.baidu.com/item/Windows%20Power%20Shell/693789?fromtitle=windows%20powershell&amp;fromid=4118072&amp;fr=aladdin</a></p>
</blockquote>
<p>2.clear;可以清除已经有的内容；</p>
<p><img src="../../img/15/5.png" alt="5"></p>
<hr>
<h2 id="1-3-Node-js快速入门"><a href="#1-3-Node-js快速入门" class="headerlink" title="1.3 Node.js快速入门"></a>1.3 Node.js快速入门</h2><h3 id="1-组成"><a href="#1-组成" class="headerlink" title="1. 组成"></a>1. 组成</h3><p>1.JavaScript 由三部分组成，ECMAScript，DOM，BOM。</p>
<p>2.Node.js是由==ECMAScript==及==Node 环境==提供的一些==附加API==组成的，包括文件、网络、路径等等一些更加强大的 API。</p>
<img src="../../img/15/3.png" alt="3" />



<h3 id="2-Node-js基础语法"><a href="#2-Node-js基础语法" class="headerlink" title="2. Node.js基础语法"></a>2. Node.js基础语法</h3><p>1.所有ECMAScript语法在Node环境中都可以使用。</p>
<p>2.在Node环境下执行代码，使用Node命令执行后缀为.js的文件即可</p>
<img src="../../img/15/4.png" alt="4" />



<h3 id="3-Node-js全局对象global-1"><a href="#3-Node-js全局对象global-1" class="headerlink" title="3. Node.js全局对象global[^1]"></a>3. Node.js全局对象global[^1]</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1UE411H71P?p=43">https://www.bilibili.com/video/BV1UE411H71P?p=43</a></p>
<p>视频的顺序错误，这里应该是P5；2021-3-18 11:05:38</p>
<p>可能以后会修正；</p>
</blockquote>
<p>1.在浏览器中全局对象是window，在Node中全局对象是global[^1]。</p>
<p>2.Node中全局对象下有以下方法，可以在任何地方使用，global[^1]可以省略。</p>
<ul>
<li>console.log()     在控制台中输出</li>
<li>setTimeout()     设置超时定时器</li>
<li>clearTimeout()  清除超时时定时器</li>
<li>setInterval()      设置间歇定时器</li>
<li>clearInterval()   清除间歇定时器</li>
</ul>
<p>3.视频里面还有证明global是全局对象的过程…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global.console.log(&#x27;我是global对象下面的console.log方法输出的内容&#x27;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// global.setTimeout(function () &#123;</span></span><br><span class="line"><span class="comment">//     console.log(&#x27;123&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;, 2000)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;我是global对象下面的console.log方法输出的内容&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>

<p>3.1 先，前面有global，node XXX.js，有效</p>
<p>3.2 然后去掉前面的global，还是有效，就证明了；2021-3-18 11:05:17</p>
<hr>
<h1 id="2-模块加载及第三方包"><a href="#2-模块加载及第三方包" class="headerlink" title="2. 模块加载及第三方包"></a>2. 模块加载及第三方包</h1><p>1.目标：</p>
<p> 能够使用模块导入导出方法<br> 能够使用基本的系统模块<br> 能够使用常用的第三方包<br> 能够说出模块的加载机制<br> 能够知道package.json文件的作用</p>
<p>2.</p>
<p> Node.js中模块化开发概述<br> 系统模块<br> 第三方模块<br> Node.js中模块的加载机制<br> package.json文件</p>
<hr>
<h2 id="2-1-Node-js模块化开发"><a href="#2-1-Node-js模块化开发" class="headerlink" title="2.1 Node.js模块化开发"></a>2.1 Node.js模块化开发</h2><h3 id="1-JavaScript开发弊端"><a href="#1-JavaScript开发弊端" class="headerlink" title="1. JavaScript开发弊端"></a>1. JavaScript开发弊端</h3><p>1.JavaScript在使用时存在两大问题，文件依赖和命名冲突。</p>
<img src="../../img/15/6.png" alt="6" />

<br />

<h3 id="2-生活中的模块化开发"><a href="#2-生活中的模块化开发" class="headerlink" title="2. 生活中的模块化开发"></a>2. 生活中的模块化开发</h3><p><img src="../../img/15/7.png" alt="7"></p>
<br />

<h3 id="3-软件中的模块化开发"><a href="#3-软件中的模块化开发" class="headerlink" title="3. 软件中的模块化开发"></a>3. 软件中的模块化开发</h3><p>1.一个功能就是一个模块，多个模块可以组成完整应用，抽离一个模块不会影响其他功能的运行。</p>
<p><img src="../../img/15/8.png" alt="8"></p>
<br />

<h3 id="4-Node-js中模块化开发规范"><a href="#4-Node-js中模块化开发规范" class="headerlink" title="4. Node.js中模块化开发规范"></a>4. Node.js中模块化开发规范</h3><p>1.Node.js规定一个==JavaScript文件==就是一个模块，模块==内部定义的变量和函数==默认情况下在==外部无法得到==</p>
<p>2.模块内部可以使用==exports[^2]对象进行成员导出==， 使用==require[^3]方法==导入其他模块。</p>
<p>2.1 假如我们，现在有一个A模块，A模块里面，实现了一些函数</p>
<ul>
<li>如果B模块想用</li>
</ul>
<p>2.2 先用exports导出A模块的某函数</p>
<ul>
<li>怎么导出？变成exports对象的属性值；</li>
</ul>
<p>2.3 算了听视频吧</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1UE411H71P?p=6&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1UE411H71P?p=6&amp;spm_id_from=pageDriver</a></p>
<p>02:10；2021-3-18 11:42:43</p>
</blockquote>
<ul>
<li>1.还是要写出来地。不写出来，不行地；2021-4-25 21:11:53</li>
<li>2.未来的我，回来复习了；看见没写好笔记，发现之前的思想出错；</li>
</ul>
<p>3.假如，我们有一个A模块，就是下面的a.js；</p>
<ul>
<li>1.Node.js规定一个==JavaScript文件==就是一个模块</li>
<li>2.这个模块下面，有一些函数，加法，减法，乘法等等。</li>
</ul>
<p>3.1 然后有一个B模块，我们想再B模块，使用A模块里面的函数。</p>
<ul>
<li><p>1.首先，我们要在A模块里面，使用exports对象，进行导出操作。</p>
<ul>
<li><p>1.exports是一个对象。</p>
</li>
<li><p>2.去打印，看看里面有什么。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="built_in">exports</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<ul>
<li><p>3.打印结果：{}；是一个空对象</p>
</li>
<li><p>4.我们再打印：module.exports 试试；</p>
<ul>
<li>还是空对象</li>
</ul>
</li>
<li><p>5.从结论来看：</p>
<ul>
<li>1.exports，是一个对象名。为什么就有导出的效果了呢？</li>
<li>2.一定是哪里写了东西，有可能，是node.js自己写了的；</li>
<li>3.因为这里看不到，有引入什么。只有node.js本身；</li>
<li>4.可以当做是，node.js的关键词</li>
</ul>
</li>
</ul>
<ul>
<li>2.所以，导出。就是变成exports的属性值；</li>
</ul>
<p>4.B模块，要依赖A模块，就必须先引入；</p>
<ul>
<li>1.创建一个变量or常量，接收引入的返回值；</li>
<li>2.require的返回值，就是那个模块的exports对象；</li>
<li>3.接下来，用这个接收到返回值的变量，打点调用，就可以了。对象的语法。</li>
</ul>
<p><img src="../../img/15/9.png" alt="9"></p>
<br />

<h3 id="5-模块成员导出"><a href="#5-模块成员导出" class="headerlink" title="5. 模块成员导出"></a>5. 模块成员导出</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// a.js</span></span><br><span class="line"> <span class="comment">// 在模块内部定义变量</span></span><br><span class="line"><span class="keyword">let</span> version = <span class="number">1.0</span>;</span><br><span class="line"><span class="comment">// 在模块内部定义方法</span></span><br><span class="line"><span class="keyword">const</span> sayHi = <span class="function"><span class="params">name</span> =&gt;</span> <span class="string">`您好, <span class="subst">$&#123;name&#125;</span>`</span>;</span><br><span class="line"><span class="comment">// 向模块外部导出数据 </span></span><br><span class="line"><span class="built_in">exports</span>.version = version;</span><br><span class="line"><span class="built_in">exports</span>.sayHi = sayHi;</span><br></pre></td></tr></table></figure>



<h3 id="6-模块成员导入"><a href="#6-模块成员导入" class="headerlink" title="6. 模块成员导入"></a>6. 模块成员导入</h3><p>1.引入后，有点像一个对象</p>
<ul>
<li>1.a就是对象名，而里面的函数，就是方法；</li>
<li>2.点+函数名，就能使用函数。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// b.js</span></span><br><span class="line"> <span class="comment">// 在b.js模块中导入模块a</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a.js&#x27;</span>);</span><br><span class="line"> <span class="comment">// 输出b模块中的version变量</span></span><br><span class="line"><span class="built_in">console</span>.log(a.version);</span><br><span class="line"> <span class="comment">// 调用b模块中的sayHi方法 并输出其返回值</span></span><br><span class="line"><span class="built_in">console</span>.log(a.sayHi(<span class="string">&#x27;黑马讲师&#x27;</span>)); </span><br></pre></td></tr></table></figure>

<p>导入模块时后缀可以省略</p>
<ul>
<li>比如上面的a.js，可以写成a；不过我自己喜欢带后缀；2021-3-18 13:57:10</li>
<li>我们现在不喜欢了；2021-4-25 21:07:32</li>
</ul>
<p>俺自己：</p>
<p>1.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">n1, n2</span>) =&gt;</span> n1 + n2;</span><br><span class="line"><span class="built_in">exports</span>.add = add;</span><br></pre></td></tr></table></figure>

<p>2.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./1.js&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a.add(<span class="number">10</span>, <span class="number">20</span>));</span><br></pre></td></tr></table></figure>



<h3 id="7-模块成员导出的另一种方式"><a href="#7-模块成员导出的另一种方式" class="headerlink" title="7. 模块成员导出的另一种方式"></a>7. 模块成员导出的另一种方式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.version = version;</span><br><span class="line"><span class="built_in">module</span>.exports.sayHi = sayHi;</span><br></pre></td></tr></table></figure>

<p>1.exports是module.exports的别名(地址引用关系)，导出对象最终以module.exports为准</p>
<p>2.如果不是同时，则没有影响，如果同时一个对象，那么module.exports为准；</p>
<hr>
<h2 id="2-2-系统模块"><a href="#2-2-系统模块" class="headerlink" title="2.2 系统模块"></a>2.2 系统模块</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1UE411H71P?p=8&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1UE411H71P?p=8&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<blockquote>
<p>PPT: F:\三次元\4-学习\7-web\5-node.js\11-16 前后端交互\11-13node+express\day01\PPT</p>
<p>02.模块加载及包</p>
</blockquote>
<h3 id="1-什么是系统模块"><a href="#1-什么是系统模块" class="headerlink" title="1. 什么是系统模块"></a>1. 什么是系统模块</h3><p>1.Node运行环境提供的API. 因为这些API都是以模块化的方式进行开发的, 所以我们又称Node运行环境提供的API为系统模块</p>
<p><img src="../../img/15/10.png" alt="10"></p>
<h3 id="2-系统模块fs-文件操作"><a href="#2-系统模块fs-文件操作" class="headerlink" title="2. 系统模块fs 文件操作"></a>2. 系统模块fs 文件操作</h3><p>1.f：file 文件 ，s：system 系统，文件操作系统。</p>
<p><code>const fs = require(&#39;fs&#39;);</code></p>
<ul>
<li>说实话，没听明白，但知道，fs不能直接用，需要引入。</li>
</ul>
<p>1.1 require里的fs，是模块名称。</p>
<h3 id="2-读取文件内容"><a href="#2-读取文件内容" class="headerlink" title="2. 读取文件内容"></a>2. 读取文件内容</h3><p><code>fs.reaFile(&#39;文件路径/文件名称&#39;[,&#39;文件编码&#39;], callback);</code></p>
<ul>
<li>有[]，中括号的，是可选参数。</li>
</ul>
<p>2.1 callback，是个回调函数；</p>
<ul>
<li><p>如果某个api中的参数是回调函数，我们就用callback，标识；</p>
</li>
<li><p>有什么作用？</p>
<p>因为是硬盘在读取，不会有反应。读完了给你说一声，要自己写；</p>
</li>
</ul>
<p>2.2 语法示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取上一级css目录下中的base.css</span></span><br><span class="line">fs.readFile(<span class="string">&#x27;../css/base.css&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>(err, doc) =&gt; &#123;</span><br><span class="line">    <span class="comment">//如果文件读取发生错误，参数err的值为错误对象，否则err的值为null</span></span><br><span class="line">    <span class="comment">// doc参数为文件内容</span></span><br><span class="line">    <span class="keyword">if</span>(err == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// 在控制台中输出文件内容</span></span><br><span class="line">    <span class="built_in">console</span>.log(doc);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>err是错误时，doc是读取的结果；</li>
<li>2021-4-8 17:51:03</li>
</ul>
<p>2.3 不仅仅是reaFile，node.js当中，所有的回调函数的第一个参数都是err；</p>
<p>3.案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.通过模块的名字fs对模块进行引用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;./1.js&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(doc);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="3-写入内容"><a href="#3-写入内容" class="headerlink" title="3. 写入内容"></a>3. 写入内容</h3><p><code>fs.writeFile(&#39;文件路径/文件名称&#39;, &#39;数据&#39;, callback);</code></p>
<p>1.写入也是耗时的操作，无法通过API的返回值来确定结果。需要自己写回调函数；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> content = <span class="string">&#x27;&lt;h3&gt;正在使用fs.writeFile写入文件内容&lt;/h3&gt;&#x27;</span>;</span><br><span class="line">fs.writeFile(<span class="string">&#x27;../index.html&#x27;</span>, content, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err != <span class="literal">null</span>) &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;文件写入成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>2.自己：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.writeFile(<span class="string">&#x27;./demo.txt&#x27;</span>, <span class="string">&#x27;即将要写入的内容&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;文件内容写入成功&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>2.1 预览：</p>
<p><img src="../../img/15/11.png" alt="11"></p>
<hr>
<h3 id="3-系统模块path-路径操作"><a href="#3-系统模块path-路径操作" class="headerlink" title="3. 系统模块path 路径操作"></a>3. 系统模块path 路径操作</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=10&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=10&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.为什么要进行路径拼接 </p>
<ul>
<li>不同操作系统的路径分隔符不统一</li>
<li>/public/uploads/avatar，路径中文件夹与文件夹之间的分隔符；</li>
<li>Windows 上是 \   /</li>
<li>Linux 上是 /</li>
</ul>
<h4 id="3-1-路径拼接语法"><a href="#3-1-路径拼接语法" class="headerlink" title="3.1 路径拼接语法"></a>3.1 路径拼接语法</h4><p><code>path.join(&#39;路径&#39;, &#39;路径&#39;, ...)</code></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=11&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=11&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 导入path模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"> <span class="comment">// 路径拼接</span></span><br><span class="line"><span class="keyword">let</span> finialPath = path.join(<span class="string">&#x27;itcast&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c.css&#x27;</span>);</span><br><span class="line"> <span class="comment">// 输出结果 itcast\a\b\c.css</span></span><br><span class="line"><span class="built_in">console</span>.log(finialPath);</span><br></pre></td></tr></table></figure>

<p>1.path.join，不是一个耗时操作，所以可以使用它的返回值，不需要回调函数；</p>
<ul>
<li>1.1 重温，不是一个异步api；</li>
</ul>
<p>2.不同系统，返回的斜杠也不同；2021-4-10 16:58:59</p>
<h4 id="3-2-相对路径VS绝对路径"><a href="#3-2-相对路径VS绝对路径" class="headerlink" title="3.2 相对路径VS绝对路径"></a>3.2 相对路径VS绝对路径</h4><p>1.在node.js开发中，大多数情况下使用绝对路径，因为相对路径有时候相对的是命令行工具的当前工作目录。</p>
<ul>
<li><p>不是文件里面的目录。</p>
</li>
<li><p>而是命令行里面的目录：</p>
<p><img src="../../img/15/12.png" alt="12"></p>
</li>
</ul>
<p>1.2 如果命令行的目录不在当前文件的目录：</p>
<p><img src="../../img/15/13.png" alt="13"></p>
<p>1.3 然后视频说，命令行的目录常变，所以也不好一直待在这个文件的目录下；</p>
<p>2.在读取文件或者设置文件路径时都会选择绝对路径</p>
<p>3.使用__dirname获取当前文件所在的绝对路径</p>
<ul>
<li>dir是目录的简写，前面是两个下划线， _,_。不是一个</li>
</ul>
<p>3.1 怎么用这个命令呢？这就要用到path；</p>
<ul>
<li><p>案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(path.join(__dirname, <span class="string">&#x27;4-writeFile.js&#x27;</span>), <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(doc);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>3.2 详细理解__dirname;</p>
<ul>
<li>写入这个代码的文件在哪里，这个代码就是那个路径，但不包含文件的名字；</li>
</ul>
<p><img src="../../img/15/14.png" alt="14"></p>
<p>3.3 <code>__dirname</code>就是一个路径；然后交给path拼接，就出了绝对路径；</p>
<p><code>path.join(__dirname, &#39;4-writeFile.js&#39;)</code></p>
<hr>
<h2 id="2-3-第三方模块"><a href="#2-3-第三方模块" class="headerlink" title="2.3 第三方模块"></a>2.3 第三方模块</h2><h3 id="1-什么是第三方模块"><a href="#1-什么是第三方模块" class="headerlink" title="1. 什么是第三方模块"></a>1. 什么是第三方模块</h3><p>1.别人写好的、具有特定功能的、我们能直接使用的模块即第三方模块，由于第三方模块通常都是由多个文件组成并且被放置在一个文件夹中，所以又名包。</p>
<h4 id="1-1-第三方模块有两种存在形式："><a href="#1-1-第三方模块有两种存在形式：" class="headerlink" title="1.1 第三方模块有两种存在形式："></a>1.1 第三方模块有两种存在形式：</h4><p>以js文件的形式存在，提供实现项目具体功能的API接口。<br>以命令行工具形式存在，辅助项目开发</p>
<hr>
<h3 id="2-获取第三方模块"><a href="#2-获取第三方模块" class="headerlink" title="2. 获取第三方模块"></a>2. 获取第三方模块</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=12&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=12&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.npmjs.com：第三方模块的存储和分发仓库</p>
<p>1.1 npm (node package manager[^23]) ： node的第三方模块管理工具</p>
<ul>
<li><p>下载：npm install 模块名称<br>卸载：npm unintall package 模块名称</p>
<p>全局卸载：npm uninstall -g 名称</p>
<p>而全局下载的-g是跟在最后面的：npm install xxx -g</p>
</li>
</ul>
<p>1.2 全局安装与本地安装</p>
<ul>
<li><p>本地安装，安装到当前项目中，供这个项目使用</p>
<p>全局安装：安装到公共目录中，所有项目都可使用。</p>
</li>
<li><p>命令行工具，这种第三方模块，建议全局安装</p>
<ul>
<li>emm,用得多的，可以全局；2021-5-10 10:13:36</li>
</ul>
</li>
<li><p>库文件，建议：本地安装</p>
</li>
</ul>
<hr>
<h3 id="3-第三方模块-nodemon"><a href="#3-第三方模块-nodemon" class="headerlink" title="3. 第三方模块 nodemon"></a>3. 第三方模块 nodemon</h3><p>1.nodemon是一个命令行工具，用以辅助项目开发。<br>在Node.js中，每次修改文件都要在命令行工具中重新执行该文件，非常繁琐。</p>
<p>2.使用步骤</p>
<ul>
<li><p>使用npm install nodemon –g 下载它</p>
<p>-g，是全局安装</p>
</li>
</ul>
<p>2.1 在命令行工具中用nodemon命令替代node命令执行文件</p>
<ul>
<li><p><code>nodemon xx.js</code></p>
<p><img src="../../img/15/15.png" alt="15"></p>
</li>
</ul>
<p>2.2 好像这么用了后，在js文件里面修改后，这边会自动再执行一次js文件</p>
<p>2.3 退出用：<code>ctrl+c</code></p>
<ul>
<li>这里不是复制。</li>
</ul>
<hr>
<h3 id="4-第三方模块-nrm"><a href="#4-第三方模块-nrm" class="headerlink" title="4. 第三方模块 nrm"></a>4. 第三方模块 nrm</h3><p>1.nrm ( npm registry[^24] manager )：npm下载地址切换工具</p>
<p>2.npm默认的下载地址在国外，国内下载速度慢</p>
<p><img src="../../img/15/16.png" alt="16"></p>
<p>3.使用步骤</p>
<p>使用npm install nrm –g 下载它<br>查询可用下载地址列表 nrm ls</p>
<ul>
<li>ls，是列表的意思</li>
</ul>
<p>切换npm下载地址 nrm use 下载地址名称</p>
<p>3.1 报错：<code>nrm ls</code>系统不允许脚本：</p>
<ul>
<li><p>修正：<code>set-ExecutionPolicy RemoteSigned</code>必须在管理员权限打开</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PS </span>C:\<span class="string">WINDOWS\</span><span class="string">system32&gt;</span> <span class="built_in">set-ExecutionPolicy</span> <span class="string">RemoteSigned</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">执</span>行策略更改</span><br><span class="line">执行策略可帮助你防止执行不信任的脚本。更改执行策略可能会产生安全风险，如 <span class="string">https:</span>/<span class="string">go.</span><span class="string">microsoft.</span><span class="string">com/</span><span class="string">fwlink/</span>?<span class="string">LinkID=</span><span class="string">135170</span></span><br><span class="line"><span class="string">中</span>的 <span class="string">about_Execution_Policies </span>帮助主题所述。是否要更改执行策略?</span><br><span class="line">[Y] 是(Y)  [A] 全是(A)  [N] 否(N)  [L] 全否(L)  [S] 暂停(S)  [?] 帮助 (默认值为“N”): y</span><br><span class="line"><span class="string">PS </span>C:\<span class="string">WINDOWS\</span><span class="string">system32&gt;</span> <span class="built_in">get-ExecutionPolicy</span></span><br><span class="line"><span class="built_in">RemoteSigned</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>3.2 接着报错：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span>ernal/validators.js:<span class="number">124</span></span><br><span class="line">    throw new ERR_INVALID_ARG_TYPE(name, <span class="string">&#x27;string&#x27;</span>, value);</span><br><span class="line">    ^</span><br><span class="line"></span><br><span class="line">[TypeError [ERR_INVALID_ARG_TYPE]: The <span class="string">&quot;path&quot;</span> argument must be of type <span class="built_in">string</span>. Received undefined</span><br><span class="line">  at validateString (<span class="built_in">int</span>ernal/validators.js:<span class="number">124</span>:<span class="number">11</span>)</span><br><span class="line">  at Object.join (path.js:<span class="number">375</span>:<span class="number">7</span>)</span><br><span class="line">  at Object.&lt;anonymous&gt; (C:\Users\X8TI\AppData\Roaming\npm\node_modules\nrm\cli.js:<span class="number">17</span>:<span class="number">20</span>)</span><br><span class="line">  at Module._compile (<span class="built_in">int</span>ernal/modules/cjs/loader.js:<span class="number">1063</span>:<span class="number">30</span>)</span><br><span class="line">  at Object.Module._extensions..js (<span class="built_in">int</span>ernal/modules/cjs/loader.js:<span class="number">1092</span>:<span class="number">10</span>)</span><br><span class="line">  at Module.load (<span class="built_in">int</span>ernal/modules/cjs/loader.js:<span class="number">928</span>:<span class="number">32</span>)</span><br><span class="line">  at Function.Module._load (<span class="built_in">int</span>ernal/modules/cjs/loader.js:<span class="number">769</span>:<span class="number">14</span>)</span><br><span class="line">  at Function.executeUserEntryPoint [as runMain] (<span class="built_in">int</span>ernal/modules/run_main.js:<span class="number">72</span>:<span class="number">12</span>)</span><br><span class="line">  at <span class="built_in">int</span>ernal/main/run_main_module.js:<span class="number">17</span>:<span class="number">47</span></span><br><span class="line">] &#123;</span><br><span class="line">  code: <span class="string">&#x27;ERR_INVALID_ARG_TYPE&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>3.4 解决办法：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9d1745cbf7a0">https://www.jianshu.com/p/9d1745cbf7a0</a></p>
<p>4.<code>nrm use taobao</code>后，再<code>nrm ls</code>看看淘宝前面有*号没，有就成功了</p>
<hr>
<h3 id="5-第三方模块-Gulp"><a href="#5-第三方模块-Gulp" class="headerlink" title="5. 第三方模块 Gulp"></a>5. 第三方模块 Gulp</h3><p>1.基于node平台开发的前端构建工具<br>将机械化操作编写成任务, 想要执行机械化操作时执行一个命令行命令任务就能自动执行了<br>用机器代替手工，提高开发效率。</p>
<h4 id="5-1-Gulp能做什么"><a href="#5-1-Gulp能做什么" class="headerlink" title="5.1 Gulp能做什么"></a>5.1 Gulp能做什么</h4><p>项目上线，HTML、CSS、JS文件压缩合并<br>语法转换（es6、less …）<br>公共文件抽离</p>
<ul>
<li>比如头部文件，抽离到一个独立的文件夹，需要改的时候就改那一个，其他全部都适应</li>
</ul>
<p>修改文件浏览器自动刷新</p>
<h4 id="5-2-使用"><a href="#5-2-使用" class="headerlink" title="5.2 使用"></a>5.2 使用</h4><p>1.使用npm install gulp下载gulp库文件</p>
<ul>
<li>视频说，这库文件本地下载才有用，我已经下载了全局了，我试试能用不；</li>
</ul>
<p>2.在项目根目录下建立gulpfile.js文件</p>
<ul>
<li>文件名是要求了的，不能所以修改。</li>
</ul>
<p>3.重构项目的文件夹结构 src目录放置源代码文件 dist目录放置构建后文件</p>
<p>4.在gulpfile.js文件中编写任务.</p>
<p>5.在命令行工具中执行gulp任务</p>
<h4 id="5-3-gulp提供的方法"><a href="#5-3-gulp提供的方法" class="headerlink" title="5.3 gulp提供的方法"></a>5.3 gulp提供的方法</h4><p>1.gulp.src()：获取任务要处理的文件<br>2.gulp.dest[^5]()：输出文件<br>3.gulp.task[^6]()：建立gulp任务</p>
<ul>
<li><p>1.有两个参数，第一个是要建立的任务的名称（但没建立什么类型的任务？还是说任务没类型）</p>
</li>
<li><pre><code class="js">gulp.task(<span class="string">'first'</span>, () =&gt; &#123;
   <span class="built_in">console</span>.log(<span class="string">'第一个gulp任务执行'</span>);
   <span class="comment">// 3.使用gulp.src获取要处理的文件</span>
   gulp.src(<span class="string">'./src/css/public.css'</span>)
       .pipe(gulp.dest(<span class="string">'./dist/css'</span>));
&#125;);
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight taggerscript"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ &lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ 2.pipe[^7],虽然是管道，但这里是处理的意思；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  具体怎么处理这里还没有，这里只是复制，没有写特定的处理，就是复制。所以默认是复制？&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &amp;gt; https://www.bilibili.com/video/BV1j5411K7EH?p=16&amp;amp;spm_id_from=pageDriver&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &amp;gt; 06:20左右；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3.2 建立了任务，怎么运行？是老样子npm XX.js吗？&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ 1.不是&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ 2.下载命令行工具，gulp-cli，全局下载&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  + 2.1 如果先全局下载了gulp这里会报错；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  + ```&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    PS F:&lt;span class="symbol"&gt;\三&lt;/span&gt;次元&lt;span class="symbol"&gt;\4&lt;/span&gt;-学习&lt;span class="symbol"&gt;\7&lt;/span&gt;-web&lt;span class="symbol"&gt;\5&lt;/span&gt;-node.js&lt;span class="symbol"&gt;\1&lt;/span&gt;-练习&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp-demo&amp;gt; npm install gulp-cli -g&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR! code EEXIST&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR! path C:&lt;span class="symbol"&gt;\U&lt;/span&gt;sers&lt;span class="symbol"&gt;\X&lt;/span&gt;8TI&lt;span class="symbol"&gt;\A&lt;/span&gt;ppData&lt;span class="symbol"&gt;\R&lt;/span&gt;oaming&lt;span class="symbol"&gt;\n&lt;/span&gt;pm&lt;span class="symbol"&gt;\n&lt;/span&gt;ode_modules&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp-cli&lt;span class="symbol"&gt;\b&lt;/span&gt;in&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp.js&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR! dest C:&lt;span class="symbol"&gt;\U&lt;/span&gt;sers&lt;span class="symbol"&gt;\X&lt;/span&gt;8TI&lt;span class="symbol"&gt;\A&lt;/span&gt;ppData&lt;span class="symbol"&gt;\R&lt;/span&gt;oaming&lt;span class="symbol"&gt;\n&lt;/span&gt;pm&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR! EEXIST: file already exists, cmd shim &amp;#x27;C:&lt;span class="symbol"&gt;\U&lt;/span&gt;sers&lt;span class="symbol"&gt;\X&lt;/span&gt;8TI&lt;span class="symbol"&gt;\A&lt;/span&gt;ppData&lt;span class="symbol"&gt;\R&lt;/span&gt;oaming&lt;span class="symbol"&gt;\n&lt;/span&gt;pm&lt;span class="symbol"&gt;\n&lt;/span&gt;ode_modules&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp-cli&lt;span class="symbol"&gt;\b&lt;/span&gt;in&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp.js&amp;#x27; -&amp;gt; &amp;#x27;C:&lt;span class="symbol"&gt;\U&lt;/span&gt;sers&lt;span class="symbol"&gt;\X&lt;/span&gt;8TI&lt;span class="symbol"&gt;\A&lt;/span&gt;ppData&lt;span class="symbol"&gt;\R&lt;/span&gt;oaming&lt;span class="symbol"&gt;\n&lt;/span&gt;pm&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR! File exists: C:&lt;span class="symbol"&gt;\U&lt;/span&gt;sers&lt;span class="symbol"&gt;\X&lt;/span&gt;8TI&lt;span class="symbol"&gt;\A&lt;/span&gt;ppData&lt;span class="symbol"&gt;\R&lt;/span&gt;oaming&lt;span class="symbol"&gt;\n&lt;/span&gt;pm&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR! Remove the existing file and try again, or run npm&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR! with --force to overwrite files recklessly.&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR! A complete log of this run can be found in:&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm ERR!     C:&lt;span class="symbol"&gt;\U&lt;/span&gt;sers&lt;span class="symbol"&gt;\X&lt;/span&gt;8TI&lt;span class="symbol"&gt;\A&lt;/span&gt;ppData&lt;span class="symbol"&gt;\R&lt;/span&gt;oaming&lt;span class="symbol"&gt;\n&lt;/span&gt;pm-cache&lt;span class="symbol"&gt;\_&lt;/span&gt;logs&lt;span class="symbol"&gt;\2&lt;/span&gt;021-04-11T12_11_39_216Z-debug.log&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    PS F:&lt;span class="symbol"&gt;\三&lt;/span&gt;次元&lt;span class="symbol"&gt;\4&lt;/span&gt;-学习&lt;span class="symbol"&gt;\7&lt;/span&gt;-web&lt;span class="symbol"&gt;\5&lt;/span&gt;-node.js&lt;span class="symbol"&gt;\1&lt;/span&gt;-练习&lt;span class="symbol"&gt;\g&lt;/span&gt;ulp-demo&amp;gt; npm uninstall -g gulp&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    npm WARN deprecated fsevents@1.2.13: fsevents 1 will break on node v14+ and could be using insecure binaries. Upgrade to fsevents 2.&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    removed 323 packages in 2.891s&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre>
</li>
<li><p>3.然后gulp 任务名；</p>
<p><img src="../../img/15/17.png" alt="17"></p>
</li>
</ul>
<p>3.3 报错：</p>
<ul>
<li><pre><code>PS F:\三次元\4-学习\7-web\5-node.js\1-练习\gulp-demo&gt; gulp first
[20:30:44] Using gulpfile F:\三次元\4-学习\7-web\5-node.js\1-练习\gulp-demo\gulpfile.js
[20:30:44] Starting &apos;first&apos;...
第一个gulp任务执行
[20:30:44] &apos;first&apos; errored after 13 ms
[20:30:44] TypeError: gulp.pipe is not a function
    at F:\三次元\4-学习\7-web\5-node.js\1-练习\gulp-demo\gulpfile.js:10:10
    at first (F:\三次元\4-学习\7-web\5-node.js\1-练习\gulp-demo\node_modules\undertaker\lib\set-task.js:13:15)
    at bound (domain.js:413:15)
    at runBound (domain.js:424:12)
    at asyncRunner (F:\三次元\4-学习\7-web\5-node.js\1-练习\gulp-demo\node_modules\async-done\index.js:55:18)
    at processTicksAndRejections (internal/process/task_queues.js:75:11)
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight angelscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;span class=&quot;number&quot;&gt;2.&lt;/span&gt;解决：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;
gulp.src(&apos;./src/css/public.css&apos;)
    .pipe(gulp.dest(&apos;./dist/css&apos;));
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;4.gulp.watch()：监控文件的变化&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;5.一共有5个方法，这里只列出了4个；&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ 视频里面说的，百度了一下好像不止；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### 6. Gulp插件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#### 1.有这些，可能不是全部：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ gulp-htmlmin ：html文件压缩&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  gulp-csso ：压缩css&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  gulp-babel ：JavaScript语法转化&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  gulp-less: less语法转化&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  gulp-uglify ：压缩混淆JavaScript&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  gulp-file-include 公共文件包含&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  browsersync 浏览器实时同步&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#### 2.怎么用呢？&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##### 2.1 举例：html任务；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2.2 首先要下载这个插件，也是下载到本地；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ 以前的下载命令：npm install -\-save gulp-htmlmin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ 现在的npm已经没有save了。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ 所以是：npm install gulp-htmlmin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2.3 下载好了后，是引用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;`const htmlmin = require(&amp;#x27;gulp-htmlmin&amp;#x27;);`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2.4 引用进来后，是编写任务，调用它&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;```js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// html任务&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 1.html文件中代码的压缩操作&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 2.抽取html文件中的公共代码&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gulp.task(&amp;#x27;htmlmin&amp;#x27;, () =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;
</code></pre></li>
</ul>
<p>2.5 选择所有的html，并把压缩后的代码复制一份；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">&#x27;htmlmin&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/*.html&#x27;</span>)</span><br><span class="line">        <span class="comment">// 压缩html文件中的代码</span></span><br><span class="line">        .pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>这里需要理解一下<code>htmlmin(&#123; collapseWhitespace: true &#125;)</code></p>
</li>
<li><p>视频里面说：别理解，这些东西太多，用的时候去文档找；</p>
</li>
<li><p>算了吧，要理解；</p>
</li>
<li><p>首先是：collapse[^8]</p>
</li>
<li><p>white space 是连在一起的</p>
<blockquote>
<p>White space<br>英 [waɪt speɪs]   美 [waɪt speɪs]<br>留白;空白字符</p>
</blockquote>
</li>
<li><p>space单独是空间；</p>
<blockquote>
<p>space<br>英 [speɪs]   美 [speɪs]<br>n.(可利用的)空地，空间;空;空隙;空子;空当;宽敞;空旷;开阔<br>v.以一定间隔排列</p>
</blockquote>
</li>
<li><p>如果这样百度翻译：collapse whitespace</p>
<p>结果是：折叠空白</p>
</li>
</ul>
<p>2.5.1 这样的格式，也有待探索，小括号里面+一个大括号；</p>
<ul>
<li>({ })</li>
</ul>
<p>2.6 输出到dest目录下去：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">&#x27;htmlmin&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/*.html&#x27;</span>)</span><br><span class="line">        <span class="comment">// 压缩html文件中的代码</span></span><br><span class="line">        .pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;./dest&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.这里有个写法让我在意：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">&#x27;./src/*.html&#x27;</span>)</span><br><span class="line">    <span class="comment">// 压缩html文件中的代码</span></span><br><span class="line">    .pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">    .pipe(gulp.dest(<span class="string">&#x27;./dest&#x27;</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.如果只是一排，我知道是这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">&#x27;./src/*.html&#x27;</span>).pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;));</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.但如果是两排那是怎样？两种假设：</p>
<ul>
<li><pre><code class="js">gulp.src(<span class="string">'./src/*.html'</span>).pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;)).pipe(gulp.dest(<span class="string">'./dest'</span>));
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight less"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ ```&lt;span class="selector-tag"&gt;js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="selector-tag"&gt;gulp&lt;/span&gt;&lt;span class="selector-class"&gt;.src&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;./src/*.html&amp;#x27;&lt;/span&gt;)&lt;span class="selector-class"&gt;.pipe&lt;/span&gt;(htmlmin(&amp;#123; &lt;span class="attribute"&gt;collapseWhitespace&lt;/span&gt;: true &amp;#125;));&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="selector-tag"&gt;gulp&lt;/span&gt;&lt;span class="selector-class"&gt;.src&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;./src/*.html&amp;#x27;&lt;/span&gt;)&lt;span class="selector-class"&gt;.pipe&lt;/span&gt;(gulp.dest(&lt;span class="string"&gt;&amp;#x27;./dest&amp;#x27;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre>
</li>
</ul>
</li>
<li><p>4.显然，应该是第二种。但问题又来了，又没有返回<code>return this</code>，为什么可以直接写两排？</p>
<p>难道是第一种？实验：</p>
<ul>
<li><pre><code class="js">gulp.task(<span class="string">'htmlmin'</span>, () =&gt; &#123;
    gulp.src(<span class="string">'./src/*.html'</span>).pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;)).pipe(gulp.dest(<span class="string">'./dest'</span>));
&#125;);
<span class="comment">//没有报错</span>
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight less"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ 也不能说第二种错误，实验第二种：&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  ```&lt;span class="selector-tag"&gt;js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="selector-tag"&gt;gulp&lt;/span&gt;&lt;span class="selector-class"&gt;.task&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;htmlmin&amp;#x27;&lt;/span&gt;, () =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="selector-tag"&gt;gulp&lt;/span&gt;&lt;span class="selector-class"&gt;.src&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;./src/*.html&amp;#x27;&lt;/span&gt;)&lt;span class="selector-class"&gt;.pipe&lt;/span&gt;(htmlmin(&amp;#123; &lt;span class="attribute"&gt;collapseWhitespace&lt;/span&gt;: true &amp;#125;));&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="selector-tag"&gt;gulp&lt;/span&gt;&lt;span class="selector-class"&gt;.src&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;./src/*.html&amp;#x27;&lt;/span&gt;)&lt;span class="selector-class"&gt;.pipe&lt;/span&gt;(gulp.dest(&lt;span class="string"&gt;&amp;#x27;./dest&amp;#x27;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;

也没有报错。假设，两种写法对等。那么在2.6.1 那里的写法，`.pipe(htmlmin(&#123; collapseWhitespace: true &#125;))`自动返回了对象`gulp.src()`不成？
</code></pre>
</li>
</ul>
</li>
</ul>
<p>2.6.5 我去实验一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">&#x27;./src/*.html&#x27;</span>).pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;)).pipe(gulp.dest(<span class="string">&#x27;./dest&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>是否能正常运行；<code>gulp htmlmin</code>启动！</p>
<ul>
<li>1.有效；</li>
</ul>
<p>2.7 去实验一下</p>
<ul>
<li><pre><code class="js">gulp.task(<span class="string">'htmlmin'</span>, () =&gt; &#123;
    gulp.src(<span class="string">'./src/*.html'</span>).pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;));
    gulp.src(<span class="string">'./src/*.html'</span>).pipe(gulp.dest(<span class="string">'./dest'</span>));
&#125;);
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight less"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ &lt;span class="selector-tag"&gt;1&lt;/span&gt;.这么写是无效的；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ &lt;span class="selector-tag"&gt;2&lt;/span&gt;.只把原文件复制了过去，而没有压缩代码。&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ &lt;span class="selector-tag"&gt;3&lt;/span&gt;.也就是说，这两条代码，是各自为营。没有互相连接起来；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  ```&lt;span class="selector-tag"&gt;js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="selector-tag"&gt;gulp&lt;/span&gt;&lt;span class="selector-class"&gt;.src&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;./src/*.html&amp;#x27;&lt;/span&gt;)&lt;span class="selector-class"&gt;.pipe&lt;/span&gt;(htmlmin(&amp;#123; &lt;span class="attribute"&gt;collapseWhitespace&lt;/span&gt;: true &amp;#125;));&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="selector-tag"&gt;gulp&lt;/span&gt;&lt;span class="selector-class"&gt;.src&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;./src/*.html&amp;#x27;&lt;/span&gt;)&lt;span class="selector-class"&gt;.pipe&lt;/span&gt;(gulp.dest(&lt;span class="string"&gt;&amp;#x27;./dest&amp;#x27;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre>
</li>
<li><p>4.<code>gulp.src().pipe()</code>后面真的，还可以跟<code>.pipe</code></p>
</li>
<li><p>5.我要去搜索一下gulp.src()文档型的资料看看。</p>
</li>
</ul>
<p>2.8  2.7接着下面的3.pipe了。2.8回归视频：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=17&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=17&amp;spm_id_from=pageDriver</a></p>
<p>07:32；</p>
</blockquote>
<h5 id="3-抽取公共代码"><a href="#3-抽取公共代码" class="headerlink" title="3. 抽取公共代码"></a>3. 抽取公共代码</h5><p>1.下载插件：gulp-file[^9]-include[^10]</p>
<p>2.引入</p>
<p><code>const fileInclude = require(&#39;gulp-file-include&#39;);</code></p>
<p>2.1 前面的变量名，是自定义的；</p>
<p>3.调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">&#x27;htmlmin&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/*.html&#x27;</span>)</span><br><span class="line">        .pipe(fileInclude(&#123;</span><br><span class="line">            prefix: <span class="string">&#x27;@@&#x27;</span>,</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;./dist&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.1 根据视频里面的来，会报错；</p>
<ul>
<li><p>视频里面直接是<code>.pipe(fileInclude())</code></p>
</li>
<li><p>报错图：</p>
<p><img src="../../img/15/20.png" alt="20"></p>
</li>
<li><p>文档资料：<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/gulp-file-include">https://www.npmjs.com/package/gulp-file-include</a></p>
</li>
</ul>
<p>3.2 调用有误；没有成功，倒是把原本的两个html复制过去了，而不是这两个html里面公共的部分复制过去；</p>
<p>3.3 我看了看文档，好像我理解错了，不是能把公共的提取出来。</p>
<ul>
<li>而是能把公共的拿进来。</li>
</ul>
<p><strong>正确使用</strong></p>
<p>3.4 先把公共的部分，header剪切到一个地方：</p>
<ul>
<li>这里是剪切到<code>./src/common/header.html</code></li>
</ul>
<p>3.5 然后在被剪切的地方，引用公共的信息。</p>
<ul>
<li><code>@@include(&#39;./common/header.html&#39;)</code></li>
<li>这个得路径是从什么地方开始？是从当前代码文件的地方开始。这里的代码也在src,所以直接./common</li>
</ul>
<p>3.6 输出到一个目录下，看有没有被剪切走的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">&#x27;htmlmin&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/article.html&#x27;</span>)</span><br><span class="line">    .pipe(fileInclude(&#123; </span><br><span class="line">            prefix: <span class="string">&#x27;@&#x27;</span>,</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;./dist&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>在dist目录下的,article.html文件里面，有被剪切走的header代码；</li>
<li>成功；2021-4-12 16:01:18</li>
</ul>
<hr>
<h5 id="4-CSS任务"><a href="#4-CSS任务" class="headerlink" title="4. CSS任务"></a>4. CSS任务</h5><p>1.获取文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlmin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fileInclude = <span class="built_in">require</span>(<span class="string">&#x27;gulp-file-include&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// css任务</span></span><br><span class="line"><span class="comment">// 1.less语法转换</span></span><br><span class="line"><span class="comment">// 2.css代码压缩</span></span><br><span class="line">gulp.task(<span class="string">&#x27;cssmin&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/css/*.less&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>2.处理文件</p>
<ul>
<li>下载gulp-less，<code>npm install</code></li>
<li>引用：<code>const less = require(&#39;gulp-less&#39;);</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// css任务</span></span><br><span class="line"><span class="comment">// 1.less语法转换</span></span><br><span class="line">gulp.task(<span class="string">&#x27;cssmin&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/css/*.less&#x27;</span>)</span><br><span class="line">        .pipe(less())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;./dist/css&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>3.压缩</p>
<p>3.1 老样子，先下载插件：</p>
<ul>
<li>文档里面的下载命令是这样：<code>npm install gulp-csso --save-dev</code><ul>
<li>这里先不管后面的 <code>--save-dev</code></li>
<li>同时也不忽略，视频里说了后面再讲；</li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/gulp-csso">https://www.npmjs.com/package/gulp-csso</a></li>
</ul>
</li>
</ul>
<p>3.2 我先来，引入！</p>
<p><code>var csso = require(&#39;gulp-csso&#39;);</code></p>
<ul>
<li>我们自己不用var，用const；</li>
</ul>
<p>3.3 这里，我们把less和css一起压缩。用数组</p>
<p><img src="../../img/15/21.png" alt="21"></p>
<h4 id="3-pipe"><a href="#3-pipe" class="headerlink" title="3. pipe"></a>3. pipe</h4><p>1.pipe到目前为止，视频里面只说了一句复制。</p>
<p>2.因为种种写法，一度以为是glup的数据or方法。或者是gulp.src的属性or方法；</p>
<p>3.然而这些都不是。</p>
<p>4.它是node.js的东西，是一个用来连接管道什么的东西。</p>
<p>5.这里涉及到名为‘管道’的概念。这里先不追究。学到这些的时候，自然会学。</p>
<p>6.现在去触碰，可能基础不够 。</p>
<p>7.总而言之：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">&#x27;./src/*.html&#x27;</span>).pipe(htmlmin(&#123; <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">gulp.src(<span class="string">&#x27;./src/*.html&#x27;</span>).pipe(gulp.dest(<span class="string">&#x27;./dest&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>7.1 为什么没有效果，因为pipe真的只为前面那个服务。</p>
<p>7.2 只要形成了 管道流，就有pipe；</p>
<p>8.gulp.src()的返回值：返回一个可以在管道的开始或中间使用的流，用于根据给定的 globs 添加文件。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.gulpjs.com.cn/docs/api/src/#返回值">https://www.gulpjs.com.cn/docs/api/src/#返回值</a></p>
<p>2021-4-12 00:12:06</p>
</blockquote>
<hr>
<h4 id="4-编写JS任务"><a href="#4-编写JS任务" class="headerlink" title="4. 编写JS任务"></a>4. 编写JS任务</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=19&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=19&amp;spm_id_from=pageDriver</a></p>
<p>2021-4-12 17:41:05</p>
</blockquote>
<p><strong>1.JS任务</strong></p>
<ul>
<li>es6代码转换</li>
<li>代码压缩</li>
</ul>
<p><strong>2.要转换es6代码，需要用插件：gulp-babel[^11] ：JavaScript语法转化</strong></p>
<ul>
<li><p>去文档上看：发现是这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Babel 7</span><br><span class="line">$ npm install --save-dev gulp-babel @babel/core @babel/preset-env</span><br><span class="line"></span><br><span class="line"># Babel 6</span><br><span class="line">$ npm install --save-dev gulp-babel@<span class="number">7</span> babel-core babel-preset-env</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们用最新的版本，所以选择上面。但后面那一串是什么？</p>
<p><code>@babel/core @babel/preset-env</code></p>
</li>
<li><p>当需要一次下载多个插件的时候，每个名称用空格，隔开；</p>
<ul>
<li>这里就需要一次下载多个，gulp-babel会基于后面两个东西使用</li>
</ul>
</li>
</ul>
<p>2.1 <code>--save-dev</code>还是没有讲，我自己去百度算了；</p>
<ul>
<li><p>1.npm install 在安装 npm 包时，有两种命令参数可以把它们的信息写入 package.json 文件</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/star0311/article/details/90899013">https://blog.csdn.net/star0311/article/details/90899013</a></p>
</blockquote>
</li>
<li><p>2.简单来说：   使用命令 –save 或者说不写命令 –save  ,都会把信息记录到 dependencies   中；</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cvper/article/details/88728505">https://blog.csdn.net/cvper/article/details/88728505</a></p>
<p><a href="javascript:;">devDependencies</a> 项目应用开发环境依赖，开发和测试时的依赖，指定项目开发所依赖的模块，一些模块只在开发时需要依赖。</p>
</blockquote>
<hr>
</li>
</ul>
<p><strong>3.引入</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&#x27;gulp-babel&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p><strong>4.调用</strong></p>
<ul>
<li><p>1.文档里面也有调用的语法：</p>
<p><img src="../../img/15/22.png" alt="21"></p>
</li>
<li><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=19&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=19&amp;spm_id_from=pageDriver</a></p>
<p>03:57;</p>
</blockquote>
</li>
<li><p>这样 的格式，清楚了，是json；</p>
</li>
</ul>
<p><strong>5.压缩：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">&#x27;default&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/js/base.js&#x27;</span>)</span><br><span class="line">        .pipe(babel(&#123;</span><br><span class="line">            presets: [<span class="string">&#x27;@babel/env&#x27;</span>]</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(GulpUglify())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;dist&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>没看视频，自己搞；文档里面的案例也是错的</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/gulp-uglify">https://www.npmjs.com/package/gulp-uglify</a></p>
</blockquote>
</li>
</ul>
<h4 id="5-拷贝任务"><a href="#5-拷贝任务" class="headerlink" title="5. 拷贝任务"></a>5. 拷贝任务</h4><p>1.上面的是对html，css，js的处理；</p>
<ul>
<li>但不说网站，网页都会有图片等其他文件。<ul>
<li>这些文件，需要拷贝。确实也不需要处理</li>
</ul>
</li>
</ul>
<p><img src="../../img/15/23.png" alt="23"></p>
<p>2.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">&#x27;copy&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/images/*&#x27;</span>)</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;./dist/images&#x27;</span>));</span><br><span class="line">    gulp.src(<span class="string">&#x27;./src/lib&#x27;</span>)</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;./dist&#x27;</span>));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>有问题；</li>
</ul>
<p>2.1 我以为这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">&#x27;./src/lib&#x27;</span>)</span><br><span class="line">    .pipe(gulp.dest(<span class="string">&#x27;./dist&#x27;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li><p>可以把lib文件，及其以内的东西，全部复制到当前代码文件路径下的dist文件夹里面。</p>
</li>
<li><p>但只复制了一个文件夹，没有里面的东西。</p>
</li>
<li><p>可能还是要这样写完整：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">&#x27;./src/images/*&#x27;</span>)</span><br><span class="line">    .pipe(gulp.dest(<span class="string">&#x27;./dist/images&#x27;</span>));</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>2.2 视频里面这么写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">&#x27;./src/lib/*&#x27;</span>)</span><br><span class="line">.pipe(gulp.dest(<span class="string">&#x27;./dist/lib&#x27;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li><p>我不行。我想了想，这么写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">&#x27;./src/lib/*/*&#x27;</span>)</span><br><span class="line">.pipe(gulp.dest(<span class="string">&#x27;./dist/lib&#x27;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>行了</li>
</ul>
</li>
<li><p>唉，问题好多哦</p>
</li>
</ul>
<hr>
<h4 id="6-构建任务"><a href="#6-构建任务" class="headerlink" title="6. 构建任务"></a>6. 构建任务</h4><p>1.上面写了那么多，执行要一个个执行。显然不能这样</p>
<p>2.没说什么，直接代码了。这里的笔记PPT都没有，完全是我看视频，自己写的；</p>
<ul>
<li>视频里面这么写没事，我报错了；</li>
</ul>
<p><img src="../../img/15/24.png" alt="24"></p>
<ul>
<li>我：</li>
</ul>
<p><img src="../../img/15/25.png" alt="25"></p>
<ul>
<li>累</li>
</ul>
<p>2.1 百度：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43430074/article/details/105595350">https://blog.csdn.net/weixin_43430074/article/details/105595350</a></p>
</blockquote>
<p><code>gulp.task(&#39;default&#39;, gulp.series(&#39;htmlmin&#39;, &#39;cssmin&#39;, &#39;jsmin&#39;, &#39;copy&#39;));</code></p>
<ul>
<li><p>1.看来视频里面的gulp，是4.0以下的版本；</p>
<ul>
<li>1.1 查看gulp版本：4.0.2</li>
<li>1.2 连现在——2021-4-13 20:08:11，都才4.0.2。更别说这大概是2018年的资料</li>
<li>1.3 去找文档理解一下</li>
</ul>
</li>
<li><p>2.找到文档</p>
<ul>
<li><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.gulpjs.com.cn/docs/api/series/">https://www.gulpjs.com.cn/docs/api/series/</a></p>
</blockquote>
</li>
<li><p>2.1 语义：</p>
<p>将任务函数和/或组合操作组合成更大的操作，这些操作将按顺序依次执行。对于使用 <code>series()</code> 和 <code>parallel()</code> 组合操作的嵌套深度没有强制限制。</p>
</li>
<li><p>2.2 案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; series &#125; = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">javascript</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">css</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.build = series(javascript, css);</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.3 引用的写法，不同；</p>
</li>
<li><p>2.4 如果是视频里面的，大概是这样：</p>
<p><code>const series = require(&#39;series&#39;);</code></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30338743/article/details/97960197">https://blog.csdn.net/weixin_30338743/article/details/97960197</a></p>
<p>gulp.series：按照顺序执行<br>gulp.paralle：可以并行计算</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>2.5 不说关键词，连格式都不一样，有一个{}。需要系统的做一个gulp的笔记；</p>
</li>
<li><p>2.6 写到25.3笔记里面去；</p>
</li>
</ul>
<p>3.去看了看gulp4，很多地方看不懂；还是需要视频等资料；</p>
<ul>
<li><p>或者是基础不够；</p>
</li>
<li><p>要不这里找gulp3下载使用</p>
</li>
<li><p>2021-4-13 21:48:16，下班打卡；</p>
</li>
</ul>
<hr>
<h2 id="2-4-package-json文件"><a href="#2-4-package-json文件" class="headerlink" title="2.4 package.json文件"></a>2.4 package.json文件</h2><h3 id="1-node-modules文件夹的问题"><a href="#1-node-modules文件夹的问题" class="headerlink" title="1. node_modules文件夹的问题"></a>1. node_modules文件夹的问题</h3><p>1.文件夹以及文件过多过碎，当我们将项目整体拷贝给别人的时候,，传输速度会很慢很慢. </p>
<p>2.复杂的模块依赖关系需要被记录，确保模块的版本和当前保持一致，否则会导致当前项目运行报错</p>
<ul>
<li>package.json文件，会记录用了哪些第三方模块；</li>
</ul>
<h3 id="2-package-json文件的作用"><a href="#2-package-json文件的作用" class="headerlink" title="2. package.json文件的作用"></a>2. package.json文件的作用</h3><p>1.项目描述文件，记录了当前项目信息，例如项目名称、版本、作者、github地址、当前项目依赖了哪些第三方模块等。使用npm init -y命令生成。</p>
<ul>
<li>这里的-y，是 yes，全部填写默认值。</li>
<li>npm init 会问一些问题，有默认值；</li>
</ul>
<p>2.文件里面的<code>dependencies</code>，下面，就是下载的第三方模块。</p>
<ul>
<li><p>1.如果直接在命令行：<code>npm install</code>，后面不写任何名字；</p>
</li>
<li><p>2.那么会自动寻找package.json里面的dependencies下面的。</p>
</li>
<li><p>3.例如：</p>
<ul>
<li><p>1.先<code>npm init -y</code>生成一个默认npm项目？这个是叫npm项目么？</p>
</li>
<li><p>2.然后下载一个，不知道是什么玩意的mime；</p>
</li>
<li><pre><code>PS F:\三次元\4-学习\7-web\5-node.js\1-练习\ceshi&gt; npm init -y
Wrote to F:\三次元\4-学习\7-web\5-node.js\1-练习\ceshi\package.json:

&#123;
  &quot;name&quot;: &quot;ceshi&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: &#123;
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;
&#125;

PS F:\三次元\4-学习\7-web\5-node.js\1-练习\ceshi&gt; npm install mime
npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN ceshi@1.0.0 No description
npm WARN ceshi@1.0.0 No repository field.

+ mime@2.5.2
added 1 package from 1 contributor in 0.684s
PS F:\三次元\4-学习\7-web\5-node.js\1-练习\ceshi&gt;
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight pgsql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;span class=&quot;number&quot;&gt;3.&lt;/span&gt;那么在那个文件夹下，就有一个package.json文件，打开它会看到：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ```&lt;span class=&quot;type&quot;&gt;json&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;name&amp;quot;: &amp;quot;ceshi&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;version&amp;quot;: &amp;quot;1.0.0&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;description&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;main&amp;quot;: &amp;quot;index.js&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;scripts&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;test&amp;quot;: &amp;quot;echo \&amp;quot;Error: &lt;span class=&quot;keyword&quot;&gt;no&lt;/span&gt; test specified\&amp;quot; &amp;amp;&amp;amp; exit 1&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;keywords&amp;quot;: [],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;author&amp;quot;: &amp;quot;&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;license&amp;quot;: &amp;quot;ISC&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;dependencies&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;mime&amp;quot;: &amp;quot;^2.5.2&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre></li>
<li><p>4.不下mime，是没有dependencies[^25]的；</p>
</li>
</ul>
</li>
</ul>
<h3 id="3-项目依赖"><a href="#3-项目依赖" class="headerlink" title="3. 项目依赖"></a>3. 项目依赖</h3><p>1.项目中，有两种依赖，这里是项目依赖；</p>
<ul>
<li>主要是运行中的依赖；</li>
</ul>
<p>项目的开发阶段和线上运营阶段，都需要依赖的第三方包，称为项目依赖<br>使用npm install 包名命令下载的文件会默认被添加到 package.json 文件的 dependencies 字段中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">       <span class="string">&quot;jquery&quot;</span>: <span class="string">&quot;^3.3.1“</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&#125; </span></span><br></pre></td></tr></table></figure>



<h3 id="4-开发依赖"><a href="#4-开发依赖" class="headerlink" title="4. 开发依赖"></a>4. 开发依赖</h3><p>1.辅助开发项目的依赖；比如上面学习的gulp，项目运行后，就用不到gulp了；</p>
<p>在项目的开发阶段需要依赖，线上运营阶段不需要依赖的第三方包，称为开发依赖</p>
<p>2.使用npm install 包名 –save-dev命令将包添加到package.json文件的devDependencies字段中</p>
<ul>
<li>这样可以方便区分，项目依赖和开发依赖；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">       <span class="string">&quot;gulp&quot;</span>: <span class="string">&quot;^3.9.1“</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&#125; </span></span><br></pre></td></tr></table></figure>

<ul>
<li>2.会在package.json文件里面，生成devDependencies对象；</li>
</ul>
<blockquote>
<p>devDependencies : 开发人员依赖；开发依赖；</p>
</blockquote>
<p>3.npm install 会下载全部依赖，开发和项目依赖；</p>
<ul>
<li>1.<code>npm install --production</code>,只会下载项目依赖；</li>
</ul>
<h3 id="5-package-lock-json文件的作用"><a href="#5-package-lock-json文件的作用" class="headerlink" title="5. package-lock.json文件的作用"></a>5. package-lock.json文件的作用</h3><p> 1.锁定包的版本，确保再次下载时不会因为包版本不同而产生问题</p>
<p> 2.加快下载速度，因为该文件中已经记录了项目所依赖第三方包的树状结构和包的下载地址，重新安装时只需下载即可，不需要做额外的工作</p>
<h3 id="6-scripts-别名"><a href="#6-scripts-别名" class="headerlink" title="6. scripts 别名"></a>6. scripts 别名</h3><p>1.在package.json里，scripts，存储的是命令的别名；</p>
<p>2.视频里面演示：”build”: “nodemon app.js”</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=22&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=22&amp;spm_id_from=pageDriver</a></p>
<p>07.36</p>
</blockquote>
<ul>
<li>1.俺忘记了nodemon；<ul>
<li>1.1 上去看了看，比较node，只是在保存修改时，会自动执行一次；</li>
</ul>
</li>
</ul>
<p>3.正常情况使用要，node app.js，或者 nodemon app.js</p>
<ul>
<li>1.这里可以<code>npm run build</code> 等于 nodemon app.js<ul>
<li>因为上面有设置。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="2-5-Node-js中模块的加载机制"><a href="#2-5-Node-js中模块的加载机制" class="headerlink" title="2.5 Node.js中模块的加载机制"></a>2.5 Node.js中模块的加载机制</h2><p>1.完整路径：<code>require(&#39;./find.js&#39;);</code></p>
<ul>
<li>又有路径，又有后缀名；</li>
</ul>
<p>2.require方法根据模块路径查找路径，如果是完整路径，直接引入模块。</p>
<h3 id="1-模块查找规则"><a href="#1-模块查找规则" class="headerlink" title="1. 模块查找规则"></a>1. 模块查找规则</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=23&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=23&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.当模块拥有路径但没有后缀时</p>
<p><code>require(&#39;./find&#39;);</code></p>
<p>2.require方法根据模块路径查找模块，如果是完整路径，直接引入模块。</p>
<p>2.1 先在同级目录里面找</p>
<ul>
<li>如果模块后缀省略，先找同名JS文件，再找同名JS文件夹</li>
</ul>
<ul>
<li>如果找到了同名文件夹，找文件夹中的index.js。</li>
<li>如果找到了同名文件夹，却没有index.js就会去当前文件夹中的package.json文件中查找main选项中的入口文件<ul>
<li>那么，啥事入口文件？</li>
<li>是package.json里面的那个main；</li>
</ul>
</li>
<li>如果找指定的入口文件不存在或者没有指定入口文件就会报错，模块没有被找到</li>
</ul>
<h3 id="2-模块查找规则-当模块没有路径且没有后缀时"><a href="#2-模块查找规则-当模块没有路径且没有后缀时" class="headerlink" title="2. 模块查找规则-当模块没有路径且没有后缀时"></a>2. 模块查找规则-当模块没有路径且没有后缀时</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=24&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=24&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p><code>require(&#39;find&#39;);</code></p>
<p>1.Node.js会假设它是系统模块</p>
<ul>
<li>那么系统模块是什么？</li>
</ul>
<p>2.Node.js会去node_modules文件夹中<br>3.首先看是否有该名字的JS文件<br>4.再看是否有该名字的文件夹<br>5.如果是文件夹看里面是否有index.js<br>6.如果没有index.js查看该文件夹中的package.json中的main选项确定模块入口文件<br>7.否则找不到报错</p>
<h3 id="3-同级找不到"><a href="#3-同级找不到" class="headerlink" title="3. 同级找不到"></a>3. 同级找不到</h3><p>1.同级找不到，会去上级目录找的；怎么上面的笔记里面没有写这一点；2021-5-10 10:35:05</p>
<hr>
<h2 id="2-6-node全局对象global"><a href="#2-6-node全局对象global" class="headerlink" title="2.6 node全局对象global"></a>2.6 node全局对象global</h2><p>上面1.3.3。有</p>
<h1 id="3-请求响应原理及HTTP协议"><a href="#3-请求响应原理及HTTP协议" class="headerlink" title="3. 请求响应原理及HTTP协议"></a>3. 请求响应原理及HTTP协议</h1><p>1.目标：</p>
<p> 能够知道B/S软件体系结构<br> 能够搭建Web服务器<br> 能够使用获取GET、POST参数的方式获取参数<br> 能够掌握如何制作路由<br> 能够知道同步异步的概念<br> 能够知道回调函数的概念</p>
<p> C/S、B/S软件体系结构分析<br> 服务器端基础概念<br> 创建web服务器<br> HTTP协议<br> HTTP请求与响应处理<br> Node.js的工作原理</p>
<h2 id="3-0-B-S结构"><a href="#3-0-B-S结构" class="headerlink" title="3.0 B/S结构"></a>3.0 B/S结构</h2><p>1.B/S结构（Browser/Server，浏览器/服务器模式），是WEB兴起后的一种网络结构模式，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/WEB/150564">WEB</a>浏览器是客户端最主要的应用软件。这种模式统一了客户端，将系统功能实现的核心部分集中到<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/服务器/100571">服务器</a>上，简化了系统的开发、维护和使用。客户机上只要安装一个浏览器，如[Netscape Navigator](<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Netscape">https://baike.baidu.com/item/Netscape</a> Navigator/1014148)或[Internet Explorer](<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Internet">https://baike.baidu.com/item/Internet</a> Explorer/1537769)，服务器安装[SQL Server](<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/SQL">https://baike.baidu.com/item/SQL</a> Server/245994)、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Oracle/301207">Oracle</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/MYSQL/471251">MYSQL</a>等数据库。浏览器通过[Web Server](<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Web">https://baike.baidu.com/item/Web</a> Server/9306055) 同数据库进行数据交互</p>
<p><img src="../../img/15/55.png" alt="1"></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/B%2FS结构/4868588?fromtitle=b%2Fs&amp;fromid=219020">https://baike.baidu.com/item/B%2FS结构/4868588?fromtitle=b%2Fs&amp;fromid=219020</a></p>
</blockquote>
<h2 id="3-1-服务器端基础概念"><a href="#3-1-服务器端基础概念" class="headerlink" title="3.1 服务器端基础概念"></a>3.1 服务器端基础概念</h2><h3 id="1-网站的组成"><a href="#1-网站的组成" class="headerlink" title="1. 网站的组成"></a>1. 网站的组成</h3><p>1.网站应用程序主要分为两大部分：客户端和服务器端。</p>
<ul>
<li>客户端：在浏览器中运行的部分，就是用户看到并与之交互的界面程序。使用HTML、CSS、JavaScript构建。</li>
<li>服务器端：在服务器中运行的部分，负责存储数据和处理应用逻辑。</li>
</ul>
<p><img src="../../img/15/19.png" alt="1"></p>
<h3 id="2-Node网站服务器"><a href="#2-Node网站服务器" class="headerlink" title="2. Node网站服务器"></a>2. Node网站服务器</h3><p>1.能够提供网站访问服务的机器就是网站服务器，它能够接收客户端的请求，能够对请求做出响应。</p>
<h3 id="3-IP地址"><a href="#3-IP地址" class="headerlink" title="3. IP地址"></a>3. IP地址</h3><p>1.互联网中设备的唯一标识。<br>IP是Internet Protocol Address的简写，代表互联网协议地址.</p>
<h3 id="4-域名"><a href="#4-域名" class="headerlink" title="4. 域名"></a>4. 域名</h3><p>由于IP地址难于记忆，所以产生了域名的概念，所谓域名就是平时上网所使用的网址。</p>
<p><a target="_blank" rel="noopener" href="http://www.itheima.com">http://www.itheima.com</a>  =&gt;  <a target="_blank" rel="noopener" href="http://124.165.219.100/">http://124.165.219.100/</a><br>虽然在地址栏中输入的是网址, 但是最终还是会将域名转换为ip才能访问到指定的网站服务器。</p>
<h3 id="5-端口"><a href="#5-端口" class="headerlink" title="5. 端口"></a>5. 端口</h3><p>1.端口是计算机与外界通讯交流的出口，用来区分服务器电脑中提供的不同的服务。</p>
<ul>
<li>请求服务，邮件服务，文件服务，上传下载服务；</li>
</ul>
<p>2.当用IP找到服务器，端口就来区分你要的服务；</p>
<h3 id="6-URL"><a href="#6-URL" class="headerlink" title="6. URL"></a>6. URL</h3><p>1.统一资源定位符，又叫URL（Uniform Resource Locator），是专为标识Internet网上资源位置而设的一种编址方式，我们平时所说的网页地址指的即是URL。</p>
<h4 id="6-2-URL的组成"><a href="#6-2-URL的组成" class="headerlink" title="6.2 URL的组成"></a>6.2 URL的组成</h4><p>1.传输协议://服务器IP或域名:端口/资源所在位置标识</p>
<ul>
<li>为什么一般我们自己没写端口，浏览器默认添加一个80端口</li>
</ul>
<p>2.==http:==//<a target="_blank" rel="noopener" href="http://www.itcast.cn">www.itcast.cn</a> ==/news/20181018/09152238514.html==</p>
<p>3.http：超文本传输协议，提供了一种发布和接收HTML页面的方法。</p>
<ul>
<li>简单了解</li>
</ul>
<p>4.重温；2021-5-11 11:17:55</p>
<ul>
<li>1.在原生node.js里面，的文档，讲解new Url的时候。有更多的信息；</li>
<li><a target="_blank" rel="noopener" href="http://nodejs.cn/api/url.html#url_url_strings_and_url_objects">http://nodejs.cn/api/url.html#url_url_strings_and_url_objects</a></li>
</ul>
<p>4.1 URL 字符串是结构化的字符串，包含多个含义不同的组成部分。 解析字符串后返回的 URL 对象，每个属性对应字符串的各个组成部分。</p>
<p><code>url</code> 模块提供了两套 API 来处理 URL：一个是旧版本传统的 API，一个是实现了 <a target="_blank" rel="noopener" href="http://url.nodejs.cn/fKgW8d">WHATWG标准</a>的新 API。</p>
<p>WHATWG 的 API 与传统的 API 的区别如下。 在下图中，URL <code>&#39;http://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash&#39;</code> 上方的是传统的 <code>url.parse()</code> 返回的对象的属性。 下方的则是 WHATWG 的 <code>URL</code> 对象的属性。</p>
<p><img src="../../img/15/56.png" alt="26"></p>
<p>4.2 protocol 是协议，不翻译，我能猜中；</p>
<ul>
<li>1.auth是？</li>
<li>2.host[^27]<ul>
<li>1.<strong>Host</strong> 请求头指明了请求将要发送到的服务器主机名和端口号。</li>
<li>2.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Host">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Host</a></li>
</ul>
</li>
</ul>
<h3 id="7-开发过程中客户端和服务器端说明"><a href="#7-开发过程中客户端和服务器端说明" class="headerlink" title="7. 开发过程中客户端和服务器端说明"></a>7. 开发过程中客户端和服务器端说明</h3><p>1.在开发阶段，客户端和服务器端使用同一台电脑，即开发人员电脑。</p>
<p><img src="../../img/15/26.png" alt="26"></p>
<p>2.本机域名：localhost<br>本地IP   ：127.0.0.1</p>
<ul>
<li>张三在自己的电脑里输入localhost，就访问了张三的主机。同理李四；</li>
</ul>
<hr>
<h2 id="3-2-创建web服务器"><a href="#3-2-创建web服务器" class="headerlink" title="3.2 创建web服务器"></a>3.2 创建web服务器</h2><p>1.示例代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 引用系统模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"> <span class="comment">// 创建web服务器</span></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"> <span class="comment">// 当客户端发送请求的时候</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="comment">//  响应</span></span><br><span class="line">      res.end(<span class="string">&#x27;&lt;h1&gt;hi, user&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> <span class="comment">// 监听3000端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;服务器已启动，监听3000端口，请访问 localhost:3000&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.1 在node.js中，创建服务器要用到系统模块http；</p>
<p>1.2 在这个http模块下有一个方法，createServer()。它返回的对象是：网站服务器对象；</p>
<p>1.3 我们如何用这个对象，接受与响应网站请求呢？</p>
<p>1.4 添加请求事件的语法是：服务器.on，on是添加事件的意思；</p>
<ul>
<li>1.第一个参数，是事件名称。</li>
<li>2.第二个参数，是，事件处理函数；</li>
<li>3.当请求来的时候，就会去执行这个事件处理函数；</li>
</ul>
<p>2.弄完后怎么访问？</p>
<ul>
<li>localhost:3000</li>
</ul>
<p>3.res.end，字面意思，最后的响应？</p>
<ul>
<li>重温：2021-4-22 13:46:22</li>
<li>2.请求结束后，返回this。具体可去node文档查看</li>
</ul>
<hr>
<h2 id="3-3-HTTP协议"><a href="#3-3-HTTP协议" class="headerlink" title="3.3 HTTP协议"></a>3.3 HTTP协议</h2><h3 id="1-HTTP协议的概念"><a href="#1-HTTP协议的概念" class="headerlink" title="1. HTTP协议的概念"></a>1. HTTP协议的概念</h3><p>1.超文本传输协议（英文：HyperText Transfer Protocol，缩写：HTTP）规定了如何从网站服务器传输超文本到本地浏览器，它基于客户端服务器架构工作，是客户端（用户）和服务器端（网站）请求和应答的标准。</p>
<p><img src="../../img/15/27.png" alt="27"></p>
<h3 id="2-报文"><a href="#2-报文" class="headerlink" title="2. 报文"></a>2. 报文</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=29&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=29&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.在HTTP请求和响应的过程中传递的数据块就叫报文，包括要传送的数据和一些附加信息，并且要遵守规定好的格式。</p>
<p><img src="../../img/15/28.png" alt="28"></p>
<p>2.比如登录账号密码，就是包含在请求报文里面</p>
<p>3.而登录是否成功，就包含在响应报文里面；</p>
<p>4.对开发人员来说，报文信息在哪里能看到？</p>
<ul>
<li>看视频；04.04~06.40</li>
<li>F12那里面</li>
</ul>
<h3 id="3-请求报文"><a href="#3-请求报文" class="headerlink" title="3. 请求报文"></a>3. 请求报文</h3><p>1.请求方式 （Request Method）</p>
<p>GET     请求数据<br>POST   发送数据</p>
<p>3.反正视频它开始了，post请求一般用表单。</p>
<ul>
<li>然后就开始建立了一个html</li>
</ul>
<p>3.1 想要获取接受到了什么请求（get，post）</p>
<ul>
<li><p>需要添加代码 req.method ，它返回的结果，就是请求方式，console.log可以打印</p>
</li>
<li><pre><code class="js"><span class="comment">// 用于创建网站服务器的模块</span>
<span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

<span class="comment">// app对象就是网站服务器对象</span>
<span class="keyword">const</span> app = http.createServer();

app.on(<span class="string">'request'</span>, (req, res) =&gt; &#123;
    <span class="comment">// 获取请求方式，req.method</span>
    <span class="built_in">console</span>.log(req.method);
    res.end(<span class="string">'&lt;h2&gt;sadasdasd&lt;/h2&gt;'</span>);
&#125;);

app.listen(<span class="number">3000</span>);
<span class="built_in">console</span>.log(<span class="string">'网站服务器启动成功'</span>);
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight coffeescript"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="number"&gt;3.2&lt;/span&gt; 不过这个，只有在命名行工具看到；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ &lt;span class="number"&gt;1.&lt;/span&gt;如果要前端看，只有用些&lt;span class="keyword"&gt;if&lt;/span&gt;返回值；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  ```&lt;span class="javascript"&gt;js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;span class="comment"&gt;// 用于创建网站服务器的模块&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;span class="keyword"&gt;const&lt;/span&gt; http = &lt;span class="built_in"&gt;require&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;http&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;span class="comment"&gt;// app对象就是网站服务器对象&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;span class="keyword"&gt;const&lt;/span&gt; app = http.createServer();&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  app.on(&lt;span class="string"&gt;&amp;#x27;request&amp;#x27;&lt;/span&gt;, &lt;span class="function"&gt;(&lt;span class="params"&gt;req, res&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;      &lt;span class="comment"&gt;// 获取请求方式，req.method&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;      &lt;span class="built_in"&gt;console&lt;/span&gt;.log(req.method);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;      &lt;span class="keyword"&gt;if&lt;/span&gt; (req.method == &lt;span class="string"&gt;&amp;#x27;POST&amp;#x27;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;          res.end(&lt;span class="string"&gt;&amp;#x27;post&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;      &amp;#125; &lt;span class="keyword"&gt;else&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; (req.method == &lt;span class="string"&gt;&amp;#x27;GET&amp;#x27;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;          res.end(&lt;span class="string"&gt;&amp;#x27;get&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;      &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  app.listen(&lt;span class="number"&gt;3000&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;span class="built_in"&gt;console&lt;/span&gt;.log(&lt;span class="string"&gt;&amp;#x27;网站服务器启动成功&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;


</code></pre>
</li>
</ul>
<p>4.如果直接回车：<a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000/</a></p>
<ul>
<li>是get请求；</li>
</ul>
<p>4.1 从表单那边，点击。页面会显示post请求；</p>
<ul>
<li>当然也是因为写了method属性的值，写的是post；2021-5-10 11:05:40</li>
</ul>
<h4 id="3-2-req-on"><a href="#3-2-req-on" class="headerlink" title="3.2 req.on"></a>3.2 req.on</h4><p>1.上面是app.on；</p>
<ul>
<li>app = http.createServer();</li>
</ul>
<p>请求操作？当客户端有请求来的时候，干啥</p>
<p>看文档，2021-4-22 13:49:04</p>
<p>算了，俺去把链接弄来；</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/http.html#http_http_createserver_options_requestlistener">http://nodejs.cn/api/http.html#http_http_createserver_options_requestlistener</a></p>
</blockquote>
<p>2.好像现在变了，把on加在<code>http.createServer()</code>里面了；</p>
<img src="../../img/15/53.png" alt="53" style="zoom:80%;" />

<p>2.1 说明on是有的，去找找文档里面；</p>
<ul>
<li>用.on搜索查看</li>
<li>查不到；</li>
</ul>
<h3 id="4-req-url请求地址"><a href="#4-req-url请求地址" class="headerlink" title="4. req.url请求地址"></a>4. req.url请求地址</h3><p>0.请求地址，就是端口后面的地址，是需要输入的</p>
<ul>
<li>例如：<a target="_blank" rel="noopener" href="http://localhost:3000/index">http://localhost:3000/index</a></li>
<li>那么req.url == /index<ul>
<li>/也是哦</li>
</ul>
</li>
</ul>
<p>0.1 这个时候，我们被这个假象骗住了。</p>
<ul>
<li>其实req.url下面有很多东西，只是目前只有/index；</li>
</ul>
<p>0.2 假如是这样的url：<a target="_blank" rel="noopener" href="http://localhost:3000/index?name=123&amp;password=3213">http://localhost:3000/index?name=123&amp;password=3213</a></p>
<ul>
<li>返回值：/index?name=123&amp;password=3213</li>
<li>如果需要单独拿到/index，是需要拿到一个叫pathname属性的值；在3.4-2那里；</li>
</ul>
<p>0.3 总结：</p>
<p>得到地址+get获取的参数</p>
<p>1.现在无论在域名后面加什么地址，都是get。</p>
<p>2.如何在后面加一个index，可以返回首页呢?</p>
<ul>
<li>例如：<a target="_blank" rel="noopener" href="http://localhost:3000/index">http://localhost:3000/index</a></li>
</ul>
<p>3.请求地址 （Request URL）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    req.headers  <span class="comment">// 获取请求报文</span></span><br><span class="line">    req.url      <span class="comment">// 获取请求地址</span></span><br><span class="line">    req.method   <span class="comment">// 获取请求方法</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>req.headers  // 获取请求报文</li>
<li>console.log(req.headers[‘accept’]);</li>
</ul>
<p>4.这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取请求地址</span></span><br><span class="line">    <span class="comment">// req.url</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;请求地址：&#x27;</span> + req.url);</span><br><span class="line">    <span class="keyword">if</span> (req.url == <span class="string">&#x27;/index&#x27;</span>) &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;Welcome to home&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;welcome to listpage&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;not found&#x27;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后又tm出错；</li>
</ul>
<p>4.1 视频里面，可以几个地址连着跳。</p>
<ul>
<li>1.我连着跳就是报错：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">events.js:<span class="number">292</span></span><br><span class="line">      <span class="keyword">throw</span> er; <span class="comment">// Unhandled &#x27;error&#x27; event</span></span><br><span class="line">      ^</span><br><span class="line"></span><br><span class="line"><span class="built_in">Error</span> [ERR_STREAM_WRITE_AFTER_END]: write after end</span><br><span class="line">    at writeAfterEnd (_http_outgoing.js:<span class="number">668</span>:<span class="number">15</span>)</span><br><span class="line">    at ServerResponse.end (_http_outgoing.js:<span class="number">789</span>:<span class="number">7</span>)</span><br><span class="line">    at Server.&lt;anonymous&gt; (F:\三次元\<span class="number">4</span>-学习\<span class="number">7</span>-web\<span class="number">5</span>-node.js\<span class="number">1</span>-练习\<span class="number">4</span>-server\app.js:<span class="number">25</span>:<span class="number">13</span>)</span><br><span class="line">    at Server.emit (events.js:<span class="number">315</span>:<span class="number">20</span>)</span><br><span class="line">    at parserOnIncoming (_http_server.js:<span class="number">874</span>:<span class="number">12</span>)</span><br><span class="line">    at HTTPParser.parserOnHeadersComplete (_http_common.js:<span class="number">126</span>:<span class="number">17</span>)</span><br><span class="line">Emitted <span class="string">&#x27;error&#x27;</span> event on ServerResponse instance at:</span><br><span class="line">    at writeAfterEndNT (_http_outgoing.js:<span class="number">727</span>:<span class="number">7</span>)</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:<span class="number">81</span>:<span class="number">21</span>) &#123;</span><br><span class="line">  code: <span class="string">&#x27;ERR_STREAM_WRITE_AFTER_END&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2.看起来像是，结束后写入？res.end后，就不能请求了，大概是这个意思；</li>
<li>3.估计又是狗逼的资料过期了；2021-4-14 21:13:57</li>
</ul>
<p>4.2 OK，我尝试去看文档，看不懂的很多，很上面的gulp一样；</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=30&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=30&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>5.想起了return，可以终止函数，if里面是否可以呢？</p>
<p>可以；2021-4-15 10:11:57</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.url == <span class="string">&#x27;/index&#x27;</span> || req.url == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Welcome to home&#x27;</span>);</span><br><span class="line">        res.end(<span class="string">&#x27;老李你过来呀&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;welcome to listpage&#x27;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-res-end报错"><a href="#5-res-end报错" class="headerlink" title="5. res.end报错"></a>5. res.end报错</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_51608940/article/details/112913296">https://blog.csdn.net/m0_51608940/article/details/112913296</a></p>
</blockquote>
<p>1.上面思考了那么多，我居然没发现这一步？</p>
<p>2.不可能，我看到 write after end，后我就在想是不是end后面在写入什么？</p>
<p>3.我第一个实验就是把外面的res.on去掉。</p>
<ul>
<li>可能是我记错了？2021-4-21 14:05:56</li>
</ul>
<hr>
<h3 id="6-响应报文"><a href="#6-响应报文" class="headerlink" title="6. 响应报文"></a>6. 响应报文</h3><p>1.HTTP状态码</p>
<p>200 请求成功<br>404 请求的资源没有被找到<br>500 服务器端错误<br>400 客户端请求有语法错误</p>
<p>2.内容类型</p>
<p>text/html ； 如果返回的是一个html文件，就要输入text/html，有这个text/；</p>
<p>text/css</p>
<p>text/plain：纯文本；</p>
<p>application/javascript<br>image/jpeg<br>application/json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 设置响应报文</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html;charset=utf8‘</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>res.writeHead，书写响应头。</p>
<ul>
<li>第一个参数是状态码。如果不写，默认200</li>
</ul>
</li>
<li><p>2.Content-Type，内容-类型；</p>
</li>
</ul>
<h4 id="6-2-乱码"><a href="#6-2-乱码" class="headerlink" title="6.2 乱码"></a>6.2 乱码</h4><p>1.中文会乱码，需要设置响应报文头的 字符：charset=utf8</p>
<hr>
<h2 id="3-4-HTTP请求与响应处理"><a href="#3-4-HTTP请求与响应处理" class="headerlink" title="3.4 HTTP请求与响应处理"></a>3.4 HTTP请求与响应处理</h2><h3 id="1-请求参数"><a href="#1-请求参数" class="headerlink" title="1. 请求参数"></a>1. 请求参数</h3><p>1.客户端向服务器端发送请求时，有时需要携带一些客户信息，客户信息需要通过请求参数的形式传递到服务器端，比如登录操作。</p>
<h3 id="2-GET请求参数"><a href="#2-GET请求参数" class="headerlink" title="2. GET请求参数"></a>2. GET请求参数</h3><p>参数被放置在浏览器地址栏中，例如：<a target="_blank" rel="noopener" href="http://localhost:3000/?name=zhangsan&amp;age=20">http://localhost:3000/?name=zhangsan&amp;age=20</a><br>参数获取需要借助系统模块url，url模块用来处理url地址</p>
<ul>
<li>问号，后面就是请求的参数</li>
</ul>
<h4 id="2-1-url-parse"><a href="#2-1-url-parse" class="headerlink" title="2.1 url.parse"></a>2.1 url.parse</h4><p>1.建议：先看新方法，然后再看旧方法；</p>
<p>2.如何获取到这个参数？</p>
<ul>
<li><p>1.在node里面，有一种模块叫内置模块。</p>
</li>
<li><p>2.而这里面有一个叫url的内置模块。用于处理url地址；</p>
</li>
<li><p>3.url有一个解析的方法：url.parse。</p>
<ul>
<li>3.1 它都够把url转换成对象的形式；</li>
<li>url.parse(req.url)；转换请求地址</li>
</ul>
</li>
<li><p>3.1 我当初就没写个例如吗？c；</p>
<ul>
<li><p>1.例如：<a target="_blank" rel="noopener" href="http://localhost:3000/?name=zhangsan&amp;age=20">http://localhost:3000/?name=zhangsan&amp;age=20</a></p>
</li>
<li><p>2.如果console.log(req.url);</p>
<ul>
<li>打印出的是：/?name=zsadsad&amp;age=2312</li>
<li>打印出的是<a href="http://localhost:3000后面的东西">http://localhost:3000后面的东西</a></li>
</ul>
</li>
<li><p>3.如果是console.log(url.parse(req.url));</p>
<ul>
<li><p>那么打印出来的是：一个对象</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Url</span> &#123;</span><br><span class="line">  <span class="attr">protocol:</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">slashes:</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">auth:</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">host:</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">port:</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">hostname:</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">hash:</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">search:</span> <span class="string">&#x27;?name=zsadsad&amp;age=2312&#x27;</span>,</span><br><span class="line">  <span class="attr">query:</span> <span class="string">&#x27;name=zsadsad&amp;age=2312&#x27;</span>,</span><br><span class="line">  <span class="attr">pathname:</span> <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">path:</span> <span class="string">&#x27;/?name=zsadsad&amp;age=2312&#x27;</span>,</span><br><span class="line">  <span class="attr">href:</span> <span class="string">&#x27;/?name=zsadsad&amp;age=2312&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>2.1 不过现在这个方法已经被弃用了；</p>
<h5 id="1-url-query"><a href="#1-url-query" class="headerlink" title="1.url.query"></a>1.url.query</h5><p>0.query，是保存，存get获得的请求参数，没有那个？问号；</p>
<p>1.不过，只是url.query，还不是对象的格式</p>
<ul>
<li>是这样的：name=zhang&amp;age=20</li>
<li>无法使用对象的语法<ul>
<li>例如：query.name</li>
<li>无法取得zhang</li>
</ul>
</li>
</ul>
<p>1.1 要想使用query.name，也得使用url.parse转换它</p>
<ul>
<li>而它的转换，可以和req.url一起；在后面写个true就可以了</li>
</ul>
<p><code>url.parse(req.url,true)；</code></p>
<p>2.猜想：如果这样，可以吗？</p>
<ul>
<li>1.先转换req.url：url.parse(req.url)</li>
<li>2.用一个变量存储：let my_url = url.parse(req.url)</li>
<li>3.然后 my_url是对象的格式了</li>
<li>4.接着转换url.parse(my_url)；</li>
<li>5.可以试验一下；</li>
</ul>
<p>2.1 kao，笔记没有写实验结果吗？2021-5-10 11:11:51</p>
<p>3.不过url.parse被弃用了。如果使用新的方法怎么写？</p>
<ul>
<li>4.即使这样，也不够好看，里面的值连在一起；（视频里称为，查询参数）</li>
<li>4.1 写入第二个参数，true；<ul>
<li>url.parse(req.url,true)；</li>
<li>会把url里面一个叫query的值，变成对象的形式；<ul>
<li>以前：name=zhang&amp;age=20</li>
<li>现在: query: [Object: null prototype] { name: ‘zhang’, age: ‘20’ },</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>3.总结：</p>
<p>4.有必要去文档那边看看：url.parse</p>
<h5 id="2-弃用了怎办"><a href="#2-弃用了怎办" class="headerlink" title="2. 弃用了怎办"></a>2. 弃用了怎办</h5><p>1.首先找到url.parse，然后被弃用了</p>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/url.html#url_url_parse_urlstring_parsequerystring_slashesdenotehost">http://nodejs.cn/api/url.html#url_url_parse_urlstring_parsequerystring_slashesdenotehost</a></p>
<ul>
<li>1.被弃用了，也不说代替它的新方法</li>
</ul>
<p>2.找啊找，找到了一个好像是的：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/url.html#url_url_strings_and_url_objects">http://nodejs.cn/api/url.html#url_url_strings_and_url_objects</a></p>
</blockquote>
<ul>
<li>1.下面还有好多url接口的方法</li>
</ul>
<p>2.1 如果要用新方法。要使用<code>new URL(input[, base])</code>的格式</p>
<blockquote>
<p>base<br>英 [beɪs]   美 [beɪs]<br>n.根基;基底;底座;根据;出发点;(支持、收入、力量等的)来源，源泉，基础<br>v.以…为据点(或总部等);把(总部等)设在<br>adj.卑鄙的;不道德的</p>
</blockquote>
<ul>
<li><p>1.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> pathname = req.url;</span><br><span class="line">    <span class="keyword">let</span> myURL = <span class="keyword">new</span> URL(pathname, <span class="string">&#x27;http://localhost:3000&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(url.parse(pathname));</span><br><span class="line">    <span class="built_in">console</span>.log(myURL);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;服务器已启动，监听3000端口&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.而格式new URL(input[, base])，可看这里</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/url.html#url_new_url_input_base">http://nodejs.cn/api/url.html#url_new_url_input_base</a></p>
</blockquote>
</li>
</ul>
<p>2.2 返回结果：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">URL &#123;</span><br><span class="line">  href: <span class="string">&#x27;http://localhost:3000/list&#x27;</span>,</span><br><span class="line">  origin: <span class="string">&#x27;http://localhost:3000&#x27;</span>,</span><br><span class="line">  protoco<span class="variable">l:</span> <span class="string">&#x27;http:&#x27;</span>,</span><br><span class="line">  username: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  password: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  hos<span class="variable">t:</span> <span class="string">&#x27;localhost:3000&#x27;</span>,</span><br><span class="line">  <span class="built_in">hostname</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  por<span class="variable">t:</span> <span class="string">&#x27;3000&#x27;</span>,</span><br><span class="line">  pathname: <span class="string">&#x27;/list&#x27;</span>,</span><br><span class="line">  <span class="built_in">search</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  searchParam<span class="variable">s:</span> URLSearchParams &#123;&#125;,</span><br><span class="line">  hash: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">/<span class="keyword">list</span></span><br><span class="line">URL &#123;</span><br><span class="line">  href: <span class="string">&#x27;http://localhost:3000/list?username=lijie&amp;password=123123&#x27;</span>,</span><br><span class="line">  origin: <span class="string">&#x27;http://localhost:3000&#x27;</span>,</span><br><span class="line">  protoco<span class="variable">l:</span> <span class="string">&#x27;http:&#x27;</span>,</span><br><span class="line">  username: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  password: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  hos<span class="variable">t:</span> <span class="string">&#x27;localhost:3000&#x27;</span>,</span><br><span class="line">  <span class="built_in">hostname</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  por<span class="variable">t:</span> <span class="string">&#x27;3000&#x27;</span>,</span><br><span class="line">  pathname: <span class="string">&#x27;/list&#x27;</span>,</span><br><span class="line">  <span class="built_in">search</span>: <span class="string">&#x27;?username=lijie&amp;password=123123&#x27;</span>,</span><br><span class="line">  searchParam<span class="variable">s:</span> URLSearchParams &#123; <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;lijie&#x27;</span>, <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;123123&#x27;</span> &#125;,</span><br><span class="line">  hash: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2.3 因为新方法里面有一个searchParams，所以用不到query了</p>
<p>3.如何得到searchParams里面的URLSearchParams的username的值</p>
<ul>
<li>也就是说，直接得到 lijie</li>
</ul>
<p>3.1 在文档中，找到的了办法</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/url.html#url_urlsearchparams_get_name">http://nodejs.cn/api/url.html#url_urlsearchparams_get_name</a></p>
</blockquote>
<ul>
<li><p>1.urlSearchParams.get(name)</p>
<ul>
<li>searchParams.get(‘name’);也行，上面那个需要加引号不？</li>
<li>2021-4-23 15:52:24</li>
</ul>
</li>
<li><p>代码：可以去2.2 pathname下面的 第四点去看；</p>
</li>
</ul>
<h4 id="2-2-pathname"><a href="#2-2-pathname" class="headerlink" title="2.2 pathname"></a>2.2 pathname</h4><p>1.pathname,是请求地址里面的一个参数：</p>
<p><img src="../../img/15/29.png" alt="29"></p>
<p>4.获取的请求地址，也要改变写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取请求地址</span></span><br><span class="line">    <span class="comment">// req.url</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;请求地址：&#x27;</span> + req.url);</span><br><span class="line">    <span class="keyword">if</span> (req.url == <span class="string">&#x27;/index&#x27;</span>) &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;Welcome to home&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;welcome to listpage&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;not found&#x27;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>变为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理url地址</span></span><br><span class="line"><span class="built_in">console</span>.log(req.url);</span><br><span class="line"><span class="keyword">let</span> &#123; query, pathname &#125; = (url.parse(req.url, <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pathname == <span class="string">&#x27;/index&#x27;</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;Welcome to home&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;welcome to listpage&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-POST请求参数"><a href="#3-POST请求参数" class="headerlink" title="3. POST请求参数"></a>3. POST请求参数</h3><p>1.post的请求参数，不在url中，而在报文中；</p>
<p>2.在form.html那边写好html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://localhost:3000&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3.// 如何接收post参数呢？因为post参数没有存储在url里面，所以req.url是不行的</p>
<p>  // 1.post参数是通过事件的方式接收的，data，end；</p>
<p>3.1 理论上，post可以无限数据。为了减轻服务器压力。对于post的请求，不是一次性接收完。</p>
<ul>
<li>date，当请求参数传递的时候，发data事件；</li>
<li>end，当参数传递完成的时候，发end事件；</li>
</ul>
<p>3.2 那么给谁去绑定这个事件呢？</p>
<ul>
<li>请求参数，是与请求有关的信息，我们首先去找req</li>
</ul>
<p>3.3 在req上面绑定这两个事件；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>3.4 然后是接受post参数</p>
<ul>
<li>1.因为post参数，不是一次接收完。</li>
<li>2.我们需要申明一个变量，默认值是空<ul>
<li>1.当data事件发生的时候，也就是请求参数传递的时候，我们需要把一次次接收到的参数，拼接在一起。</li>
<li>2.然后在end事件的时候，也就是data完成的时候。<ul>
<li>肯定的拼接也完成了</li>
<li>输出这个变量；</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>let post_params = &#39;&#39;;</code></p>
<ul>
<li><p>3.接着，在data事件里面，拼接接收的东西。</p>
<ul>
<li><p>1.在data事件的回调函数里面，有一个参数，我们可以写成params(百度翻译就一个<code>参数</code>的含义)</p>
<p><code>req.on(&#39;data&#39;, params =&gt; &#123;&#125;)</code></p>
</li>
<li><p>2.这个params，就是当时传递过来的参数。</p>
<ul>
<li>1.一个个的传，例如：’<a target="_blank" rel="noopener" href="http://localhost:3000/list?username=lijie&amp;password=123123&#39;">http://localhost:3000/list?username=lijie&amp;password=123123&#39;</a></li>
<li>2.可能是username=lijie，password=123123</li>
<li>3.一般拼接，就是直接在一起：username=lijiepassword=123123。</li>
<li>4.它这里肯定是做了处理，是用&amp;链接在一起；</li>
</ul>
</li>
<li><p>3.然后拼接</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">    post_params += params;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<ul>
<li><p>4.接着，在end里面输出这个变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(post_params);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>5.最后加个res.on</p>
</li>
<li><p>6.查看打印结果：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=<span class="number">123</span>&amp;password=<span class="number">3213</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>3.5 总代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// post参数是通过事件的方式接受的</span></span><br><span class="line">    <span class="comment">// 分别是data事件和end事件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> post_params = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">        post_params += params;</span><br><span class="line">    &#125;)</span><br><span class="line">    req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(querystring.parse(post_params).username);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    res.end(<span class="string">&#x27;wanbi&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;服务器已启动，监听3000端口&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>4.虽然能获取到username=lijie&amp;password=123123</p>
<ul>
<li><p>0.如果你在想，为什么不用query，那是因为这里是post，上面那个是get请求；</p>
</li>
<li><p>1.但仍需要转换成对象的形式，这里无法使用req.url。需要新的办法；</p>
</li>
<li><p>2.引入querystring；query：疑问；加起来就是疑问字符串，难道就是？后面的字符串？</p>
</li>
</ul>
<p><code>const querystring = require(&#39;querystring&#39;);</code></p>
<ul>
<li>这个可以获得post请求的存请求参数；</li>
</ul>
<p>4.1 然后在post的end事件里面加代码，parse转换成对象</p>
<ul>
<li>看来就url.parse弃用了。可能是因为get没post安全，所以post这边的parse没弃用；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(querystring.parse(post_params));</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>打印出来的结果：</li>
</ul>
<p><code>[Object: null prototype] &#123; username: &#39;23123&#39;, password: &#39;123123&#39; &#125;</code></p>
<p>4.2 这样就能获得到username的值：</p>
<ul>
<li>这样写即可：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> post_query = querystring.parse(post_params);</span><br><span class="line"><span class="keyword">let</span> username = post_query.username;</span><br></pre></td></tr></table></figure>





<p>==搞错了，搞错了==，下面这个是基于req.url的，而post无法使用req.url</p>
<ul>
<li>1.不对，又不对。是写在判断之前的。也许能行；</li>
</ul>
<p><img src="../../img/15/54.png" alt="54"></p>
<p>4.2 这个结果，和用 URL的 searchParams是一样</p>
<ul>
<li><p>1.代码没有保存；</p>
</li>
<li><p>去找找打印出的值</p>
<p><code>URLSearchParams &#123; &#39;username&#39; =&gt; &#39;lijie&#39;, &#39;password&#39; =&gt; &#39;123123&#39; &#125;</code></p>
</li>
<li><p>2.还是不一样，querystring打印出来的，是可以用对象的语法单独打印出username的</p>
<ul>
<li><p>1.代码：</p>
<p><code>console.log(querystring.parse(post_params).username);</code></p>
</li>
<li><p>2.打印结果：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">服务器已启动，监听3000端口</span><br><span class="line"><span class="selector-attr">[Object: null prototype]</span> &#123; <span class="attribute">username</span>: <span class="string">&#x27;23123&#x27;</span>, password: <span class="string">&#x27;123123&#x27;</span> &#125;</span><br><span class="line"><span class="selector-attr">[Object: null prototype]</span> &#123;&#125;</span><br><span class="line"><span class="selector-attr">[nodemon]</span> <span class="selector-tag">restarting</span> <span class="selector-tag">due</span> <span class="selector-tag">to</span> <span class="selector-tag">changes</span>...</span><br><span class="line"><span class="selector-attr">[nodemon]</span> <span class="selector-tag">starting</span> `<span class="selector-tag">node</span> .\<span class="selector-tag">app</span><span class="selector-class">.js</span>`</span><br><span class="line">服务器已启动，监听3000端口</span><br><span class="line">23123</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>3.而URL的 searchParams，是不行的。那么如何能行呢？</p>
<ul>
<li><p>在文档中，找到了办法：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/url.html#url_class_urlsearchparams">http://nodejs.cn/api/url.html#url_class_urlsearchparams</a></p>
</blockquote>
</li>
<li><p><code>console.log(searchParams.get(&quot;username&quot;));</code></p>
</li>
<li><p>用get</p>
</li>
</ul>
</li>
<li><p>4.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> myURL = <span class="keyword">new</span> URL(req.url, <span class="string">&#x27;http://localhost:3000&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> parse_url = url.parse(req.url);</span><br><span class="line">    <span class="keyword">let</span> &#123; pathname, searchParams &#125; = myURL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pathname == <span class="string">&#x27;/index&#x27;</span>) &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;Welcome to home&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(myURL)<span class="comment">//1.得到url对象的格式，新方法</span></span><br><span class="line">        <span class="built_in">console</span>.log(parse_url)<span class="comment">//2.以前的，可以与1比较</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.直接对象解构，从新方法里面拿</span></span><br><span class="line">        <span class="built_in">console</span>.log(pathname)</span><br><span class="line">        <span class="built_in">console</span>.log(searchParams);</span><br><span class="line">        <span class="comment">// 4.直接拿老方法里面需要query成为对象的值</span></span><br><span class="line">        <span class="built_in">console</span>.log(searchParams.get(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">typeof</span> searchParams);</span><br><span class="line">        res.end(<span class="string">&#x27;welcome to listpage&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">30030</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;服务器已启动，监听30030端口&#x27;</span>);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>5.总结：</p>
<p>参数被放置在请求体中进行传输</p>
<ul>
<li>请求体=请求报文；</li>
</ul>
<p>获取POST参数需要使用data事件和end事件</p>
<p>使用querystring系统模块将参数转换为对象格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入系统模块querystring 用于将HTTP参数转换为对象格式</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> postData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 监听参数传输事件</span></span><br><span class="line">    req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> postData += chunk;);</span><br><span class="line">    <span class="comment">// 监听参数传输完毕事件</span></span><br><span class="line">    req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123; </span><br><span class="line">        <span class="built_in">console</span>.log(querystring.parse(postData)); </span><br><span class="line">    &#125;); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="5-静态资"><a href="#5-静态资" class="headerlink" title="5. 静态资"></a>5. 静态资</h3><p>1.服务器端不需要处理，可以直接响应给客户端的资源就是静态资源，例如CSS、JavaScript、image文件。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.itcast.cn/images/logo.png">http://www.itcast.cn/images/logo.png</a></li>
</ul>
<p>2.开始了开始了；</p>
<h4 id="5-1-创建"><a href="#5-1-创建" class="headerlink" title="5.1 创建"></a>5.1 创建</h4><p>0.从后面回来复习的我，不忍心；在后面这些全都要被推翻；2021-5-10 11:35:26</p>
<p>1.准备前端代码，app.js创建本地服务器；go</p>
<p>2.先把路径改了，xx/index.html  改成 index.html</p>
<ul>
<li><p>1.获取请求路径；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> pathname = url.parse(req.url).pathname;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.修改路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line">path.join(__dirname, <span class="string">&#x27;public&#x27;</span> + pathname);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>2.1 引入path，它能自动分析加什么斜杠</p>
</li>
<li><p><code>__dirname，是当前文件的绝对路径</code>，没错，这里要改成绝对路径</p>
</li>
<li><p>这样就是app.js的绝对路径+public，+pathname（请求的路径名）</p>
<p><img src="../../img/15/30.png" alt="30"></p>
</li>
<li><p>2.2 <code>__dirname</code>是一个动态的，5-static换到哪里，就获取到那里的绝对路径；</p>
</li>
</ul>
</li>
</ul>
<p>3.如果在上面写入了响应报文，就css也解析成文本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;charset=utf8&#x27;</span>,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<p>4.总代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建静态服务器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// 这个可以获取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应请求</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应报文设置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取用户的请求路径</span></span><br><span class="line">    <span class="keyword">let</span> pathname = url.parse(req.url).pathname;</span><br><span class="line">    <span class="comment">// 将用户的请求路径转换为实际的服务器硬盘路径</span></span><br><span class="line">    <span class="keyword">let</span> requestPath = path.join(__dirname, <span class="string">&#x27;public&#x27;</span> + pathname);</span><br><span class="line"></span><br><span class="line">    fs.readFile(requestPath, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err != <span class="literal">null</span>) &#123;</span><br><span class="line">            res.end(<span class="string">&#x27;文件读取失败,当前路径是&#x27;</span> + requestPath);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            res.end(result);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// res.end(requestPath);</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h4 id="5-2-继续完善"><a href="#5-2-继续完善" class="headerlink" title="5.2 继续完善"></a>5.2 继续完善</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=35&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=35&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<h5 id="1-让localhost-端口号。直接访问某个页面；"><a href="#1-让localhost-端口号。直接访问某个页面；" class="headerlink" title="1. 让localhost:端口号。直接访问某个页面；"></a>1. 让localhost:端口号。直接访问某个页面；</h5><p>2021-4-15 16:19:15</p>
<p>2.做一个判断</p>
<p><code>pathname == &#39;/&#39; ? &#39;/default.html&#39; : pathname;</code></p>
<p>2.1 实验；</p>
<p>错误；</p>
<p>2.2 代码错了：<code>pathname = pathname == &#39;/&#39; ? &#39;/default.html&#39; : pathname;</code></p>
<h5 id="2-添加响应报文"><a href="#2-添加响应报文" class="headerlink" title="2.添加响应报文"></a>2.添加响应报文</h5><p>1.当服务器端向客户端做出响应的时候，我们要告诉客户端，我们给你的资源的类型是什么。</p>
<p>2.但会遇到问题；</p>
<ul>
<li>1.html里面会有外链文件。css，js，img等；</li>
<li>2.当请求遇到这些代码，会自动请求这些外链东西</li>
<li>3.当前是用fs.readFile读取的文件；<ul>
<li>每次读取，可能是html，css，img，txt；等等</li>
<li>那么你写什么类型呢？</li>
<li>不知道有什么类型；</li>
</ul>
</li>
<li>4.所以这里不能写固定的，需要写动态的；</li>
</ul>
<p>3.如果根据当前请求的文件类型，而设置响应的类型呢？</p>
<ul>
<li>1.需要做第三方模块；</li>
<li>2.MIME。它可以根据当前的请求路径，分析出资源的类型，<ul>
<li>通过返回值的方式，把类型返回给你；</li>
</ul>
</li>
</ul>
<h6 id="2-4-使用MIME"><a href="#2-4-使用MIME" class="headerlink" title="2.4 使用MIME"></a>2.4 使用MIME</h6><p>1.下载：npm install mime</p>
<p>2.重新开启服务器，nodemon app.js</p>
<p>3.引入：<code>const mime = require(&#39;mime&#39;);</code></p>
<p>4.在这个模块下面，有一个方法：mime.getType()</p>
<p>5.然后把路径传进去，它根据路径返回这个资源的类型；</p>
<ul>
<li>mime.getType(路径)</li>
</ul>
<p>6.创建变量，存储这些返回值；</p>
<ul>
<li>let requestType = mime.getType(pathname);</li>
</ul>
<p>7.成功的时候使用：</p>
<ul>
<li><pre><code class="js"><span class="keyword">else</span> &#123;
    res.writeHead(<span class="number">200</span>, &#123;
        <span class="string">'content-type'</span>: requestType
    &#125;)
    res.end(result);
    <span class="keyword">return</span>;
&#125;
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight coffeescript"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;59&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="number"&gt;8.&lt;/span&gt;我们刷新页面&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ &lt;span class="number"&gt;1.&lt;/span&gt;在F12的Network里面点击Name，查看 Response Headers&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  + &lt;span class="number"&gt;1.1&lt;/span&gt; 可以看到，不同类型文件的 content-type也是不一样的。&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  + 是对应的&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ &lt;span class="number"&gt;2.&lt;/span&gt;如果不写，没问题，但是，是隐患。且需要解决；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;总代码：&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;```&lt;span class="javascript"&gt;js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="comment"&gt;// 创建静态服务器&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="keyword"&gt;const&lt;/span&gt; http = &lt;span class="built_in"&gt;require&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;http&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="keyword"&gt;const&lt;/span&gt; url = &lt;span class="built_in"&gt;require&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;url&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="keyword"&gt;const&lt;/span&gt; app = http.createServer();&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="keyword"&gt;const&lt;/span&gt; path = &lt;span class="built_in"&gt;require&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;path&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="keyword"&gt;const&lt;/span&gt; mime = &lt;span class="built_in"&gt;require&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;mime&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="comment"&gt;// 这个可以获取文件&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="keyword"&gt;const&lt;/span&gt; fs = &lt;span class="built_in"&gt;require&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;fs&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="comment"&gt;// 响应请求&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;app.on(&lt;span class="string"&gt;&amp;#x27;request&amp;#x27;&lt;/span&gt;, &lt;span class="function"&gt;(&lt;span class="params"&gt;req, res&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    &lt;span class="comment"&gt;// 响应报文设置&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    &lt;span class="comment"&gt;// 获取用户的请求路径&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    &lt;span class="keyword"&gt;let&lt;/span&gt; pathname = url.parse(req.url).pathname;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    pathname = pathname == &lt;span class="string"&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt; ? &lt;span class="string"&gt;&amp;#x27;/default.html&amp;#x27;&lt;/span&gt; : pathname;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    &lt;span class="comment"&gt;// 将用户的请求路径转换为实际的服务器硬盘路径&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    &lt;span class="keyword"&gt;let&lt;/span&gt; requestPath = path.join(__dirname, &lt;span class="string"&gt;&amp;#x27;public&amp;#x27;&lt;/span&gt; + pathname);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    &lt;span class="keyword"&gt;let&lt;/span&gt; requestType = mime.getType(pathname);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    fs.readFile(requestPath, &lt;span class="function"&gt;(&lt;span class="params"&gt;err, result&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;        &lt;span class="keyword"&gt;if&lt;/span&gt; (err != &lt;span class="literal"&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;            res.writeHead(&lt;span class="number"&gt;404&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;                &lt;span class="string"&gt;&amp;#x27;content-type&amp;#x27;&lt;/span&gt;: &lt;span class="string"&gt;&amp;#x27;text/html;charset=utf8&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;            &amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;            res.end(&lt;span class="string"&gt;&amp;#x27;文件读取失败,当前路径是&amp;#x27;&lt;/span&gt; + requestPath);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;            &lt;span class="keyword"&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;        &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;        &lt;span class="keyword"&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;            res.writeHead(&lt;span class="number"&gt;200&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;                &lt;span class="string"&gt;&amp;#x27;content-type&amp;#x27;&lt;/span&gt;: requestType&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;            &amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;            res.end(result);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;            &lt;span class="keyword"&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;        &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    &amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;    &lt;span class="comment"&gt;// res.end(requestPath);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;app.listen(&lt;span class="number"&gt;3000&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;&lt;span class="built_in"&gt;console&lt;/span&gt;.log(&lt;span class="string"&gt;&amp;#x27;服务器启动成功&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;


</code></pre>
</li>
</ul>
<hr>
<h3 id="6-动态资源"><a href="#6-动态资源" class="headerlink" title="6. 动态资源"></a>6. 动态资源</h3><p>1.相同的请求地址不同的响应资源，这种资源就是动态资源。</p>
<ul>
<li><p>但是要用不同的参数</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.itcast.cn/article?id=1">http://www.itcast.cn/article?id=1</a><br><a target="_blank" rel="noopener" href="http://www.itcast.cn/article?id=2">http://www.itcast.cn/article?id=2</a></p>
</li>
</ul>
<h3 id="7-路由"><a href="#7-路由" class="headerlink" title="7. 路由"></a>7. 路由</h3><p><a target="_blank" rel="noopener" href="http://localhost:3000/index">http://localhost:3000/index</a><br><a target="_blank" rel="noopener" href="http://localhost:3000/login">http://localhost:3000/login</a><br>路由是指客户端请求地址与服务器端程序代码的对应关系。简单的说，就是请求什么响应什么。</p>
<img src="../../img/15/31.png" alt="31" style="zoom:80%;" />

<h4 id="7-1-实现路由的核心代码"><a href="#7-1-实现路由的核心代码" class="headerlink" title="7.1 实现路由的核心代码"></a>7.1 实现路由的核心代码</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当客户端发来请求的时候</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取客户端的请求路径</span></span><br><span class="line">    <span class="keyword">let</span> &#123; pathname &#125; = url.parse(req.url);</span><br><span class="line">    <span class="keyword">if</span> (pathname == <span class="string">&#x27;/&#x27;</span> || pathname == <span class="string">&#x27;/index&#x27;</span>) &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;欢迎来到首页&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">        res.end(<span class="string">&#x27;欢迎来到列表页页&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       res.end(<span class="string">&#x27;抱歉, 您访问的页面出游了&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>1.代码里面，缺少了对请求方式的判断。</p>
<ul>
<li>1.视频说，下次会加上，会说</li>
</ul>
<p>2.请求地址是什么？是由谁决定的呢？</p>
<ul>
<li>什么样的请求地址，对应，什么样的逻辑，都是开发人员决定的；</li>
</ul>
<h5 id="3-练习"><a href="#3-练习" class="headerlink" title="3.练习"></a>3.练习</h5><p>1.创建route文件夹；</p>
<ul>
<li>添加请求方式的判断；</li>
</ul>
<p>2.<code>req.method.toLowerCase();</code></p>
<ul>
<li>req.method，返回请求方式，但是，是大写；如果觉得小写方便</li>
<li><code>toLowerCase()</code>，改为小写；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入系统模块http</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 5.1 引入url模块</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.创建网站服务器</span></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.为网站服务器对象添加请求事件</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 4.获取请求方式</span></span><br><span class="line">    <span class="keyword">const</span> method = req.method.toLowerCase();</span><br><span class="line">    <span class="comment">// 5.获取请求地址</span></span><br><span class="line">    <span class="keyword">const</span> pathname = url.parse(req.url).pathname</span><br><span class="line">    <span class="comment">// 8.响应报文：</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;</span><br><span class="line">        <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 6.判断请求方式</span></span><br><span class="line">    <span class="keyword">if</span> (method==<span class="string">&#x27;get&#x27;</span>)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">&#x27;post&#x27;</span>)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.端口</span></span><br></pre></td></tr></table></figure>



<p>这就是路由的格式；</p>
<h3 id="8-Node-js异步编程"><a href="#8-Node-js异步编程" class="headerlink" title="8. Node.js异步编程"></a>8. Node.js异步编程</h3><h4 id="8-1-同步API-异步API"><a href="#8-1-同步API-异步API" class="headerlink" title="8.1 同步API, 异步API"></a>8.1 同步API, 异步API</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=37&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=37&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.API有些是返回值，拿到结果</p>
<p>2.有些是函数，拿到结果</p>
<p>3.比如下面：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路径拼接</span></span><br><span class="line"><span class="keyword">const</span> public = path.join(__dirname, <span class="string">&#x27;public&#x27;</span>);<span class="comment">//返回值</span></span><br><span class="line"><span class="comment">// 请求地址解析</span></span><br><span class="line"><span class="keyword">const</span> urlObj = url.parse(req.url);<span class="comment">//返回值</span></span><br><span class="line"><span class="comment">// 读取文件</span></span><br><span class="line">fs.readFile(<span class="string">&#x27;./demo.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.为什么 fs是函数的形式拿到结果呢？这是视频问的：</li>
<li></li>
</ul>
<h5 id="1-同步API："><a href="#1-同步API：" class="headerlink" title="1.同步API："></a>1.同步API：</h5><p>1.只有当前API执行完成后，才能继续执行下一个API</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;before&#x27;</span>); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;after&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>2.从上到下，一步步执行；</p>
<h5 id="2-异步API："><a href="#2-异步API：" class="headerlink" title="2.异步API："></a>2.异步API：</h5><p>1.当前API的执行不会阻塞后续代码的执行</p>
<p>2.例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;before&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(</span><br><span class="line">   () =&gt; &#123; <span class="built_in">console</span>.log(<span class="string">&#x27;last&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;after&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.虽然last在after上面，但after先输出。</li>
<li>2.setTimeout是个异步api；</li>
</ul>
<h4 id="8-2-获取返回值区别"><a href="#8-2-获取返回值区别" class="headerlink" title="8.2 获取返回值区别"></a>8.2 获取返回值区别</h4><p>1.同步API可以从返回值中拿到API执行的结果, 但是异步API是不可以的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 同步</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">n1, n2</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> n1 + n2;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">const</span> result = sum (<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 异步</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMsg</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">msg</span>: <span class="string">&#x27;Hello Node.js&#x27;</span> &#125;</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> msg = getMsg ();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>1.<code>return &#123; msg: &#39;Hello Node.js&#39; &#125;</code>返回一个对象；<ul>
<li>1.1 哦，这是json写法；想用js语法，目前无法理解；</li>
</ul>
</li>
</ul>
<p>2.结果是：undefined</p>
<ul>
<li>1.用变量去接受异步的返回值是接受不到的。<ul>
<li>当一个函数，没有写返回值的时候，默认返回undefined；</li>
</ul>
</li>
<li>2.要用回调函数</li>
</ul>
<h4 id="8-3-回调函数"><a href="#8-3-回调函数" class="headerlink" title="8.3 回调函数"></a>8.3 回调函数</h4><p>1.自己定义函数让别的函数去调用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// getData函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span> (<span class="params">callback</span>) </span>&#123;&#125;</span><br><span class="line"> <span class="comment">// getData函数调用</span></span><br><span class="line">getData (<span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.callback，仅仅是个名称，是一个参数；</li>
<li>2.而下面的，把一个函数当做了参数放进了getDate函数的，参数里面；</li>
</ul>
<p>2.代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.写一个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.那么callback就是那个函数的函数名</span></span><br><span class="line">    <span class="comment">// callback();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.在调用回调函数的时候，也可以加实参，不过要去那边加一个形参，加个n</span></span><br><span class="line">    callback(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.给参数写成函数</span></span><br><span class="line">getData(<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 4.写个打印，看被调用了没</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;callback函数被调用了&#x27;</span>)</span><br><span class="line">    <span class="comment">// 5.1 打印n，看传过来没,打印过来了。</span></span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建函数getData，形参callback</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">callback</span>) </span>&#123;&#125; <span class="comment">// return undefined</span></span><br><span class="line"><span class="comment">// 2.调用函数</span></span><br><span class="line">getData(); <span class="comment">// return undefined</span></span><br><span class="line"><span class="comment">//3.传入实参，callback形参变成了一个匿名函数实参；</span></span><br><span class="line">getData(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line"><span class="comment">// 4. 是函数就要被调用，调用callback()</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    callback(<span class="string">&#x27;123&#x27;</span>); <span class="comment">// 4.1 调用时，传入了一个实参123</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 5.但是函数callback没有形参，所以写一个形参接收，也就是n；</span></span><br><span class="line">getData(<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;&#125;);</span><br><span class="line"><span class="comment">// 6.函数被调用，但没有返回值：return undefined；</span></span><br><span class="line"><span class="comment">// 6.1 给cb函数写一个返回值</span></span><br><span class="line">getData(<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;callback函数被调用了&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 返回结果，完毕；</span></span><br></pre></td></tr></table></figure>



<ul>
<li>懵了</li>
<li>懂了又忘，忘了又懂，不行了，画图吧；</li>
</ul>
<p><img src="../../img/15/33.png" alt="33"></p>
<h4 id="8-4-使用回调函数获取异步API执行结果"><a href="#8-4-使用回调函数获取异步API执行结果" class="headerlink" title="8.4 使用回调函数获取异步API执行结果"></a>8.4 使用回调函数获取异步API执行结果</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMsg</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        callback (&#123; <span class="attr">msg</span>: <span class="string">&#x27;Hello Node.js&#x27;</span> &#125;)</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getMsg (<span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以更分开的写：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a2 = <span class="function"><span class="params">msg</span> =&gt;</span> <span class="built_in">console</span>.log(msg);</span><br><span class="line">getMsg(a2);</span><br></pre></td></tr></table></figure>



<p>2.解析：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 1.写个异步函数</span></span><br><span class="line"><span class="comment">// function getMsg() &#123;</span></span><br><span class="line"><span class="comment">//     setTimeout(function () &#123;</span></span><br><span class="line"><span class="comment">//         return &#123;</span></span><br><span class="line"><span class="comment">//             msg: &#x27;hello node.js&#x27;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;, 2000)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// getMsg();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.给异步函数里面，写一个形参</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMsg</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.调用实际化的形参，也是实参；形参是不用声明的变量</span></span><br><span class="line">        <span class="comment">// callback();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.1 给这个函数也加入实参</span></span><br><span class="line">        callback(&#123;</span><br><span class="line">            msg: <span class="string">&#x27;hello node.js&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.return没用，去掉</span></span><br><span class="line">        <span class="comment">// return &#123;</span></span><br><span class="line">        <span class="comment">//     msg: &#x27;hello node.js&#x27;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">    <span class="comment">// return; 这个是默认的，而且没有真正的返回值，所以是undefined；</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.为了准确的，确定的验证这个可以按照顺序的，拿到异步api的结果，我在最下面再写一个打印</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;李二狗&#x27;</span>);</span><br><span class="line">    <span class="comment">// 7.1 结果还是先拿到李二狗</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.在执行这个异步函数的时候，写一个函数作为实参</span></span><br><span class="line">getMsg(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 6.打印，看拿到异步api的结果没</span></span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="8-5-代码执行顺序区别"><a href="#8-5-代码执行顺序区别" class="headerlink" title="8.5 代码执行顺序区别"></a>8.5 代码执行顺序区别</h4><p>1.同步API从上到下依次执行，前面代码会阻塞后面代码的执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123; </span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;for循环后面的代码&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.这就是同步的api会影响程序的地方；假如上面的同步api要占用很多时间，那么下面就举步维艰；</li>
</ul>
<p>2.异步API不会等待API执行完成后再向下执行代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;代码开始执行&#x27;</span>); </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">&#x27;2秒后执行的代码&#x27;</span>)&#125;, <span class="number">2000</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">&#x27;&quot;0秒&quot;后执行的代码&#x27;</span>)&#125;, <span class="number">0</span>); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;代码结束执行&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>是先执行，0秒。还是先 代码结束执行呢？（打印结果）</li>
</ul>
<p>2.1 结果是：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">代码开始执行</span><br><span class="line">代码结束执行</span><br><span class="line"><span class="string">&quot;0秒&quot;</span>后执行的代码</span><br><span class="line"><span class="number">2</span>秒后执行的代码</span><br></pre></td></tr></table></figure>



<h5 id="1-代码执行顺序分析"><a href="#1-代码执行顺序分析" class="headerlink" title="1. 代码执行顺序分析"></a>1. 代码执行顺序分析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;代码开始执行&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;2秒后执行的代码&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">2000</span>); </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;&quot;0秒&quot;后执行的代码&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;代码结束执行&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.先把同步api执行完，再执行异步api；</p>
<p>2.从上到下</p>
<ul>
<li><p>1.先遇到<code>console.log(&#39;代码开始执行&#39;);</code></p>
<ul>
<li>1.1 放到同步代码执行区，并执行</li>
</ul>
</li>
<li><p>2.遇到</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;2秒后执行的代码&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>2.1 <code>setTimeout()</code>，方法有2个参数</p>
<ul>
<li><p>一个是回调函数，一个是延迟时间。</p>
</li>
<li><p>这里等于是这样：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(callback1, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> callback1 = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;&quot;2秒后执行的代码&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// var报错说不是函数，用const就可以，但是const必须写在上面，它没有变量提升。</span></span><br><span class="line"><span class="comment">// 箭头函数回调调用 箭头函数 总是说 被调用的 那个函数 不是函数 no function，必须写成 function()那种，不能箭头函数写法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.2 在这里，先把<code>setTimeout(callback1, 2000);</code>放入异步代码执行区</p>
<ul>
<li>然后把，回调函数，放入回调函数队列。</li>
</ul>
</li>
<li><p>3.同理遇到0秒后执行</p>
</li>
<li><p>4.最后是<code>console.log(&#39;代码结束执行&#39;);</code>，放入同步代码执行区，并执行。</p>
</li>
<li><p>5.然后去异步代码执行区看</p>
<ul>
<li>延迟0秒那个先走，就去回调函数队列去执行它的回调函数</li>
<li>2000毫毛接着。</li>
</ul>
</li>
<li><p>6.完毕；</p>
</li>
</ul>
</li>
</ul>
<p><img src="../../img/15/32.png" alt="32"></p>
<p>3.即使是延迟0秒，也被放在同步api后面；</p>
<hr>
<h4 id="8-6-Node-js中的异步API"><a href="#8-6-Node-js中的异步API" class="headerlink" title="8.6 Node.js中的异步API"></a>8.6 Node.js中的异步API</h4><p>1.读取文件</p>
<p><code>fs.readFile(&#39;./demo.txt&#39;, (err, result) =&gt; &#123;&#125;);</code></p>
<p>2.事件监听也是异步api，事件处理函数，也是回调函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.我们在为服务器对象，添加请求事件的时候，事件处理函数，我们有主动的调用过它吗？</p>
<ul>
<li>事件处理函数是：<code>(req, res) =&gt; &#123;&#125;</code></li>
</ul>
</li>
<li><p>2.并没有主动调用，事件处理函数的执行，都是在事件发生请求的时候，系统去调用的；</p>
<ul>
<li>1.系统在调用函数的时候，给我们传递了两个参数，分别是请求对象和响应对象。</li>
<li>2.所以，我们在定义这个函数的时候，才可以用形参的方式，来接受 请求与响应 对象；</li>
<li>3.所以，事件处理函数，是回调函数。事件监听的API是异步api；</li>
</ul>
</li>
<li><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=40&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=40&amp;spm_id_from=pageDriver</a></p>
<p>02.00</p>
</blockquote>
</li>
</ul>
<h4 id="8-7-异步地狱"><a href="#8-7-异步地狱" class="headerlink" title="8.7. 异步地狱"></a>8.7. 异步地狱</h4><p>1.如果异步API后面代码的执行依赖当前异步API的执行结果，但实际上后续代码在执行的时候异步API还没有返回结果，这个问题要怎么解决呢？</p>
<p>2.需求：依次读取A文件、B文件、C文件</p>
<ul>
<li>1.创建callbackhell.js，和三个txt</li>
</ul>
<p>2.1 代码，可以这样写吗？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;./2.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result1</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;./3.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result2</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.我们不知道读取2.txt需要多长的时间，如果它文件大。</li>
<li>2.就会在2.txt没读取完毕时，3.txt就读取完毕了；</li>
</ul>
<p>2.2 就只有这样写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">&#x27;./2.tet&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result1</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(<span class="string">&#x27;./3.tet&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result2</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.readFile(<span class="string">&#x27;./4.tet&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result2</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.但这样不易维护，也不美观（视频）</li>
</ul>
<h5 id="1-Promise"><a href="#1-Promise" class="headerlink" title="1. Promise"></a>1. Promise</h5><p>1.Promise出现的目的是解决Node.js异步编程中回调地狱的问题。</p>
<p>2.Promise本身是一个构造函数</p>
<ul>
<li><p>1.如果要使用，就要先用new创建实例对象；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>视频说resolve[^21]与 reject[^22]，都是函数。</li>
<li>说明resolve, reject是对象Promise里的方法。</li>
<li>但这里的格式，又像是一个箭头函数里面的参数。</li>
</ul>
</li>
<li><p>2.当异步api有返回结果的时候，你可以调用resolve。</p>
<ul>
<li>用参数的形式把 结果，传到 promise外面去</li>
</ul>
</li>
<li><p>2.1 如果是 失败了。就reject；</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            resolve(&#123;<span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>&#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            reject(<span class="string">&#x27;失败了&#x27;</span>) </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result); <span class="comment">// &#123;name: &#x27;张三&#x27;&#125;)</span></span><br><span class="line">       .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error); <span class="comment">// 失败了)</span></span><br></pre></td></tr></table></figure>



<p><img src="../../img/15/34.png" alt="34"></p>
<p>3.Promise ，实际上就是把常规的异步API外面包裹了一层。</p>
<ul>
<li>1.成功的，返回结果就是resolve，传到 promise外面去</li>
<li>2.失败的，返回结果就用reject；传到 promise外面去</li>
</ul>
<p>4.Promise，下面有一个then方法，</p>
<ul>
<li>1.调用resolve，实际上是执行then里面的回调函数；<ul>
<li>确实，then里面那一坨是个箭头函数。</li>
<li>但是Promise里面也很像一个箭头函数，我必须搞清楚；</li>
<li>我觉得，<code>(resolve, reject) =&gt; &#123;&#125;</code>,这一坨，就是箭头函数，作为了Promise的参数。</li>
<li>那么也是一个回调函数？2021-4-19 10:42:29</li>
</ul>
</li>
<li>2.同时，reject，是调用Promise里的一个叫catch的方法，的里面的一个函数。</li>
</ul>
<p>5.然后，这是Promise的基础代码；。。。</p>
<p>6.视频里面说，resolve，调用一个匿名函数<code>result =&gt; console.log(result)</code></p>
<ul>
<li>1.而<code>resolve(&#123;name: &#39;张三&#39;&#125;)</code>是传递了一个实参</li>
<li>2.<code>result =&gt; console.log(result)</code>，原本是<code>() =&gt; console.log()</code>;<ul>
<li>然后写result作为形参，才变成<code>result =&gt; console.log(result)</code>;</li>
</ul>
</li>
</ul>
<h5 id="2-解决地狱"><a href="#2-解决地狱" class="headerlink" title="2. 解决地狱"></a>2. 解决地狱</h5><p>1.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">p1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.readFile(<span class="string">&#x27;./1.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">            resolve(result)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">p2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.readFile(<span class="string">&#x27;./2.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">            resolve(result)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">p3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.readFile(<span class="string">&#x27;./3.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">            resolve(result)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p1().then(<span class="function">(<span class="params">r1</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(r1);</span><br><span class="line">    <span class="keyword">return</span> p2();</span><br><span class="line">&#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">r2</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(r2);</span><br><span class="line">        <span class="keyword">return</span> p3();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">r3</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(r3)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<h4 id="8-8-异步函数"><a href="#8-8-异步函数" class="headerlink" title="8.8 异步函数"></a>8.8 异步函数</h4><p>0.在Promise对象的基础上，进行了封装。（可自己创建异步函数了）</p>
<ul>
<li>1.把臃肿的代码封装起来，供一些关键字，给我们使用。</li>
</ul>
<p>1.异步函数是异步编程语法的终极解决方案，它可以让我们将异步代码写成同步的形式，==让代码不再有回调函数嵌套==，使代码变得清晰明了。</p>
<ul>
<li>它是ES7语法；</li>
</ul>
<p>2.异步函数的，基础语法：</p>
<p><code>const fn = async () =&gt; &#123;&#125;;</code></p>
<p><code>async function fn () &#123;&#125;</code></p>
<p>2.1 在普通函数前面，加上，async关键字；</p>
<ul>
<li>1.普通函数，就变成了，异步函数。</li>
</ul>
<h5 id="2-15-async关键字"><a href="#2-15-async关键字" class="headerlink" title="2.15 async关键字"></a>2.15 async关键字</h5><ul>
<li><p>0.本来就是异步函数，还增加异步？</p>
<ul>
<li>其实不是，那些事异步api，但不能使用异步函数的语法</li>
<li>这样可以使用await；</li>
</ul>
</li>
<li><ol>
<li><p>普通函数定义前加async关键字 普通函数变成异步函数</p>
</li>
<li><p>异步函数默认返回promise对象</p>
</li>
<li><p>在异步函数内部使用return关键字进行结果返回 结果会被包裹的promise对象中 return关键字代替了resolve方法</p>
</li>
<li><p>在异步函数内部使用throw关键字抛出程序异常</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&#x27;发生了一些错误&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ul>
<ol start="5">
<li><p>调用异步函数再链式调用then方法获取异步函数执行结果</p>
</li>
<li><p>调用异步函数再链式调用catch方法获取异步函数执行的错误信息</p>
</li>
</ol>
<p>2.2 代码示例：</p>
<ul>
<li>1.异步函数默认的返回值是promise对象；</li>
<li>2.在异步函数内部使用throw关键字，进行错误的抛出。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.自创建一个异步函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&#x27;发生一些错误&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.获取返回值</span></span><br><span class="line"><span class="comment">// 2.1 用命令行工具查看结果,发现无法获得返回值</span></span><br><span class="line"><span class="built_in">console</span>.log(fn());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.获取返回对象里面的数据</span></span><br><span class="line">fn().then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<ul>
<li><p>2.1 用命令行工具查看结果</p>
<p><img src="../../img/15/35.png" alt="35"></p>
</li>
</ul>
<ul>
<li><p>3.解析</p>
<p><img src="../../img/15/36.png" alt="36"></p>
</li>
</ul>
<h5 id="4-await关键字"><a href="#4-await关键字" class="headerlink" title="4.await关键字"></a>4.await关键字</h5><ul>
<li><p>1.await关键字只能出现在异步函数中<br>2.await promise await后面只能写promise对象 写其他类型的API是不不可以的</p>
<p>3.await关键字可是暂停异步函数向下执行 直到promise返回结果</p>
<ul>
<li>变成同步；</li>
</ul>
<p>4.而且可以不用then。</p>
</li>
</ul>
<p>1.代码示例：</p>
<ul>
<li>await使异步api，变成同步状态，且可以直接取返回值使用；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">p1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;p1&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">p2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;p2&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">p3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;p3&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> run = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">//不使用await</span></span><br><span class="line">    <span class="comment">//p1().then(result=&gt;console.log(result));</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">let</span> r1 = <span class="keyword">await</span> p1();</span><br><span class="line">    <span class="keyword">let</span> r2 = <span class="keyword">await</span> p2();</span><br><span class="line">    <span class="keyword">let</span> r3 = <span class="keyword">await</span> p3();</span><br><span class="line">    <span class="built_in">console</span>.log(r1)</span><br><span class="line">    <span class="built_in">console</span>.log(r2)</span><br><span class="line">    <span class="built_in">console</span>.log(r3)</span><br><span class="line">&#125;</span><br><span class="line">run();</span><br></pre></td></tr></table></figure>



<h5 id="5-应用"><a href="#5-应用" class="headerlink" title="5. 应用"></a>5. 应用</h5><p>1.之前写的依次读取三个文件的例子。</p>
<p>2.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.导入fs</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.改造现有异步函数api，让其返回promise对象，从而支持异步函数语法</span></span><br><span class="line"><span class="comment">// node提供了一个方法，让当前异步api返回promise对象，来能使用异步函数方法</span></span><br><span class="line"><span class="comment">// 3.1拿到方法，后面是函数的键，所以不用（）；</span></span><br><span class="line"><span class="keyword">const</span> promisify = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>).promisify;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.使用读取文件方法</span></span><br><span class="line"><span class="comment">// 2.1但是这个异步api不返回promise对象，难道又外面嵌套？</span></span><br><span class="line"><span class="comment">// 2.2 它无法用async关键字吗？起初是这样的</span></span><br><span class="line"><span class="comment">// fs.readFile(&#x27;&#x27;, &#x27;&#x27;, (err, result) =&gt; &#123;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.调用promisify方法改造现有异步api，让其返回promise对象</span></span><br><span class="line"><span class="comment">// 包装fs.readFile , promisify(fs.readFile)会返回一个新的，可以返回promise对象的方法（匿名函数吗）。</span></span><br><span class="line"><span class="keyword">const</span> readFile = promisify(fs.readFile);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.创建异步函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 6.使用await，而不写回调函数</span></span><br><span class="line">    <span class="keyword">let</span> r1 = <span class="keyword">await</span> readFile(<span class="string">&#x27;./2.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> r2 = <span class="keyword">await</span> readFile(<span class="string">&#x27;./3.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> r3 = <span class="keyword">await</span> readFile(<span class="string">&#x27;./4.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(r1, r2, r3);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 7.运行run</span></span><br><span class="line">run();</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="4-数据库"><a href="#4-数据库" class="headerlink" title="4. 数据库"></a>4. 数据库</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=45&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=45&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.目标：</p>
<p> 能够安装数据库软件<br> 能够知道集合、文档的概念<br> 能够使用mongoose创建集合的方法创建集合<br> 能够对数据库中的数据进行增删改查操作</p>
<p>2.目录：</p>
<p> 数据库概述<br> 数据库环境搭建<br> MongoDB数据库连接<br> MongoDB增删改查操作</p>
<h2 id="4-1-数据库概述及环境搭建"><a href="#4-1-数据库概述及环境搭建" class="headerlink" title="4.1 数据库概述及环境搭建"></a>4.1 数据库概述及环境搭建</h2><h3 id="1-为什么要使用数据库"><a href="#1-为什么要使用数据库" class="headerlink" title="1. 为什么要使用数据库"></a>1. 为什么要使用数据库</h3><p>动态网站中的数据都是存储在数据库中的<br>数据库可以用来持久存储客户端通过表单收集的用户信息<br>数据库软件本身可以对数据进行高效的管理</p>
<h3 id="2-什么是数据库"><a href="#2-什么是数据库" class="headerlink" title="2. 什么是数据库"></a>2. 什么是数据库</h3><p>1.数据库即存储数据的仓库，可以将数据进行有序的分门别类的存储。它是独立于语言之外的软件，可以通过API去操作它。<br>常见的数据库软件有：mysql、mongoDB、oracle。</p>
<ul>
<li>mongoDB的API采用的是JavaScript语法；</li>
<li>2.php与mysql好配合<ul>
<li>node也可以操作mysql</li>
</ul>
</li>
<li>3.学习了一款，再学习其他会容易很多；上句话</li>
</ul>
<p><img src="../../img/15/37.png" alt="37"></p>
<h3 id="3-MongoDB数据库下载安装"><a href="#3-MongoDB数据库下载安装" class="headerlink" title="3. MongoDB数据库下载安装"></a>3. MongoDB数据库下载安装</h3><p>1.下载地址：<a target="_blank" rel="noopener" href="https://www.mongodb.com/download-center/community">https://www.mongodb.com/download-center/community</a></p>
<h3 id="4-MongoDB可视化软件"><a href="#4-MongoDB可视化软件" class="headerlink" title="4. MongoDB可视化软件"></a>4. MongoDB可视化软件</h3><p>1.MongoDB可视化操作软件，是使用图形界面操作数据库的一种方式。</p>
<p><img src="../../img/15/38.jpg" alt="38"></p>
<h3 id="5-数据库相关概念"><a href="#5-数据库相关概念" class="headerlink" title="5. 数据库相关概念"></a>5. 数据库相关概念</h3><p>1.在一个数据库软件中可以包含多个数据仓库，在每个数据仓库中可以包含多个数据集合，每个数据集合中可以包含多条文档（具体的数据）。</p>
<table>
<thead>
<tr>
<th><strong>术语</strong></th>
<th><strong>解释说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>数据库，mongoDB数据库软件中可以建立多个数据库</td>
</tr>
<tr>
<td>collection</td>
<td>集合，一组数据的集合，可以理解为JavaScript中的数组</td>
</tr>
<tr>
<td>document</td>
<td>文档，一条具体的数据，可以理解为JavaScript中的对象</td>
</tr>
<tr>
<td>field</td>
<td>字段，文档中的属性名称，可以理解为JavaScript中的对象属性</td>
</tr>
</tbody></table>
<h3 id="6-Mongoose第三方包"><a href="#6-Mongoose第三方包" class="headerlink" title="6. Mongoose第三方包"></a>6. Mongoose第三方包</h3><p>使用Node.js操作MongoDB数据库需要依赖Node.js第三方包mongoose<br>使用npm install mongoose命令下载</p>
<h3 id="7-启动MongoDB"><a href="#7-启动MongoDB" class="headerlink" title="7. 启动MongoDB"></a>7. 启动MongoDB</h3><p>1.在命令行工具中运行net start mongoDB即可启动MongoDB，否则MongoDB将无法连接。</p>
<p>2.关闭：net stop mongodb</p>
<h3 id="8-数据库连接"><a href="#8-数据库连接" class="headerlink" title="8. 数据库连接"></a>8. 数据库连接</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=47&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=47&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.使用mongoose提供的connect方法即可连接数据库。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost/playground&#x27;</span>)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接失败&#x27;</span>, err));</span><br></pre></td></tr></table></figure>

<ul>
<li>视频里面说，虽然没有创建这个数据库。</li>
<li>但是在添加数据的时候，会自动创建。。。</li>
</ul>
<p>2.实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入mongoose模块，先要下载</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.链接数据库，没创建也没事</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost/ql_playground&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接失败&#x27;</span>, err))</span><br></pre></td></tr></table></figure>

<ul>
<li>1.如果有警告：</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS F:\2-3ciyuan\11-data base-shujuk\3-lianxi&gt; node .\01.js</span><br><span class="line">(node:13956) DeprecationWarning: current URL string parser is deprecated, <span class="keyword">and</span> will be removed <span class="keyword">in</span> a future version. <span class="keyword">To</span> use the new parser, pass option &#123; useNewUrlParser: <span class="literal">true</span> &#125; <span class="keyword">to</span> MongoClient.connect.</span><br><span class="line">(Use `node --trace-deprecation <span class="built_in">..</span>.` <span class="keyword">to</span> show where the <span class="builtin-name">warning</span> was created)</span><br><span class="line">(node:13956) [MONGODB DRIVER] Warning: Current<span class="built_in"> Server Discovery </span><span class="keyword">and</span> Monitoring engine is deprecated, <span class="keyword">and</span> will be removed <span class="keyword">in</span> a future version. <span class="keyword">To</span> use the new<span class="built_in"> Server </span>Discover <span class="keyword">and</span> Monitoring engine, pass option &#123; useUnifiedTopology: <span class="literal">true</span> &#125; <span class="keyword">to</span> the MongoClient constructor.</span><br><span class="line">数据库链接成功</span><br></pre></td></tr></table></figure>

<ul>
<li>还是要处理一下；</li>
<li>2.<code>mongoose.connect(&#39;mongodb://localhost/ql_playground&#39;, &#123; useNewUrlParser: true, useUnifiedTopology: true &#125;)</code><ul>
<li>useNewUrlParser: true，这些东西，是作为connect的参数。</li>
</ul>
</li>
</ul>
<h3 id="9-创建数据库"><a href="#9-创建数据库" class="headerlink" title="9. 创建数据库"></a>9. 创建数据库</h3><p>1.在MongoDB中不需要显式创建数据库，如果正在使用的数据库不存在，MongoDB会自动创建。</p>
<hr>
<h2 id="4-2-MongoDB增删改查操作"><a href="#4-2-MongoDB增删改查操作" class="headerlink" title="4.2 MongoDB增删改查操作"></a>4.2 MongoDB增删改查操作</h2><h3 id="1-创建集合"><a href="#1-创建集合" class="headerlink" title="1. 创建集合"></a>1. 创建集合</h3><p>1.创建集合分为两步，一是对对集合设定规则，二是创建集合，创建mongoose[^13].Schema[^14]构造函数的实例即可创建集合。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入mongoose模块，先要下载</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.链接数据库，没创建也没事</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost/ql_playground&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接失败&#x27;</span>, err))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.设定规则</span></span><br><span class="line"><span class="keyword">const</span> practice_rules = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    teacher: <span class="built_in">String</span>,</span><br><span class="line">    isPublished: <span class="built_in">Boolean</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.使用规则创建集合</span></span><br><span class="line"><span class="keyword">const</span> Course1 = mongoose.model(<span class="string">&#x27;Courses1&#x27;</span>, practice_rules);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>创建规则的时候，传递了一个对象进去。<ul>
<li>这种写法，我一直有点不熟悉；</li>
</ul>
</li>
</ul>
<h4 id="2-mongoose-model"><a href="#2-mongoose-model" class="headerlink" title="2.mongoose.model"></a>2.<code>mongoose.model</code></h4><p>可以创建集合，第一个参数是集合的名称。第二个应该是应用的规则的名称。</p>
<ul>
<li>注意，参数集合的名称，第一个字母要大写。<ul>
<li>不过，在数据库中创建的名称，的，第一个字母是小写的。</li>
<li>只不过，在你创建的名称后面添加了s，我觉得应该是复数语法，有些可能会是边y为i加es等等</li>
</ul>
</li>
<li>2.model[^26]方法，会返回当前这个集合的构造函数。<ul>
<li>2.1 为什么返回构造函数</li>
<li>2.2 因为构造函数下面有很多方法，可以直接使用。增删查改等等</li>
</ul>
</li>
</ul>
<h3 id="2-创建文档–增"><a href="#2-创建文档–增" class="headerlink" title="2. 创建文档–增"></a>2. 创建文档–增</h3><p>1.创建文档实际上就是向集合中插入数据。<br>分为两步：</p>
<ul>
<li>创建集合实例。</li>
<li>调用实例对象下的save方法将数据保存到数据库中。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 创建集合实例</span></span><br><span class="line"><span class="keyword">const</span> course = <span class="keyword">new</span> Course(&#123;</span><br><span class="line">    name: <span class="string">&#x27;Node.js course&#x27;</span>,</span><br><span class="line">    author: <span class="string">&#x27;黑马讲师&#x27;</span>,</span><br><span class="line">    tags: [<span class="string">&#x27;node&#x27;</span>, <span class="string">&#x27;backend&#x27;</span>],</span><br><span class="line">    isPublished: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"> <span class="comment">// 将数据保存到数据库中</span></span><br><span class="line">course.save();</span><br></pre></td></tr></table></figure>



<p>2.另一种方式，用这种方法，可以返回错误信息；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Course.create(&#123;<span class="attr">name</span>: <span class="string">&#x27;JavaScript基础&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;黑马讲师&#x27;</span>, <span class="attr">isPublish</span>: <span class="literal">true</span>&#125;, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123; </span><br><span class="line">     <span class="comment">//  错误对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">     <span class="comment">//  当前插入的文档</span></span><br><span class="line">    <span class="built_in">console</span>.log(doc)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.第一个参数，是要插入的文档，对象类型</li>
<li>2.第二个参数，是一个回调函数。</li>
</ul>
<p>2.1 回调函数，异步api</p>
<ul>
<li>关于数据库的操作，都是异步操作；2021-4-19 18:21:50</li>
</ul>
<p>2.2 数据库的api也支持promise，可以用异步函数的语法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Course.create(&#123;<span class="attr">name</span>: <span class="string">&#x27;JavaScript基础&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;黑马讲师&#x27;</span>, <span class="attr">isPublish</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">      .then(<span class="function"><span class="params">doc</span> =&gt;</span> <span class="built_in">console</span>.log(doc))</span><br><span class="line">      .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</span><br></pre></td></tr></table></figure>





<h3 id="3-mongoDB数据库导入数据"><a href="#3-mongoDB数据库导入数据" class="headerlink" title="3. mongoDB数据库导入数据"></a>3. mongoDB数据库导入数据</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=50&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=50&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.怎么添加已有的数据；</p>
<p>1.mongoimport –d 数据库名称 –c 集合名称 –file 要导入的数据文件<br>找到mongodb数据库的安装目录，将安装目录下的bin目录放置在环境变量中。</p>
<p>2.命令不能直接使用。</p>
<ul>
<li>要加到系统的环境变量里面；</li>
</ul>
<p>2.1 现在已经不和server一起下载了。要单独下载</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.mongodb.com">https://www.mongodb.com</a></li>
<li><img src="../../img/15/39.png" alt="39"></li>
</ul>
<p>2.2 现在有了：mongoimport.exe</p>
<ul>
<li>主要就是找到这个可执行文件的路径</li>
</ul>
<p>3.添加到path里面；</p>
<p>4.准备了一个json文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;_id&quot;</span>:&#123;<span class="attr">&quot;$oid&quot;</span>:<span class="string">&quot;5c09f1e5aeb04b22f8460965&quot;</span>&#125;,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">20</span>,<span class="attr">&quot;hobbies&quot;</span>:[<span class="string">&quot;足球&quot;</span>,<span class="string">&quot;篮球&quot;</span>,<span class="string">&quot;橄榄球&quot;</span>],<span class="attr">&quot;email&quot;</span>:<span class="string">&quot;zhangsan@itcast.cn&quot;</span>,<span class="attr">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;_id&quot;</span>:&#123;<span class="attr">&quot;$oid&quot;</span>:<span class="string">&quot;5c09f236aeb04b22f8460967&quot;</span>&#125;,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;李四&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;hobbies&quot;</span>:[<span class="string">&quot;足球&quot;</span>,<span class="string">&quot;篮球&quot;</span>],<span class="attr">&quot;email&quot;</span>:<span class="string">&quot;lisi@itcast.cn&quot;</span>,<span class="attr">&quot;password&quot;</span>:<span class="string">&quot;654321&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;_id&quot;</span>:&#123;<span class="attr">&quot;$oid&quot;</span>:<span class="string">&quot;5c09f267aeb04b22f8460968&quot;</span>&#125;,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;王五&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">25</span>,<span class="attr">&quot;hobbies&quot;</span>:[<span class="string">&quot;敲代码&quot;</span>],<span class="attr">&quot;email&quot;</span>:<span class="string">&quot;wangwu@itcast.cn&quot;</span>,<span class="attr">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;_id&quot;</span>:&#123;<span class="attr">&quot;$oid&quot;</span>:<span class="string">&quot;5c09f294aeb04b22f8460969&quot;</span>&#125;,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;赵六&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">50</span>,<span class="attr">&quot;hobbies&quot;</span>:[<span class="string">&quot;吃饭&quot;</span>,<span class="string">&quot;睡觉&quot;</span>,<span class="string">&quot;打豆豆&quot;</span>],<span class="attr">&quot;email&quot;</span>:<span class="string">&quot;zhaoliu@itcast.cn&quot;</span>,<span class="attr">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;_id&quot;</span>:&#123;<span class="attr">&quot;$oid&quot;</span>:<span class="string">&quot;5c09f2b6aeb04b22f846096a&quot;</span>&#125;,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;王二麻子&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">32</span>,<span class="attr">&quot;hobbies&quot;</span>:[<span class="string">&quot;吃饭&quot;</span>],<span class="attr">&quot;email&quot;</span>:<span class="string">&quot;wangermazi@itcast.cn&quot;</span>,<span class="attr">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;_id&quot;</span>:&#123;<span class="attr">&quot;$oid&quot;</span>:<span class="string">&quot;5c09f2d9aeb04b22f846096b&quot;</span>&#125;,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;狗蛋&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="number">14</span>,<span class="attr">&quot;hobbies&quot;</span>:[<span class="string">&quot;打豆豆&quot;</span>],<span class="attr">&quot;email&quot;</span>:<span class="string">&quot;goudan@163.com&quot;</span>,<span class="attr">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>5.代码实例：</p>
<p><code>mongoimport -d ql_playground -c users --file ./user.json</code></p>
<p>mongoimport –d 数据库名称 –c 集合名称 –file 要导入的数据文件</p>
<ul>
<li><p>1.返回：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2021</span><span class="number">-04</span><span class="number">-19</span>T23:<span class="number">12</span>:<span class="number">10.563</span>+<span class="number">0800</span>    connected to: mongodb:<span class="comment">//localhost/</span></span><br><span class="line"><span class="number">2021</span><span class="number">-04</span><span class="number">-19</span>T23:<span class="number">12</span>:<span class="number">10.682</span>+<span class="number">0800</span>    <span class="number">6</span> document(s) imported successfully. <span class="number">0</span> document(s) failed to <span class="keyword">import</span>.</span><br></pre></td></tr></table></figure>
</li>
<li><p>1.2 翻译</p>
<p>2021-04-19T23:12:10.563+0800连接至：mongodb://localhost/</p>
<p>2021-04-19T23:12:10.682+0800 6文档导入成功。0个文档导入失败。</p>
</li>
</ul>
<p>6.</p>
<h3 id="4-查询文档"><a href="#4-查询文档" class="headerlink" title="4. 查询文档"></a>4. 查询文档</h3><h4 id="4-1-find-方法"><a href="#4-1-find-方法" class="headerlink" title="4.1 .find()方法"></a>4.1 .find()方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  根据条件查找文档（条件为空则查找所有文档）</span></span><br><span class="line">Course.find().then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>



<p>2.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回文档集合</span></span><br><span class="line">[&#123;</span><br><span class="line">    _id: <span class="number">5</span>c0917ed37ec9b03c07cf95f,</span><br><span class="line">    name: <span class="string">&#x27;node.js基础&#x27;</span>,</span><br><span class="line">    author: <span class="string">&#x27;黑马讲师‘</span></span><br><span class="line"><span class="string">&#125;,&#123;</span></span><br><span class="line"><span class="string">     _id: 5c09dea28acfb814980ff827,</span></span><br><span class="line"><span class="string">     name: &#x27;</span>Javascript<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">     author: &#x27;</span>黑马讲师‘</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>



<p>3.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入mongoose模块，先要下载</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.链接数据库，没创建也没事</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost/ql_playground&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接失败&#x27;</span>, err))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.设定规则</span></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    age: <span class="built_in">Number</span>,</span><br><span class="line">    email: <span class="built_in">String</span>,</span><br><span class="line">    password: <span class="built_in">String</span>,</span><br><span class="line">    hobbies: [<span class="built_in">String</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.使用规则创建集合</span></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&#x27;User&#x27;</span>, userSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.用.find查询文档，查询用户集合中的所有文档</span></span><br><span class="line"><span class="comment">// 5.1 因为User.find()返回permise对象，后面可以直接调用then</span></span><br><span class="line"><span class="comment">// 5.2 即使没有创建新的集合实例，也能查找，看来是能查找规则相同的数据</span></span><br><span class="line"><span class="comment">// User.find().then(result =&gt; console.log(result));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.查询条件设置</span></span><br><span class="line">User.find(&#123; <span class="attr">name</span>: <span class="string">&#x27;王五&#x27;</span> &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>

<ul>
<li>在第六步，即使只有一条数据，返回的也是数组<ul>
<li>如果查找的数据不存在，返回的是空数组</li>
</ul>
</li>
</ul>
<h4 id="4-2-findOne方法"><a href="#4-2-findOne方法" class="headerlink" title="4.2 findOne方法"></a>4.2 findOne方法</h4><p>1.也是查找文档，但它的返回结果，就只有一条；</p>
<p>2.代码示例：</p>
<p><code>//  根据条件查找文档
Course.findOne(&#123;name: &#39;node.js基础&#39;&#125;).then(result =&gt; console.log(result))</code></p>
<p>2.1 返回结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回文档</span></span><br><span class="line"> &#123;</span><br><span class="line">    _id: <span class="number">5</span>c0917ed37ec9b03c07cf95f,</span><br><span class="line">    name: <span class="string">&#x27;node.js基础&#x27;</span>,</span><br><span class="line">    author: <span class="string">&#x27;黑马讲师‘</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>



<p>3.代码实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7.使用fandOne方法练习</span></span><br><span class="line">User.findOne(&#123; <span class="attr">name</span>: <span class="string">&#x27;node.js基础&#x27;</span> &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>

<ul>
<li>返回的null，。。。</li>
</ul>
<p>4.测试，是不是返回当前集合的，第一个数据；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7.测试，是不是返回当前集合的，第一个数据</span></span><br><span class="line">User.findOne().then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>

<ul>
<li>确实是</li>
</ul>
<p>4.1 我回去测试了第四步</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.使用规则创建集合</span></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.把‘User’，改为了，‘User1’。就返回的null</li>
<li>2.看来这里的仓库名字，如果和数据库里面已有的集合同名，就会直接连接到那个集合。</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=51&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=51&amp;spm_id_from=pageDriver</a></p>
<p>07:27；</p>
</blockquote>
<hr>
<h4 id="4-3-大于小于"><a href="#4-3-大于小于" class="headerlink" title="4.3 大于小于"></a>4.3 大于小于</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  匹配大于 小于</span></span><br><span class="line">User.find(&#123;<span class="attr">age</span>: &#123;<span class="attr">$gt</span>: <span class="number">20</span>, <span class="attr">$lt</span>: <span class="number">50</span>&#125;&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<p>1.固定用法</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=52&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=52&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>2.练习，还是继续在4.js里面；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8.查询，练习大于小于</span></span><br><span class="line">User.find(&#123; <span class="attr">age</span>: &#123; <span class="attr">$gt</span>: <span class="number">20</span>, <span class="attr">$lt</span>: <span class="number">50</span> &#125; &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>01:44 ；</p>
</blockquote>
<h4 id="4-4-匹配包含"><a href="#4-4-匹配包含" class="headerlink" title="4.4 匹配包含"></a>4.4 匹配包含</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  匹配包含</span></span><br><span class="line">User.find(&#123;<span class="attr">hobbies</span>: &#123;<span class="attr">$in</span>: [<span class="string">&#x27;敲代码&#x27;</span>]&#125;&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<ul>
<li><p>查询 field 值与指定数组中任何值相等的 MongoDB 文档.</p>
</li>
<li><blockquote>
<p>$in:<a target="_blank" rel="noopener" href="https://www.aiuai.cn/aifarm298.html">https://www.aiuai.cn/aifarm298.html</a></p>
</blockquote>
</li>
</ul>
<h4 id="4-5-选择要查询的字段"><a href="#4-5-选择要查询的字段" class="headerlink" title="4.5 选择要查询的字段"></a>4.5 选择要查询的字段</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  选择要查询的字段  </span></span><br><span class="line">User.find().select(<span class="string">&#x27;name email&#x27;</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<p>1.<code>_id</code>，是默认查找出来的。</p>
<ul>
<li>如果不想查询</li>
</ul>
<h4 id="4-6-将数据按照年龄进行排序"><a href="#4-6-将数据按照年龄进行排序" class="headerlink" title="4.6 将数据按照年龄进行排序"></a>4.6 将数据按照年龄进行排序</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将数据按照年龄进行排序</span></span><br><span class="line">User.find().sort(<span class="string">&#x27;age&#x27;</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<p>1.sort[^16]</p>
<p>2.升序排列</p>
<p>3.如果想降序排序，只需要在age前面加一个负号</p>
<ul>
<li><code>sort(&#39;-age&#39;)</code></li>
</ul>
<h4 id="4-7-跳过与限制"><a href="#4-7-跳过与限制" class="headerlink" title="4.7 跳过与限制"></a>4.7 跳过与限制</h4><p>1.skip 跳过多少条数据  limit 限制查询数量</p>
<ul>
<li><p>skip 跳过多少条数据，查询的时候，跳过前几个文档；</p>
<p><img src="../../img/15/40.png" alt="40"></p>
</li>
<li><p>limit，不管你结果多少，我只显示X条；</p>
</li>
</ul>
<p>1.1 如果是排序呢？假如把排序写在前面，会不会是跳过排序后的前两个，而不是数据库里面的前两个文档；</p>
<ul>
<li>1.实验；</li>
<li>哇咔咔，是跳过==排序后的==；</li>
</ul>
<p>2.分页的时候，用得到；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  skip 跳过多少条数据  limit 限制查询数量</span></span><br><span class="line">User.find().skip(<span class="number">2</span>).limit(<span class="number">2</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="5-删除文档"><a href="#5-删除文档" class="headerlink" title="5. 删除文档"></a>5. 删除文档</h3><p>1.删除单个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 删除单个</span></span><br><span class="line">Course.findOneAndDelete(&#123;&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<ul>
<li>1.findOneAndDelete<ul>
<li>findOne_and_delet</li>
<li>查找一个文档，并，删除；</li>
</ul>
</li>
<li>2.我猜参数，是写的条件。是一个对象类型。<ul>
<li>如果查询条件匹配了多条文档，它会把第一个文档删除</li>
</ul>
</li>
<li>3.它有返回值，返回被删除的文档信息。</li>
</ul>
<p>2.删除多个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 删除多个</span></span><br><span class="line">User.deleteMany(&#123;&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.Many[^17]</p>
</li>
<li><p>2.猜测：这个就是把所有匹配到的文档，全部删除，上面只删除第一个，但也能匹配到所有相关文档</p>
</li>
<li><p>3.==注意==：如果不写条件，空对象，就删除全部文档；</p>
</li>
<li><p>4.返回值：{n:x, ok:1}</p>
<ul>
<li>1.这个x，是删除了多少条文档</li>
<li>2.ok的1，可能是true的意思。布尔值；</li>
</ul>
</li>
</ul>
<h3 id="6-更新文档"><a href="#6-更新文档" class="headerlink" title="6. 更新文档"></a>6. 更新文档</h3><p>1.单个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新单个</span></span><br><span class="line">User.updateOne(&#123;查询条件&#125;, &#123;要修改的值&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<ul>
<li>1.update，更新，one一个。更新一个；</li>
</ul>
<p>1.1 示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.updateOne(&#123;<span class="attr">name</span>:<span class="string">&#x27;xx&#x27;</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">&#x27;xx&#x27;</span>&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<ul>
<li><p>两边都写完整了；</p>
</li>
<li><p>当热，左右两边的数据名不用一样，左边是查询条件，右边是修改的数据</p>
<ul>
<li>左边name，右边age也行的</li>
</ul>
</li>
</ul>
<p>2.多个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新多个</span></span><br><span class="line">User.updateMany(&#123;查询条件&#125;, &#123;要更改的值&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>

<p>2.1 实例：</p>
<ul>
<li>1.所有文档的age改为56；</li>
</ul>
<p>2.2 会返回：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">数据库链接成功</span></span><br><span class="line">&#123; <span class="attr">n:</span> <span class="number">6</span>, <span class="attr">nModified:</span> <span class="number">6</span>, <span class="attr">ok:</span> <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>n:被匹配到的有几条</li>
<li>modified[^18]：修改了几条</li>
<li>ok：1 = 成功；</li>
</ul>
<h3 id="7-mongoose验证"><a href="#7-mongoose验证" class="headerlink" title="7. mongoose验证"></a>7. mongoose验证</h3><p>1.在创建集合规则时，可以设置当前字段的验证规则，验证失败就则输入插入失败。</p>
<h4 id="7-1-required-true-必传字段"><a href="#7-1-required-true-必传字段" class="headerlink" title="7.1 required: true 必传字段"></a>7.1 required: true 必传字段</h4><p>1.需要创建新的规则了。</p>
<ul>
<li>创建一个文章集合</li>
</ul>
<p>2.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost/ql_playground&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接失败&#x27;</span>, err))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.设定规则</span></span><br><span class="line"><span class="keyword">const</span> articleSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        <span class="comment">// 3.1设置必传字段</span></span><br><span class="line">        required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.使用规则创建集合</span></span><br><span class="line"><span class="keyword">const</span> Article1 = mongoose.model(<span class="string">&#x27;Article&#x27;</span>, articleSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.向集合中插入文档</span></span><br><span class="line">Article1.create(&#123; <span class="attr">name</span>: <span class="string">&#x27;JavaScript基础&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;黑马讲师&#x27;</span>, <span class="attr">isPublish</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">doc</span> =&gt;</span> <span class="built_in">console</span>.log(doc))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</span><br></pre></td></tr></table></figure>

<p>3.返回的错误，很不友好；</p>
<ul>
<li>1.如何自定义错误返回的信息？</li>
</ul>
<p>3.1 required的值，也可以是个数组，第二个参数，就是返回的信息；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6.设置返回信息</span></span><br><span class="line">required: [<span class="literal">true</span>, <span class="string">&#x27;请传入文章标题&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h4 id="7-2-长度"><a href="#7-2-长度" class="headerlink" title="7.2 长度"></a>7.2 长度</h4><p>minlength：3 字符串最小长度</p>
<p>maxlength: 20 字符串最大长度</p>
<p>1.语法一样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7.长度验证语法也一样</span></span><br><span class="line">minlength: [<span class="number">2</span>, <span class="string">&#x27;标题长度不能小于2&#x27;</span>],</span><br><span class="line">maxlength: [<span class="number">10</span>, <span class="string">&#x27;标题长度不能大于10&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h4 id="7-3-数值"><a href="#7-3-数值" class="headerlink" title="7.3 数值"></a>7.3 数值</h4><p>1.上面是针对字符串，数值针对 数值类型；</p>
<p>min: 2 数值最小为2<br>max: 100 数值最大为100</p>
<p>2.语法和上面一样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8.数值验证</span></span><br><span class="line">age: &#123;</span><br><span class="line">    type: <span class="built_in">Number</span>,</span><br><span class="line">    min: [<span class="number">18</span>, <span class="string">&#x27;未满18不行&#x27;</span>],</span><br><span class="line">    max: [<span class="number">150</span>, <span class="string">&#x27;仙人，你破戒了！&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="7-4-default-默认值"><a href="#7-4-default-默认值" class="headerlink" title="7.4 default: 默认值"></a>7.4 default: 默认值</h4><p>1.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 9.写个发布时间的数据</span></span><br><span class="line">    publishDate: &#123;</span><br><span class="line">        type: <span class="built_in">Date</span>,</span><br><span class="line">        <span class="comment">// 9.1 默认为当前电脑时间</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="built_in">Date</span>.now,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="7-5-枚举"><a href="#7-5-枚举" class="headerlink" title="7.5 枚举"></a>7.5 枚举</h4><p>1.enum[^19]: [‘html’, ‘css’, ‘javascript’, ‘node.js’]</p>
<ul>
<li>是单词前4个字母</li>
</ul>
<p>2.枚举可以规定值只能取哪些。</p>
<ul>
<li>写了这个键值对，如果传入的不是其中的某一个值，则验证失败</li>
</ul>
<p>3.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10.分类</span></span><br><span class="line">    category: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        <span class="comment">// 10.1 枚举分类的值</span></span><br><span class="line">        enum: [<span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;css&#x27;</span>, <span class="string">&#x27;node.js&#x27;</span>, <span class="string">&#x27;node&#x27;</span>],</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="7-6-validate-自定义验证器"><a href="#7-6-validate-自定义验证器" class="headerlink" title="7.6 validate: 自定义验证器"></a>7.6 validate: 自定义验证器</h4><p>1.当前所说的，都是mongoose里面常用的验证规则。</p>
<p>2.validate本身是一个对象</p>
<ul>
<li>下面有一个方法validator<ul>
<li>这个函数有一个参数v。<ul>
<li>这个参数是：当前用户传递的时候的那个值。</li>
</ul>
</li>
<li>我们可以在这个函数体里，对这个值验证<ul>
<li>返回布尔值，true验证成功，false验证失败，v要验证的值。</li>
</ul>
</li>
</ul>
</li>
<li>键：message；<ul>
<li>自定义错误信息</li>
</ul>
</li>
</ul>
<p>3.代码实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 11.自定义</span></span><br><span class="line">    author: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        validate: &#123;</span><br><span class="line">            validator: <span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> v.length &lt; <span class="number">5</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 自定义错误信息</span></span><br><span class="line">            message: <span class="string">&#x27;当前数据不符合规则&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="8-获取报错信息"><a href="#8-获取报错信息" class="headerlink" title="8. 获取报错信息"></a>8. 获取报错信息</h3><h4 id="8-1-直接-catch"><a href="#8-1-直接-catch" class="headerlink" title="8.1 直接.catch"></a>8.1 直接.catch</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.向集合中插入文档</span></span><br><span class="line">Article1.create(&#123; <span class="attr">title</span>: <span class="string">&#x27;abc&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;sadasd&#x27;</span> &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">doc</span> =&gt;</span> <span class="built_in">console</span>.log(doc))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</span><br></pre></td></tr></table></figure>

<p>1.报错信息返回的是一个errors对象。还不错</p>
<ul>
<li>报错对象里面有键值对。</li>
<li>如何拿到某一个？</li>
</ul>
<p>1.1报错图：</p>
<p><img src="../../img/15/42.png" alt="41"></p>
<h4 id="8-2-获取errors对象的值"><a href="#8-2-获取errors对象的值" class="headerlink" title="8.2 获取errors对象的值"></a>8.2 获取errors对象的值</h4><p>1.取对象的值，最好用for in 循环，这个是动态的。如果键值对增对，也能取出来；不需要改代码；</p>
<p>2.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> err2 = err.errors;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> err2) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err2[attr]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>1.先拿到errors对象</li>
<li>然后遍历这个对象</li>
<li>然后这个<code>err2[attr][&#39;message&#39;]</code><ul>
<li>啥意思来着？</li>
<li>如果不写<code>[&#39;message&#39;]</code>,会怎样？</li>
</ul>
</li>
</ul>
<p><img src="../../img/15/41.png" alt="41"></p>
<p>2.如果返回的有这样的：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">properties: &#123;</span><br><span class="line">  validator: [<span class="keyword">Function</span> <span class="title"></span>(anonymous)],</span><br></pre></td></tr></table></figure>

<ul>
<li>翻译：</li>
</ul>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">属性：</span><span class="template-variable">&#123;</span></span><br><span class="line"><span class="template-variable">    验证器：[函数(匿名)]</span></span><br><span class="line"><span class="template-variable">&#125;</span></span><br></pre></td></tr></table></figure>



<p>2.1 说明是没有写<code>validate</code>;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10.分类</span></span><br><span class="line"> category: &#123;</span><br><span class="line">     type: <span class="built_in">String</span>,</span><br><span class="line">     <span class="comment">// 10.1 枚举分类的值</span></span><br><span class="line">     enum: &#123;</span><br><span class="line">         values: [<span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;css&#x27;</span>, <span class="string">&#x27;javascript&#x27;</span>, <span class="string">&#x27;node.js&#x27;</span>],</span><br><span class="line">         message: <span class="string">&#x27;分类名称要在一定的范围内才可以&#x27;</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="comment">// 11.自定义</span></span><br><span class="line"> author: &#123;</span><br><span class="line">     type: <span class="built_in">String</span>,</span><br><span class="line">     validate: &#123;</span><br><span class="line">         validator: <span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">             <span class="keyword">return</span> v &amp;&amp; v.length &lt; <span class="number">5</span>;</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="comment">// 自定义错误信息</span></span><br><span class="line">         message: <span class="string">&#x27;当前数据不符合规则233&#x27;</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>





<h4 id="8-3-获取错误信息"><a href="#8-3-获取错误信息" class="headerlink" title="8.3 获取错误信息"></a>8.3 获取错误信息</h4><p>1.error.errors[‘字段名称’].message</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> err2 = err.errors;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> err2) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err2[attr][<span class="string">&#x27;message&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>2.直接返回message里的信息；</p>
<p><img src="../../img/15/43.png" alt="43"></p>
<hr>
<h3 id="9-集合关联"><a href="#9-集合关联" class="headerlink" title="9. 集合关联"></a>9. 集合关联</h3><p>1.通常不同集合的数据之间是有关系的，例如文章信息和用户信息存储在不同集合中，但文章是某个用户发表的，要查询文章的所有信息包括发表用户，就需要用到集合关联。</p>
<ul>
<li>使用id对集合进行关联<br>使用populate[^20]方法进行关联集合查询</li>
</ul>
<p><img src="../../img/15/44.png" alt="44"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户集合</span></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&#x27;User&#x27;</span>, <span class="keyword">new</span> mongoose.Schema(&#123; <span class="attr">name</span>: &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125; &#125;)); </span><br></pre></td></tr></table></figure>



<p>2.以前创建集合，第二个参数，是写的集合规则，而这里没有写规则，所以就直接把规则搬进来了</p>
<ul>
<li>不过还是分开写比较好。</li>
</ul>
<p>3.文章集合</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文章集合</span></span><br><span class="line"><span class="keyword">const</span> Post = mongoose.model(<span class="string">&#x27;Post&#x27;</span>, <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    title: &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">    <span class="comment">// 使用ID将文章集合和作者集合进行关联</span></span><br><span class="line">    author: &#123; <span class="attr">type</span>: mongoose.Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">&#x27;User&#x27;</span> &#125;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<ul>
<li>1.ref属性为关联，值为集合名称，单引号；估计双引号也行；</li>
<li>2.当前author字段，要与User集合关联；</li>
<li>3.<code>mongoose.Schema.Types.ObjectId</code>这一坨就是id的值；</li>
</ul>
<p>4.那么查询的时候，怎么把User集合中的author信息查询出来呢？</p>
<ul>
<li>看代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//联合查询</span></span><br><span class="line">Post.find()</span><br><span class="line">      .populate(<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">      .then(<span class="function">(<span class="params">err, result</span>) =&gt;</span> <span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>

<p>4.1 populate</p>
<ul>
<li>1.populate方法：查询关联集合的具体信息；<ul>
<li>要查询关联集合author的信息，写author进去就可以了</li>
</ul>
</li>
<li>2.</li>
</ul>
<h4 id="9-2-代码验证"><a href="#9-2-代码验证" class="headerlink" title="9.2 代码验证"></a>9.2 代码验证</h4><p>1.前面六步，都是准备</p>
<ul>
<li><p>它们分别是：</p>
<p>1.引入mongoose模块，先要下载</p>
<p>2.链接数据库，没创建也没事</p>
<p>3.创建用户集合规则</p>
<p>4.创建文字集合规则</p>
<p>5.创建用户集合</p>
<p>6.写author规则</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入mongoose模块，先要下载</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.链接数据库，没创建也没事</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost/ql_playground&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接失败&#x27;</span>, err))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.创建用户集合规则</span></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.创建文字集合规则</span></span><br><span class="line"><span class="keyword">const</span> postSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">        type: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 6.写author规则</span></span><br><span class="line">    author: &#123;</span><br><span class="line">        <span class="comment">// 6.1 类型_id</span></span><br><span class="line">        type: mongoose.Schema.Types.ObjectId,</span><br><span class="line">        <span class="comment">// 6.2关联User集合</span></span><br><span class="line">        ref: <span class="string">&#x27;User&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.创建用户集合</span></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&#x27;User&#x27;</span>, userSchema);</span><br><span class="line"><span class="comment">// 5.1 创建文章集合</span></span><br><span class="line"><span class="keyword">const</span> article = mongoose.model(<span class="string">&#x27;article&#x27;</span>, postSchema);</span><br></pre></td></tr></table></figure>



<p>2.第七步：能返回一下数据库User集合里面有哪些文档吗？</p>
<ul>
<li><p>这是一个新的js了，是否能根据名称联系，就看这次实验</p>
<ul>
<li>1.同样的数据库名：ql_playground</li>
<li>2.同样的数据库下面的集合名：User</li>
</ul>
</li>
<li><p>代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.find().then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回结果是：返回了当前里面的所有文档。</p>
<ul>
<li>实验成功</li>
<li>实验结论：能根据名称联系</li>
</ul>
</li>
</ul>
<p>3.第八步：</p>
<ul>
<li><p>1.删除里面的所有文档</p>
</li>
<li><p>代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8.before: 因为我以前给数据库，创建过User集合。所以先删除里面的全部文档</span></span><br><span class="line">User.deleteMany(&#123;&#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.验证结果，在数据库里面刷新查看：</p>
<ul>
<li>结果：This collection has no data</li>
<li>成功；</li>
</ul>
</li>
</ul>
<p>4.第九步：插入新的User文档</p>
<ul>
<li><p>1.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 9.给User集合，插入一条数据</span></span><br><span class="line">User.create(&#123; <span class="attr">name</span>: <span class="string">&#x27;shiYan1&#x27;</span> &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.结果：在数据库中查看</p>
<ul>
<li>成功有文档创建</li>
</ul>
</li>
</ul>
<p>5.第十步：创建新的文章集合文档</p>
<ul>
<li><p>1.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10：创建新的文章集合文档</span></span><br><span class="line"><span class="comment">// 10.1 author的值是数据库那边复制User集合文档的ID</span></span><br><span class="line">article.create(&#123; <span class="attr">title</span>: <span class="string">&#x27;123&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;607efb8b87c1963274926984&#x27;</span> &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>6.第11步，查询；</p>
<ul>
<li><p>1.我们先不写条件，直接查询，看看返回的是什么？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">article.find().then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.返回的结果：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi&gt; node .\<span class="number">7.</span>js</span><br><span class="line">数据库链接成功</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">607</span>efd02f6c8d337e4f68018,</span><br><span class="line">    title: <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">    author: <span class="number">607</span>efb8b87c1963274926984,</span><br><span class="line">    __v: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.在文章集合的规则中，author关联了User集合。</p>
<ul>
<li><p>1.在这里如何通过author返回出User那边的数据？</p>
</li>
<li><p>2.代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 11.3.2</span></span><br><span class="line">article.find().populate(<span class="string">&#x27;author&#x27;</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.在populate方法里面，写入你要查询的文档，的，关联字的信息</p>
<ul>
<li>1.这里要查询哪个文档？</li>
<li>2.这里要查询User集合里面的第一个文档</li>
<li>3.而这个文档怎么连接的？</li>
<li>4.通过postSchema文章规则里面的author规则关联的</li>
<li>5.所以这里写author。<ul>
<li>1.如果要关联多个咋办？我忽然想到，但这里先不管。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>4.返回结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi&gt; node .\<span class="number">7.</span>js</span><br><span class="line">数据库链接成功</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">607</span>efd02f6c8d337e4f68018,</span><br><span class="line">    title: <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">    author: &#123; <span class="attr">_id</span>: <span class="number">607</span>efb8b87c1963274926984, <span class="attr">name</span>: <span class="string">&#x27;shiYan1&#x27;</span>, <span class="attr">__v</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    __v: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>





</li>
</ul>
<p>7.这样就完成了：</p>
<ul>
<li>1.完成了，在查询b集合里的x文档信息的时候</li>
<li>2.把b.x里面关联了a.y的文档信息，也拿过来；</li>
</ul>
<p>8.集合关联主要是两步：</p>
<ul>
<li>1.关联</li>
<li>2.查询</li>
</ul>
<hr>
<p>下一页</p>
<h1 id="X-题注"><a href="#X-题注" class="headerlink" title="X. 题注"></a>X. 题注</h1><p>[^1]:global 英 [ˈɡləʊbl]   美 [ˈɡloʊbl]  adj.全球的;全世界的;整体的;全面的;总括的<br>派生词： globally adv.</p>
<p>[^2]:exports 英 [ɪkˈspɔːts]   美 [ɪkˈspɔːrts]  v.出口;输出;传播，输出(思想或活动);移出;调出<br>n.出口;输出;出口产品;输出品<br>export的第三人称单数和复数</p>
<p>[^3]:require 英 [rɪˈkwaɪə(r)]   美 [rɪˈkwaɪər] v. 需要;依靠;依赖;使做(某事);使拥有(某物);(尤指根据法规)规定<br>[^4]:join  英 [dʒɔɪn]   美 [dʒɔɪn]  v.连接;接合;联结;结合;联合;汇合;成为…的一员;参加;加入<br/>n.结合;连接;接合点<br>[^5]:desk英 [desk]   美 [desk]  n.书桌;写字台;办公桌;(机场、旅馆等的)问讯台，服务台，工作台;(报社、电视台等的)办公处，部，室，组<br>[^6]:task英  [tɑːsk]   美 [tæsk]  n.(尤指艰巨或令人厌烦的)任务，工作;(尤指语言教学中旨在帮助达到某一学习目的的)活动  v.交给某人(任务);派给某人(工作)<br>[^7]:pipe英 [paɪp]   美 [paɪp]  n.管子;管道;烟斗;烟袋;管乐器  v.用管道输送;用线路系统传输(或传送);用管乐器演奏(尤指迎宾曲)<br>[^8]:collapse英 [kəˈlæps]   美 [kəˈlæps]  <br />v.(突然)倒塌，坍塌;(尤指因病重而)倒下，昏倒，晕倒;(尤指工作劳累后)坐下，躺下放松<br/>n.突然失败，倒闭，崩溃(如机构、生意或行动的);(突然的)倒塌，塌陷，垮掉;病倒;(因病或体弱的)昏倒，晕倒<br>[^9]:gulp  英 [ɡʌlp]   美 [ɡʌlp] <br/>  v.狼吞虎咽;大口吞咽;匆匆吞下;(因害怕或惊讶而)倒吸气;深呼吸;喘大气;大口大口地吸气 <br/> n.吞饮的量;一大口;吞咽;吸入</p>
<p>[^10]:include  英 [ɪnˈkluːd]   美 [ɪnˈkluːd]   v.包括;包含;使成为…的一部分</p>
<p>[^11]:babel 英 [ˈbeɪbl]   美 [ˈbeɪbl]  n.嘈杂声(尤指讲多种语言)</p>
<p>[^12]:query  英 [ˈkwɪəri]   美 [ˈkwɪri]  n.疑问;询问;问号 v.怀疑;表示疑虑;询问</p>
<p>[^13]:mongoose 英 [ˈmɒŋɡuːs]   美 [ˈmɑːŋɡuːs]  n.獴(居于热带地区，捕食蛇、鼠等)<br>[^14]:schema 英 [ˈskiːmə]   美 [ˈskiːmə]  n.(计划或理论的)提要，纲要<br>[^15]:create  英 [kriˈeɪt]   美 [kriˈeɪt]  v.创造;创作;创建;造成，引起，产生(感觉或印象);授予;册封</p>
<p>[^16]:sort 英 [sɔːt]   美 [sɔːrt]  n.种类;类别;品种;某一种(或某一类)人;分类;排序 v.整理;把…分类;妥善处理;安排妥当<br>[^17]:many  英 [ˈmeni]   美 [ˈmeni]  det./pron.许多(与复数名词及动词连用，尤用于否定句或正式用语，表示大量;也用于疑问句以询问数字大小，并可与as、so 和 too 连用);(与复数动词连用)大多数人;(与单数名词及动词连用)许多，大量  adj.许多;多的</p>
<p>[^18]:modified  英 [ˈmɒdɪfaɪd]   美 [ˈmɑːdɪfaɪd]  v.调整;稍作修改;使更适合;缓和;使温和;修饰<br/>modify的过去分词和过去式<br>[^19]:enumerate 英 [ɪˈnjuːməreɪt]   美 [ɪˈnuːməreɪt]  v.列举;枚举<br>[^20]:populate英 [ˈpɒpjuleɪt]   美 [ˈpɑːpjuleɪt]  v.居住于;生活于;构成…的人口;迁移;移居;殖民于;(给文件)增添数据，输入数据</p>
<p>[^21]:resolve英 [rɪˈzɒlv]   美 [rɪˈzɑːlv]  v.解决(问题或困难);决心;决定;作出决定;作出决议;表决n.决心;坚定的信念<br>[^22]:reject英 [rɪˈdʒekt , ˈriːdʒekt]  美 [rɪˈdʒekt , ˈriːdʒekt]  v.拒绝接受;不予考虑;拒收;不录用;拒绝接纳;(因质量差)不用，不出售，不出版n.废品;次品;不合格者;被剔除者;被拒收者</p>
<p>[^23]:manager英 [ˈmænɪdʒə(r)]   美 [ˈmænɪdʒər]  n.(企业、店铺等的)经理，经营者，老板;(演员、作曲家等的)经理人，经纪人，个人经理;(运动队的)主教练<br>[^24]:registry英 [ˈredʒɪstri]   美 [ˈredʒɪstri]  n.登记处;注册处<br>[^25]:dependencies 英 [dɪˈpɛndənsiz]   美 [dɪˈpɛndənsiz]  n.(尤指不正常或不必要的)依靠，依赖;附属国;附属地 ; dependency的复数</p>
<p>[^26]:model英 [ˈmɒdl]   美 [ˈmɑːdl]  n.依照实物按比例制成的)模型;样式;设计;型;(用于示范运作方法等的)模型v.做模特儿;(向顾客)穿戴展示;将…做成模型;复制<br>[^27]:host英 [həʊst]   美 [hoʊst]  n.主人;东道主;主办国(或城市、机构);(电视或广播的)节目主持人v.主办，主持(活动);主持(电视或广播节目等);作为主人组织(聚会);做东</p>
<h3 id="末尾"><a href="#末尾" class="headerlink" title="末尾"></a>末尾</h3>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/node/" rel="tag"># node</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/1-(0~50)/14-galgame/" rel="prev" title="14-galgame">
      <i class="fa fa-chevron-left"></i> 14-galgame
    </a></div>
      <div class="post-nav-item">
    <a href="/1-(0~50)/16-Python-collect_%E6%94%B6%E8%97%8F/" rel="next" title="16-Python-collect">
      16-Python-collect <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qilin</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">759k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">11:30</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    new Valine(Object.assign({
      el  : '#valine-comments',
      path: location.pathname,
    }, {"enable":true,"appId":"l9X7oYVrse5t6umGkFbQyhXs-gzGzoHsz","appKey":"dcwRazDbDakW6HdC3xERrYHu","placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"language":null,"visitor":true,"comment_count":true,"recordIP":true,"serverURLs":null}
    ));
  }, window.Valine);
});
</script>


  
  <script type="text/javascript" onmobile="true" color="0,0,0" opacity='0.7' zIndex="-1" count="120" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  

</body>
</html>
