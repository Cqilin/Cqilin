<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|Amita:300,300italic,400,400italic,700,700italic|Montserrat:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-loading-bar.min.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cqilin.gitee.io","root":"/","scheme":"Gemini","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"path":"search.xml"};
  </script>

  <meta name="description" content="4. 数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="15.1-node.js">
<meta property="og:url" content="https://cqilin.gitee.io/1-(0~50)/15.1-nodeJS/index.html">
<meta property="og:site_name" content="qilin&#39;s blog">
<meta property="og:description" content="4. 数据库">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/45.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/46.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/47.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/48.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/49.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/50.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/51.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/51.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15/52.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/1.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/2.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/3.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/4.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/5.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/6.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/7.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/8.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/9.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/10.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/11.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/12.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/13.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/14.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/15.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/16.png">
<meta property="og:image" content="https://cqilin.gitee.io/img/15.1/17.png">
<meta property="article:published_time" content="2021-04-21T01:42:40.000Z">
<meta property="article:modified_time" content="2021-05-23T15:58:55.550Z">
<meta property="article:author" content="qilin">
<meta property="article:tag" content="node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cqilin.gitee.io/img/15/45.png">

<link rel="canonical" href="https://cqilin.gitee.io/1-(0~50)/15.1-nodeJS/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>15.1-node.js | qilin's blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">qilin's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">web学习笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于我</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">23</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">9</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">50</span></a>

  </li>
        <li class="menu-item menu-item-guestbook">

    <a href="/guestbook/" rel="section"><i class="fa fa-comment fa-fw"></i>留言</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">4. 数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="nav-text">10. 案例：用户信息增删改查</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-%E6%90%AD%E5%BB%BA%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">10.1 搭建网站服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">10.2 连接数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-%E5%BD%93%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE-list%E6%97%B6%EF%BC%8C%E5%B0%86%E6%89%80%E6%9C%89%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E5%87%BA%E6%9D%A5"><span class="nav-text">10.3 当用户访问&#x2F;list时，将所有用户信息查询出来</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%9E%E7%8E%B0%E8%B7%AF%E7%94%B1%E5%8A%9F%E8%83%BD"><span class="nav-text">1.实现路由功能</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="nav-text">2.请求地址：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84%EF%BC%9A"><span class="nav-text">3.请求路径：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E5%88%A4%E6%96%AD%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F"><span class="nav-text">4. 判断请求方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%91%88%E7%8E%B0%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="nav-text">2.呈现用户列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="nav-text">3.查询用户信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-4-%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%8A%9F%E8%83%BD"><span class="nav-text">10.4 添加用户功能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%85%88%E5%8A%A0%E5%85%A5add%E9%A1%B5%E9%9D%A2%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%9B"><span class="nav-text">1. 先加入add页面的请求；</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%87%86%E5%A4%87%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-text">2. 准备功能实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%80%BB%E7%BB%93"><span class="nav-text">4. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-5-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7"><span class="nav-text">10.5 修改用户</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E4%BF%AE%E6%94%B9%E5%8A%9F%E8%83%BD"><span class="nav-text">2. 实现用户修改功能</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E6%8C%87%E5%AE%9A%E8%A1%A8%E5%8D%95%E7%9A%84%E6%8F%90%E4%BA%A4%E5%9C%B0%E5%9D%80%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E3%80%82"><span class="nav-text">1.指定表单的提交地址，以及请求方式。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E4%BF%AE%E6%94%B9"><span class="nav-text">2.修改</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-6-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="nav-text">10.6 删除用户</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%80%9D%E8%B7%AF"><span class="nav-text">1. 思路</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E4%BB%A3%E7%A0%81"><span class="nav-text">2. 代码</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-text">2.2 重定向</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E7%A0%B4%E6%A1%88%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-text">3.破案重定向</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E6%97%A0%E6%95%88%E5%8F%88%E4%B8%8D%E6%8A%A5%E9%94%99"><span class="nav-text">4. 无效又不报错</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-7-%E6%A1%88%E4%BE%8B%E4%BC%98%E5%8C%96"><span class="nav-text">10.7 案例优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91"><span class="nav-text">1. 模块开发</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-0-%E5%88%86%E7%A6%BB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">1.0 分离数据库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-%E5%BC%80%E6%94%BE%E5%87%BA%E5%8E%BB"><span class="nav-text">1.1 开放出去</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-%E5%BC%95%E5%85%A5%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97"><span class="nav-text">1.2 引入其他模块</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-%E6%B5%8B%E8%AF%95%E5%88%86%E7%A6%BB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">1.3 测试分离数据库</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="nav-text">2. 字符串拼接</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8EartTemplate"><span class="nav-text">5. 模板引擎artTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">5.1 模板引擎的基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-text">1. 模板引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-art-template%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-text">2. art-template模板引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E4%BB%A3%E7%A0%81%E7%BB%83%E4%B9%A0"><span class="nav-text">2.1 代码练习</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA"><span class="nav-text">1. 创建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-art"><span class="nav-text">2. art</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-JS"><span class="nav-text">3. JS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E6%89%A9%E5%B1%95"><span class="nav-text">4. 扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#4-1-path-join"><span class="nav-text">4.1 path.join</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-2-dirname"><span class="nav-text">4.2 __dirname</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-3-%E5%B0%81%E8%A3%85%E5%87%BD%E6%95%B0%EF%BC%8C%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85"><span class="nav-text">4.3 封装函数，函数封装</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%AF%AD%E6%B3%95"><span class="nav-text">3. 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E8%BE%93%E5%87%BA"><span class="nav-text">3.1 输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E5%8E%9F%E6%96%87%E8%BE%93%E5%87%BA"><span class="nav-text">3.2 原文输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-text">3.3 条件判断</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E6%A0%87%E5%87%86%E8%AF%AD%E6%B3%95"><span class="nav-text">1. 标准语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%8E%9F%E5%A7%8B%E8%AF%AD%E6%B3%95"><span class="nav-text">2. 原始语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E8%87%AA%E5%86%99%EF%BC%9A"><span class="nav-text">3. 自写：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-%E5%BE%AA%E7%8E%AF"><span class="nav-text">3.4 循环</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E8%AF%AD%E6%B3%95"><span class="nav-text">1. 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-1-%E6%A0%87%E5%87%86%E8%AF%AD%E6%B3%95"><span class="nav-text">1.1 标准语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-2-%E5%8E%9F%E5%A7%8B%E8%AF%AD%E6%B3%95"><span class="nav-text">1.2 原始语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-3-%E6%80%BB%E4%BB%A3%E7%A0%81"><span class="nav-text">1.3 总代码</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%A4%8D%E4%B9%A0"><span class="nav-text">2. 复习</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-%E5%AD%90%E6%A8%A1%E6%9D%BF"><span class="nav-text">3.5 子模板</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E4%BB%A3%E7%A0%81"><span class="nav-text">1. 代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%8E%9F%E5%A7%8B%E8%AF%AD%E6%B3%95-1"><span class="nav-text">2. 原始语法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF"><span class="nav-text">3.6 模板继承</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA"><span class="nav-text">2. 代码演示</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%80%BB%E7%BB%93"><span class="nav-text">3. 总结</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-%E6%A8%A1%E6%9D%BF%E9%85%8D%E7%BD%AE"><span class="nav-text">3.7 模板配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%AF%BC%E5%85%A5%E5%8F%98%E9%87%8F"><span class="nav-text">1. 导入变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%AE%BE%E7%BD%AE%E6%A0%B9%E7%9B%AE%E5%BD%95"><span class="nav-text">2. 设置根目录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%90%8E%E7%BC%80"><span class="nav-text">3. 后缀</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E6%A1%88%E4%BE%8B%E4%BB%8B%E7%BB%8D-%E2%80%93-%E5%AD%A6%E7%94%9F%E6%A1%A3%E6%A1%88%E7%AE%A1%E7%90%86"><span class="nav-text">5.2 案例介绍 – 学生档案管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%B6%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text">1. 制作流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%9B%E5%BB%BA"><span class="nav-text">1.1 初始化创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">1.2 创建本地服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-%E9%93%BE%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">1.3 链接数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-%E8%B7%AF%E7%94%B1"><span class="nav-text">1.4 路由</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97-router"><span class="nav-text">1. 第三方模块 router</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF%E5%91%88%E9%80%92"><span class="nav-text">1.5 页面模板呈递</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97-serve-static"><span class="nav-text">1. 第三方模块 serve-static</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2"><span class="nav-text">2. 列表页面</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">1.6 传递数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E8%A1%A8%E5%8D%95%E6%93%8D%E4%BD%9C"><span class="nav-text">1.表单操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%B7%AF%E7%94%B1"><span class="nav-text">2. 路由</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E4%BC%A0%E9%80%92%E7%BB%99%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">3. 传递给数据库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E5%AE%8C%E6%AF%95"><span class="nav-text">4. 完毕</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-7-list%E5%91%88%E7%8E%B0"><span class="nav-text">1.7 list呈现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%88%86%E6%9E%90"><span class="nav-text">1. 分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E6%A8%A1%E6%9D%BF%E6%8B%BC%E6%8E%A5"><span class="nav-text">2. 模板拼接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%A0%BC%E5%BC%8F%E9%97%AE%E9%A2%98"><span class="nav-text">3. 格式问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BC%98%E5%8C%96"><span class="nav-text">2. 优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E8%B7%AF%E7%94%B1"><span class="nav-text">2.1 路由</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-Express%E6%A1%86%E6%9E%B6"><span class="nav-text">6. Express框架</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-Express%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="nav-text">6.1 Express框架简介及初体验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Express%E6%A1%86%E6%9E%B6%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">1. Express框架是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Express%E6%A1%86%E6%9E%B6%E7%89%B9%E6%80%A7"><span class="nav-text">2. Express框架特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AF%B9%E6%AF%94%E4%B9%8B%E8%B7%AF%E7%94%B1"><span class="nav-text">3. 对比之路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AF%B9%E6%AF%94%E4%B9%8B%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="nav-text">4. 对比之获取请求参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Express%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="nav-text">5. Express初体验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-text">6.2 中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-text">1. 什么是中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-app-use%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%94%A8%E6%B3%95"><span class="nav-text">2. app.use中间件用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%BA%94%E7%94%A8"><span class="nav-text">3. 中间件应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-text">4. 错误处理中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E5%90%8C%E6%AD%A5%E5%87%BA%E9%94%99"><span class="nav-text">4.1 同步出错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-%E5%BC%82%E6%AD%A5%E5%87%BA%E9%94%99"><span class="nav-text">4.2 异步出错</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF"><span class="nav-text">5. 捕获错误</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-Express%E6%A1%86%E6%9E%B6%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86"><span class="nav-text">6.3 Express框架请求处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9D%97%E5%8C%96%E8%B7%AF%E7%94%B1"><span class="nav-text">1. 构建模块化路由</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1"><span class="nav-text">1.1 创建路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="nav-text">1.2 路由模块化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-GET%E5%8F%82%E6%95%B0%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="nav-text">2. GET参数的获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-post%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96"><span class="nav-text">3. post参数获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-app-user%E6%96%B9%E6%B3%95%E7%96%91%E6%83%91"><span class="nav-text">4. app.user方法疑惑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Express%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0"><span class="nav-text">5. Express路由参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-text">6. 静态资源的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-express-art-template%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-text">7. express-art-template模板引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-app-locals-%E5%AF%B9%E8%B1%A1"><span class="nav-text">8. app.locals 对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#X-%E9%A2%98%E6%B3%A8"><span class="nav-text">X. 题注</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AB%E5%B0%BE"><span class="nav-text">末尾</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="qilin"
      src="/images/7.jpg">
  <p class="site-author-name" itemprop="name">qilin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://cqilin.gitee.io/1-(0~50)/15.1-nodeJS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/7.jpg">
      <meta itemprop="name" content="qilin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qilin's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          15.1-node.js
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-21 09:42:40" itemprop="dateCreated datePublished" datetime="2021-04-21T09:42:40+08:00">2021-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-23 23:58:55" itemprop="dateModified" datetime="2021-05-23T23:58:55+08:00">2021-05-23</time>
              </span>

          
            <span id="/1-(0~50)/15.1-nodeJS/" class="post-meta-item leancloud_visitors" data-flag-title="15.1-node.js" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/1-(0~50)/15.1-nodeJS/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/1-(0~50)/15.1-nodeJS/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>95k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:26</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="4-数据库"><a href="#4-数据库" class="headerlink" title="4. 数据库"></a>4. 数据库</h1><a id="more"></a>

<h2 id="10-案例：用户信息增删改查"><a href="#10-案例：用户信息增删改查" class="headerlink" title="10. 案例：用户信息增删改查"></a>10. 案例：用户信息增删改查</h2><p>搭建网站服务器，实现客户端与服务器端的通信<br>连接数据库，创建用户集合，向集合中插入文档<br>当用户访问/list时，将所有用户信息查询出来<br>将用户信息和表格HTML进行拼接并将拼接结果响应回客户端<br>当用户访问/add时，呈现表单页面，并实现添加用户信息功能<br>当用户访问/modify时，呈现修改页面，并实现修改用户信息功能<br>当用户访问/delete时，实现用户删除功能</p>
<h3 id="10-1-搭建网站服务器"><a href="#10-1-搭建网站服务器" class="headerlink" title="10.1 搭建网站服务器"></a>10.1 搭建网站服务器</h3><p>搭建网站服务器，实现客户端与服务器端的通信</p>
<p>1.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.搭建网站服务器，实现客户端与服务器端的通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.1 创建服务器</span></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.3 为服务器添加请求事件</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.2 监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>



<h3 id="10-2-连接数据库"><a href="#10-2-连接数据库" class="headerlink" title="10.2 连接数据库"></a>10.2 连接数据库</h3><p>1.引入mongoose第三方模块。</p>
<ul>
<li><p>1.这里也许会疑问，目录下没有node_modules，能引入成功吗？</p>
</li>
<li><p>2.可以的，查找规则：</p>
<ul>
<li>当前目录没有</li>
<li>返回上级目录查找</li>
</ul>
</li>
<li><p>3.具体规则去看看笔记：15-node.js-2-2.5;</p>
</li>
<li><p>1.然而，我过去看了后，没这一点</p>
</li>
<li><p>4.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.引入mongoose模块</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>2.数据库链接</p>
<ul>
<li><p>1.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.1 数据库链接</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/ql_playground&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接失败&#x27;</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.运行代码，成功</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi\<span class="number">4</span>-案例：User&gt; nodemon .\app.js</span><br><span class="line">[nodemon] <span class="number">2.0</span><span class="number">.7</span></span><br><span class="line">[nodemon] to restart at any time, enter <span class="string">`rs`</span></span><br><span class="line">[nodemon] watching path(s): *.*</span><br><span class="line">[nodemon] watching extensions: js,mjs,json</span><br><span class="line">[nodemon] starting <span class="string">`node .\app.js`</span></span><br><span class="line">数据库链接成功</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>2.1 创建用户集合规则</p>
<ul>
<li><p>1.代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.2 创建用户集合规则</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        maxlength: <span class="number">15</span></span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        min: <span class="number">12</span></span><br><span class="line">    &#125;,</span><br><span class="line">    password: <span class="built_in">String</span>,</span><br><span class="line">    email: <span class="built_in">String</span>,</span><br><span class="line">    hobbies: [<span class="built_in">String</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>2.2 创建用户集合</p>
<ul>
<li><p>1.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.3 创建用户集合</span></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&#x27;User&#x27;</span>, user);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>2.3 在命令行工具那边导入user.json数据</p>
<ul>
<li><p>1.命令：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongoimport -d playground -c<span class="built_in"> users </span>--file <span class="built_in">..</span>/user.json</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>2.4 完毕</p>
<h3 id="10-3-当用户访问-list时，将所有用户信息查询出来"><a href="#10-3-当用户访问-list时，将所有用户信息查询出来" class="headerlink" title="10.3 当用户访问/list时，将所有用户信息查询出来"></a>10.3 当用户访问/list时，将所有用户信息查询出来</h3><p>1.实现路由功能</p>
<p>2.呈现用户列表页面</p>
<p>3.从数据库中查询用户信息，将用户信息展示在列表中</p>
<h4 id="1-实现路由功能"><a href="#1-实现路由功能" class="headerlink" title="1.实现路由功能"></a>1.实现路由功能</h4><p>1.要实现路由功能</p>
<ul>
<li>1.首先要获得用户的请求方式，请求地址。</li>
<li>2.对请求方式，请求地址判断。</li>
<li>3.这个路由功能就实现了（？？？</li>
</ul>
<h5 id="2-请求地址："><a href="#2-请求地址：" class="headerlink" title="2.请求地址："></a>2.请求地址：</h5><ul>
<li><p>1.代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.获取请求方式</span></span><br><span class="line"><span class="keyword">const</span> method = req.method;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h5 id="3-请求路径："><a href="#3-请求路径：" class="headerlink" title="3.请求路径："></a>3.请求路径：</h5><ul>
<li><p>1.先引入url</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.1 引入url</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.然后</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.获取请求路径，先要引入url模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; pathname &#125; = url.parse(req.url)</span><br></pre></td></tr></table></figure>

<ul>
<li>const { pathname }的写法，是对象解构的写法<ul>
<li>笔记：25.4\A1\A1.2\4.2</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="4-判断请求方式"><a href="#4-判断请求方式" class="headerlink" title="4. 判断请求方式"></a>4. 判断请求方式</h5><p>1.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10.3.1.4</span></span><br><span class="line">   <span class="keyword">if</span> (method == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-呈现用户列表"><a href="#2-呈现用户列表" class="headerlink" title="2.呈现用户列表"></a>2.呈现用户列表</h4><p>1.1 因为需求：呈现用户列表页面</p>
<ul>
<li><p>在地址栏里面的请求，都是get</p>
</li>
<li><p>1.所以在get里面添加代码：把\list的判断，写在get里面</p>
<ul>
<li>get一般是数据的请求，页面的成立等</li>
<li>post一般是功能，删除，注册，添加修改数据；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list = <span class="string">`&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;用户列表&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h6&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;add.html&quot; class=&quot;btn btn-primary&quot;&gt;添加用户&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/h6&gt;</span></span><br><span class="line"><span class="string">                &lt;table class=&quot;table table-striped table-bordered&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;tr&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;用户名&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;年龄&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;爱好&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;邮箱&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;操作&lt;/td&gt;</span></span><br><span class="line"><span class="string">                    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">                    &lt;tr&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;张三&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;20&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;</span></span><br><span class="line"><span class="string">                            &lt;span&gt;抽烟&lt;/span&gt;</span></span><br><span class="line"><span class="string">                            &lt;span&gt;喝酒&lt;/span&gt;</span></span><br><span class="line"><span class="string">                            &lt;span&gt;烫头&lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;zhangsan@itcast.cn&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;</span></span><br><span class="line"><span class="string">                            &lt;a href=&quot;&quot; class=&quot;btn btn-danger btn-xs&quot;&gt;删除&lt;/a&gt;</span></span><br><span class="line"><span class="string">                            &lt;a href=&quot;&quot; class=&quot;btn btn-success btn-xs&quot;&gt;修改&lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;/td&gt;</span></span><br><span class="line"><span class="string">                    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">                &lt;/table&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;`</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.注意里面是模板字符串，是反引号，是1左边那个；</p>
</li>
</ul>
<p>1.2 这样，路径：<a target="_blank" rel="noopener" href="http://localhost:3000/list">http://localhost:3000/list</a></p>
<ul>
<li>能呈现出html页面</li>
<li>不过我觉得肯定不是这样写，这因为是为了学习，给展示的原始写法。、</li>
</ul>
<h4 id="3-查询用户信息"><a href="#3-查询用户信息" class="headerlink" title="3.查询用户信息"></a>3.查询用户信息</h4><p>1.从数据库中查询用户信息，将用户信息展示在列表中</p>
<p>2.代码：</p>
<ul>
<li><p>find里面什么都不写，默认查找全部信息</p>
<p><code>User.find().then((result) =&gt; console.log(result))</code></p>
</li>
<li><p>视频说当前我们不使用.then方式，使用异步函数的方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6.查询用户信息</span></span><br><span class="line"><span class="comment">// 6.1 这里没有用.then，而是用的异步函数语法</span></span><br><span class="line"><span class="keyword">let</span> user_find = <span class="keyword">await</span> User.find()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>2.1 因为是写在get里面的，所以要在网页那边请求一下，才会打印出数据库user集合的文档</p>
<p>3.如何把数据库里的数据，与，html链接呢？</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=60&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=60&amp;spm_id_from=pageDriver</a></p>
<p>09.48</p>
</blockquote>
<ul>
<li>1.<code>$&#123;&#125;</code>是模板字符串里面特有的写法</li>
<li>item是数组的每一个值，而这里是对象。所以item.name等等可以读取数据</li>
</ul>
<p>3.1 单独说爱好，因为这里是数组。</p>
<ul>
<li><p>1.在用户集合规则里面，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hobbies: [<span class="built_in">String</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.而且数组里面的值，要显示在span当中</p>
<p><img src="../../img/15/45.png" alt="45"></p>
<ul>
<li>有多少个爱好，就要生成多少个span。</li>
<li>这又需要循环。（视频说的，这个怎么用循环做？</li>
</ul>
</li>
<li><p>3.然后说又要拆分：（后面绝对有新的办法，因为这种办法太繁琐）</p>
<p><img src="../../img/15/46.png" alt="46"></p>
</li>
</ul>
<p>3.2 拆分后的样子：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=60&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=60&amp;spm_id_from=pageDriver</a></p>
<p>14:46</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对数据进行循环操作</span></span><br><span class="line">        user_find.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            list += <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;item.name&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;item.age&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;                </span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            item.hobbies.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                list += <span class="string">`&lt;span&gt;<span class="subst">$&#123;item&#125;</span>&lt;/span&gt;`</span>;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            list += <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;item.email&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;&quot; class=&quot;btn btn-danger btn-xs&quot;&gt;删除&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;&quot; class=&quot;btn btn-success btn-xs&quot;&gt;修改&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;/tr&gt;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>到这里，列表展示用户的信息就做好了</li>
</ol>
<h3 id="10-4-添加用户功能"><a href="#10-4-添加用户功能" class="headerlink" title="10.4 添加用户功能"></a>10.4 添加用户功能</h3><h4 id="1-先加入add页面的请求；"><a href="#1-先加入add页面的请求；" class="headerlink" title="1. 先加入add页面的请求；"></a>1. 先加入add页面的请求；</h4><p>1.当用户访问/add时，呈现表单页面，并实现添加用户信息功能</p>
<p>1.1 因为请求是在get里面的，所以要在里面添加判断</p>
<p>1.2 代码：</p>
<img src="../../img/15/47.png" alt="47" style="zoom:80%;" />



<p>2.然后在list的模块标签里面，把按钮的href改为<code>/add</code></p>
<img src="../../img/15/48.png" alt="48" style="zoom:80%;" />



<h4 id="2-准备功能实现"><a href="#2-准备功能实现" class="headerlink" title="2. 准备功能实现"></a>2. 准备功能实现</h4><p>1.在add的模块标签里面，给表单，添加<code>method=&quot;post&quot;</code></p>
<img src="../../img/15/49.png" alt="49" style="zoom:80%;" />



<p>2.既然要把表单的信息传输给服务器，那是不是要有个名字</p>
<ul>
<li>最好与数据库里面的名字相同</li>
</ul>
<p>2.1 name，password，email那些；</p>
<p>3.当所有信息填写完毕，就会点击按钮提交</p>
<ul>
<li>这个时候，需要有个路由去处理这个事件；</li>
</ul>
<p>3.1 在post请求那里添加：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 用户添加功能</span></span><br><span class="line">        <span class="keyword">if</span> (pathname == <span class="string">&#x27;/add&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>当请求地址是add的时候，会有这个事件处理；<ul>
<li>不写个前置条件。不知道在哪里处理；</li>
</ul>
</li>
</ul>
<p>4.接受用户提交的信息，将用户提交的信息添加到数据库中。</p>
<p>4.1 服务器接受请求事件是什么？.on+req=req.on</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接受用户提交的信息</span></span><br><span class="line">req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>4.2 因为post请求，是一步一步做的；所以要用到循环用的+=</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 用户添加功能</span></span><br><span class="line">        <span class="keyword">if</span> (pathname == <span class="string">&#x27;/add&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 接受用户提交的信息</span></span><br><span class="line">            <span class="keyword">let</span> formData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">param</span> =&gt;</span> &#123;</span><br><span class="line">                formData += param;</span><br><span class="line">            &#125;)</span><br><span class="line">            req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(formData)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 将用户提交的信息添加到数据库中。</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.打印出的结果是：</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数据库链接成功</span><br><span class="line">name=123<span class="variable">&amp;password</span>=321<span class="variable">&amp;age</span>=123<span class="variable">&amp;email</span>=3213%40qq.com<span class="variable">&amp;hobbies</span>=<span class="name">%E6</span>%95<span class="name">%B2</span><span class="name">%E4</span><span class="name">%BB</span><span class="name">%A3</span><span class="name">%E7</span><span class="name">%A0</span>%81</span><br></pre></td></tr></table></figure>

<ul>
<li>1.是字符串类型</li>
<li>2.我们需要对象的样式</li>
</ul>
</li>
<li><p>2.修改成对象的样式：</p>
<ul>
<li><p>1.引入querystring</p>
</li>
<li><p><code>const querystring = require(&#39;querystring&#39;);</code>.</p>
</li>
<li><pre><code class="js">req.on(<span class="string">'end'</span>, () =&gt; &#123;
    <span class="built_in">console</span>.log(querystring.parse(formData));
&#125;)
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight csharp"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  + &lt;span class="number"&gt;2.&lt;/span&gt;在&lt;span class="number"&gt;15&lt;/span&gt;里面，post参数有这里笔记；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="meta"&gt;#### 3. 添加到数据库&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="number"&gt;1.&lt;/span&gt;将用户提交的信息添加到数据库中&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ 上面已经能获取表单里面，填写的东西了&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ 现在把它弄到数据库里面&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="number"&gt;2.&lt;/span&gt;代码：&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;```js&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="keyword"&gt;else&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; (method == &lt;span class="string"&gt;&amp;#x27;POST&amp;#x27;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;        &lt;span class="comment"&gt;// 用户添加功能&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;        &lt;span class="keyword"&gt;if&lt;/span&gt; (pathname == &lt;span class="string"&gt;&amp;#x27;/add&amp;#x27;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &lt;span class="comment"&gt;// 接受用户提交的信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &lt;span class="keyword"&gt;let&lt;/span&gt; formData = &lt;span class="string"&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            req.&lt;span class="keyword"&gt;on&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;data&amp;#x27;&lt;/span&gt;, param =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;                formData += param;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            req.&lt;span class="keyword"&gt;on&lt;/span&gt;(&lt;span class="string"&gt;&amp;#x27;end&amp;#x27;&lt;/span&gt;, &lt;span class="keyword"&gt;async&lt;/span&gt; () =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;                &lt;span class="keyword"&gt;let&lt;/span&gt; user_post = querystring.parse(formData);&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &lt;span class="comment"&gt;// 将用户提交的信息添加到数据库中。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &lt;span class="keyword"&gt;await&lt;/span&gt; User_collections.create(user_post);&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &lt;span class="comment"&gt;// 301代表重定向&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &lt;span class="comment"&gt;// location跳转地址&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            res.weiteHead(&lt;span class="number"&gt;301&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;                Location: &lt;span class="string"&gt;&amp;#x27;/list&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;            res.end();&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;


</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li>1.用await把数据库里的User集合插入文档设定<ul>
<li>这样就不用写回调函数了</li>
<li>但记得在前面加上async</li>
</ul>
</li>
<li>2.<code>res.weiteHead</code>有待查阅；</li>
</ul>
<h4 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h4><p>1.当用户在地址栏里面访问/add的时候</p>
<ul>
<li>我们呈递了添加用户的表单界面</li>
</ul>
<p>2.接下来</p>
<p>算了，不写了；</p>
<p>3.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @ts-nocheck</span></span><br><span class="line"><span class="comment">// 1.搭建网站服务器，实现客户端与服务器端的通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 2.引入mongoose模块</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="comment">// 4.1 引入url</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.1 数据库链接</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/playground&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接失败&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.2 创建用户集合规则</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        maxlength: <span class="number">15</span></span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        min: <span class="number">12</span></span><br><span class="line">    &#125;,</span><br><span class="line">    password: <span class="built_in">String</span>,</span><br><span class="line">    email: <span class="built_in">String</span>,</span><br><span class="line">    hobbies: [<span class="built_in">String</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.3 创建用户集合</span></span><br><span class="line"><span class="keyword">const</span> User_collections = mongoose.model(<span class="string">&#x27;User&#x27;</span>, user);</span><br><span class="line"><span class="comment">// 2.4 在命令行工具那边导入user.json数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.1 创建服务器</span></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.3 为服务器添加请求事件</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.获取请求方式</span></span><br><span class="line">    <span class="keyword">const</span> method = req.method;</span><br><span class="line">    <span class="comment">// 4.获取请求路径，先要引入url模块</span></span><br><span class="line">    <span class="keyword">const</span> &#123; pathname &#125; = url.parse(req.url)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 10.3.1.4</span></span><br><span class="line">    <span class="keyword">if</span> (method == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pathname == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6.查询用户信息</span></span><br><span class="line">            <span class="comment">// 6.1 这里没有用.then，而是用的异步函数语法</span></span><br><span class="line">            <span class="keyword">let</span> user_find = <span class="keyword">await</span> User_collections.find();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.1 10.3.1.4-1.1</span></span><br><span class="line">            <span class="comment">// html字符串</span></span><br><span class="line">            <span class="keyword">let</span> list = <span class="string">`&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;用户列表&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h6&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/add&quot; class=&quot;btn btn-primary&quot;&gt;添加用户&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/h6&gt;</span></span><br><span class="line"><span class="string">                &lt;table class=&quot;table table-striped table-bordered&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;tr&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;用户名&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;年龄&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;爱好&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;邮箱&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;操作&lt;/td&gt;</span></span><br><span class="line"><span class="string">                    &lt;/tr&gt;`</span>;</span><br><span class="line">            <span class="comment">// 对数据进行循环操作</span></span><br><span class="line">            user_find.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                list += <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;item.name&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;item.age&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;                </span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">                item.hobbies.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                    list += <span class="string">`&lt;span&gt;<span class="subst">$&#123;item&#125;</span>&lt;/span&gt;`</span>;</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                list += <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;item.email&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;&quot; class=&quot;btn btn-danger btn-xs&quot;&gt;删除&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;&quot; class=&quot;btn btn-success btn-xs&quot;&gt;修改&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;/tr&gt;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            list += <span class="string">`&lt;/table&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;`</span>;</span><br><span class="line">            res.end(list)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pathname == <span class="string">&#x27;/add&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> add = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;用户列表&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h3&gt;添加用户&lt;/h3&gt;</span></span><br><span class="line"><span class="string">        &lt;form method=&quot;post&quot; action=&quot;/add&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;label&gt;用户名&lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;input name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;请填写用户名&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;label&gt;密码&lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;form-control&quot; placeholder=&quot;请输入密码&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;label&gt;年龄&lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;input name=&quot;age&quot; type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;请填写邮箱&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;label&gt;邮箱&lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;input name=&quot;email&quot; type=&quot;email&quot; class=&quot;form-control&quot; placeholder=&quot;请填写邮箱&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;label&gt;请选择爱好&lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;div&gt;</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;游戏&quot;&gt; 游戏</span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;篮球&quot;&gt; 篮球</span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;游泳&quot;&gt; 游泳</span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;敲代码&quot;&gt; 敲代码</span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;二次元&quot;&gt; 二次元</span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;DL&quot;&gt; DL</span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;P站&quot;&gt; P站</span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;添加用户&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">            `</span></span><br><span class="line">            res.end(add)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 用户添加功能</span></span><br><span class="line">        <span class="keyword">if</span> (pathname == <span class="string">&#x27;/add&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 接受用户提交的信息</span></span><br><span class="line">            <span class="keyword">let</span> formData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">param</span> =&gt;</span> &#123;</span><br><span class="line">                formData += param;</span><br><span class="line">            &#125;)</span><br><span class="line">            req.on(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> user_post = querystring.parse(formData);</span><br><span class="line">                <span class="comment">// 将用户提交的信息添加到数据库中。</span></span><br><span class="line">                <span class="keyword">await</span> User_collections.create(user_post);</span><br><span class="line">                <span class="comment">// 301代表重定向</span></span><br><span class="line">                <span class="comment">// location跳转地址</span></span><br><span class="line">                res.writeHead(<span class="number">301</span>, &#123;</span><br><span class="line">                    Location: <span class="string">&#x27;/list&#x27;</span></span><br><span class="line">                &#125;);</span><br><span class="line">                res.end();</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.2 监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>



<h3 id="10-5-修改用户"><a href="#10-5-修改用户" class="headerlink" title="10.5 修改用户"></a>10.5 修改用户</h3><p>1.当用户访问/modify时，呈现修改页面，并实现修改用户信息功能</p>
<ul>
<li><p>1.增加页面路由，呈现页面</p>
<ul>
<li><p>1.在点击修改按钮的时候，将用户ID传递到当前页面</p>
</li>
<li><p>2.从数据库中查询当前用户信息，将用户信息展示到页面中</p>
</li>
</ul>
</li>
<li><p>2.实现用户修改功能</p>
</li>
</ul>
<p>2.先去相应的href修改：</p>
<p><img src="../../img/15/50.png" alt="50"></p>
<p>3.增加路由</p>
<ul>
<li><p>1.因为访问，也是从地址栏上访问的。所以从get</p>
<p><img src="../../img/15/51.png" alt="51"></p>
</li>
</ul>
<p>4.查询要被修改的数据</p>
<ul>
<li><p>1.要通过ID</p>
<p><code>const &#123; pathname, query &#125; = url.parse(req.url, true);</code></p>
</li>
<li><p>2.接着去拿id</p>
<p><code>let user_modify = await User_collections.find(&#123; _id: query.id &#125;);</code></p>
</li>
<li><p>3.打印测试一下；</p>
<p>发现是数组</p>
<p>改为findOne；</p>
<p>是对象了；</p>
</li>
</ul>
<p>5.接下来要把这个对象与html字符串进行拼接？拼接么？</p>
<p>又要分开：</p>
<ul>
<li>1.在模板字符串里面，改input里面的value的值<ul>
<li><code>value=&quot;$&#123;user.age&#125;&quot;</code></li>
<li><code>value=&quot;$&#123;user.name&#125;&quot;</code></li>
<li><code>value=&quot;$&#123;user.email&#125;&quot;</code></li>
<li>等等</li>
</ul>
</li>
<li>2.爱好要单独说；</li>
<li>3.刷新页面，修改用户的页面，会展示出被修改用户的信息；</li>
</ul>
<p>5.1 接下来，看爱好要怎么展示</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=62&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=62&amp;spm_id_from=pageDriver</a></p>
<p>8:49</p>
</blockquote>
<ul>
<li><p>1.先写一个爱好的数组：</p>
<p><code>let hobbies_modify = [&#39;游戏&#39;, &#39;篮球&#39;, &#39;游泳&#39;, &#39;敲代码&#39;, &#39;二次元&#39;, &#39;DL&#39;, &#39;P站&#39;]</code></p>
</li>
<li><p>2.然后又要拆分，中间写一个循环。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">hobbies_modify.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 判断当前循环项在不在用户的爱好数据组</span></span><br><span class="line">                <span class="keyword">let</span> isHobby = user_modify.hobbies.includes(item);</span><br><span class="line">                <span class="keyword">if</span> (isHobby) &#123;</span><br><span class="line">                    modify += <span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;<span class="subst">$&#123;item&#125;</span>&quot; checked&gt; <span class="subst">$&#123;item&#125;</span></span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    `</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    modify += <span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;label class=&quot;checkbox-inline&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; name=&quot;hobbies&quot; value=&quot;<span class="subst">$&#123;item&#125;</span>&quot;&gt; <span class="subst">$&#123;item&#125;</span></span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    `</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure>



<p>5.2 解析：<code>let isHobby = user_modify.hobbies.includes(item);</code></p>
<ul>
<li>1.<code>user_modify.hobbies</code>就是一个数组</li>
<li>2.因为<code>user_modify</code>，已经是一个根据id获取文档对象的常量了<ul>
<li>里面的hobbies也是一个数组。</li>
</ul>
</li>
</ul>
<h4 id="2-实现用户修改功能"><a href="#2-实现用户修改功能" class="headerlink" title="2. 实现用户修改功能"></a>2. 实现用户修改功能</h4><h5 id="1-指定表单的提交地址，以及请求方式。"><a href="#1-指定表单的提交地址，以及请求方式。" class="headerlink" title="1.指定表单的提交地址，以及请求方式。"></a>1.指定表单的提交地址，以及请求方式。</h5><p>1.去修改action=“/modify”</p>
<p>2.在post添加新的路由；</p>
<ul>
<li><p>1.把post里面的add复制过来</p>
<p><img src="../../img/15/51.png" alt="51"></p>
</li>
</ul>
<ul>
<li><p>2.把插入，改为更新：</p>
<img src="../../img/15/52.png" alt="51" style="zoom:80%;" />



</li>
</ul>
<h5 id="2-修改"><a href="#2-修改" class="headerlink" title="2.修改"></a>2.修改</h5><p>0.接受客户端传递过来的修改信息，找到用户，将用户信息更改为最新的。</p>
<p>1.在页面上看url，是有id</p>
<p>2.但是，点击修改页面，就没有id了</p>
<ul>
<li>为什么呢？</li>
</ul>
<p>2.1 因为修改页面的跳转，是上面 get请求事件里面的第三个判断</p>
<ul>
<li><p>1.人家里面有代码</p>
<p><code>let user_modify = await User_collections.findOne(&#123; _id: query.id &#125;);</code></p>
</li>
</ul>
<p>2.2 那么修改页面也会去get请求里面，写一个响应码？</p>
<ul>
<li>看视频；</li>
</ul>
<p>3.先去模块字符串里面，修改action</p>
<p><code>&lt;form method=&quot;post&quot; action=&quot;/modify?id=$&#123;user_modify._id&#125;&quot;&gt;</code></p>
<p>3.1 然后去更新数据那里写好条件；</p>
<p><code>await User_collections.updateOne(&#123; _id: query.id &#125;, user_post);</code></p>
<p>4.练习：</p>
<p>我记得我练习的时候出错了；结果就不记得了；</p>
<ul>
<li><p>1.真的，稍微有什么不笔记，就记不住；</p>
</li>
<li><p>2.果然什么都要写啊，每一步的要写！连查资料都要写！</p>
</li>
</ul>
<hr>
<h3 id="10-6-删除用户"><a href="#10-6-删除用户" class="headerlink" title="10.6 删除用户"></a>10.6 删除用户</h3><h4 id="1-思路"><a href="#1-思路" class="headerlink" title="1. 思路"></a>1. 思路</h4><p>1.当用户点击，删除按钮的时候，要向服务器发送一个请求；</p>
<p>2.并且，把当前用户的id，作为请求参数，传递给服务器端；</p>
<p>3.作为服务器端讲，要为这个请求，去创建路由（响应）</p>
<ul>
<li>1.在这个路由中，要接收到，客户端，传递过来的id参数。</li>
<li>2.然后根据这个id，在数据库中找到，并且删除当前文档；</li>
</ul>
<h4 id="2-代码"><a href="#2-代码" class="headerlink" title="2. 代码"></a>2. 代码</h4><p>1.去修改href，在修改按钮那里；</p>
<p><img src="../../img/15.1/1.png" alt="1"></p>
<p>1.1 链接有了，接下来去创建路由</p>
<p>2.因为a标签的请求方式是get，所以我们去get里面，再加一个else if</p>
<p><img src="../../img/15.1/2.png" alt="2"></p>
<p>2.1 路由有了，在这个路由里面，我们要接收到，客户端传来的id参数</p>
<ul>
<li><p>1.id参数，被存储在query里面；</p>
<p><code>const &#123; pathname, query &#125; = url.parse(req.url, true);</code></p>
</li>
<li><p>2.可以先测试一下有没有id</p>
<p>有</p>
</li>
</ul>
<p>2.2 接下来，我们用这个id，在数据库中找到对应的文档，并删除</p>
<ul>
<li><p>1.首先，还记得删除文档的方法吗？</p>
<ul>
<li>1.~.findOneAndDelete</li>
</ul>
</li>
<li><p>2.写findOneAndDelete，里面的查询条件，可能是使用id的地方</p>
<ul>
<li><p>1.我就说，怎么写个删除文档的方法就链接到数据库了</p>
</li>
<li><p>2.因为这正是数据库的方法</p>
</li>
<li><p>3.找到用户集合</p>
<ul>
<li><p>1.它是变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.3 创建用户集合</span></span><br><span class="line"><span class="keyword">const</span> User_collections = mongoose.model(<span class="string">&#x27;User&#x27;</span>, user);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>4.然后使用删除文档方法：</p>
<p><code>User_collections.findOneAndDelete(&#123;&#125;)</code></p>
</li>
<li><p>5.里面的参数，就是查询条件，写入id；</p>
<ul>
<li>1.既然是数据库集合的方法，那么这里的查询，自然就是查询文档下面的_id数据的值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (pathname == <span class="string">&#x27;/remove&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// res.end(query.get(&#x27;id&#x27;));</span></span><br><span class="line">            <span class="keyword">let</span> remove_id = query.get(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">            User_collections.findOneAndDelete(&#123; remove_id &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>6.</p>
</li>
</ul>
</li>
<li><p>3.如果停留在这一步，那么就要写.then了</p>
<ul>
<li>1.我记得数据库对象都是返回的Promise，所以有.then</li>
<li>2.我们可以加 await，不仅同步了，还能直接用返回值</li>
</ul>
<p><code>await User_collections.findOneAndDelete(&#123; remove_id &#125;);</code></p>
<ul>
<li><p>3.而前面的构造函数，要被转换成 异步函数。</p>
<p><code>app.on(&#39;request&#39;, async (req, res) =&gt; &#123;</code></p>
</li>
<li><p>4.在前面已经使用了几次await，早被转换</p>
</li>
</ul>
</li>
<li><p>4.</p>
</li>
</ul>
<h5 id="2-2-重定向"><a href="#2-2-重定向" class="headerlink" title="2.2 重定向"></a>2.2 重定向</h5><p>2.3 删除完了，我们要告诉浏览器；告诉用户；</p>
<ul>
<li><p>1.我们可以返回ok，返回删除完毕</p>
</li>
<li><p>2.但也可以重定向到页表页面；</p>
</li>
<li><p>3.代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(<span class="number">301</span>, &#123;</span><br><span class="line">    Location: <span class="string">&#x27;/list&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line">res.end();</span><br></pre></td></tr></table></figure>

<ul>
<li><p>res.writeHead是什么？从字面意思看：响应报头？</p>
</li>
<li><p>去15那边看看响应报头的相关信息；</p>
<ul>
<li>那边只说了，第一个参数是状态码</li>
</ul>
</li>
<li><p>看看文档：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/http.html#http_request_write_chunk_encoding_callback">http://nodejs.cn/api/http.html#http_request_write_chunk_encoding_callback</a></p>
</blockquote>
</li>
</ul>
</li>
<li><p>4.文档错了啊；</p>
<p>应该是这个：<a target="_blank" rel="noopener" href="http://nodejs.cn/api/http.html#http_response_writehead_statuscode_statusmessage_headers">http://nodejs.cn/api/http.html#http_response_writehead_statuscode_statusmessage_headers</a></p>
<p>语法：response.writeHead(statusCode[, statusMessage][, headers])</p>
</li>
<li><p>5.这里的headers，就是响应头，下面2.7的res.setHeader</p>
</li>
</ul>
<p>2.4 我们先解决完这个响应报头，再说结果</p>
<ul>
<li><p>1.encoding<br>英 [ɪnˈkəʊdɪŋ]   美 [ɪnˈkoʊdɪŋ]<br>v.把…译成电码(或密码);把…编码;把…译成外语<br>encode的现在分词</p>
</li>
<li><p>2.根据文档也看不出什么</p>
</li>
<li><p>3.百度：</p>
<ul>
<li><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45515863/article/details/103213937">https://blog.csdn.net/qq_45515863/article/details/103213937</a></p>
</blockquote>
</li>
<li><p>1.根据此文档而言：</p>
<ul>
<li>第一个是HTTP状态码，如200(请求成功），404（未找到）等。</li>
<li>第二个是告诉浏览器发送的数据类型</li>
<li>第三个就是具体发送的是什么数据</li>
</ul>
</li>
<li><p>2.三个参数；</p>
<ul>
<li><code>response.writeHead(statusCode, [reasonPhrase], [headers])</code></li>
<li><code>res.writeHead(200,&#123;‘Content-Type’:‘text/html;charset=UTF8’&#125;);</code></li>
</ul>
</li>
<li><p>3.但明显都不对；</p>
</li>
</ul>
</li>
</ul>
<p>2.5 那么，我们百度 重定向，试试；</p>
<ul>
<li>1.光搜重定向，都是很老的文章</li>
</ul>
<p>2.6 响应报头重定向</p>
<ul>
<li><p>1.找到了一个关键点:  res.setHeader</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (req.url === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">        res.statusCode = <span class="number">302</span>; </span><br><span class="line">        res.setHeader(<span class="string">&quot;Location&quot;</span>, <span class="string">&quot;https://www.baidu.com/&quot;</span>);</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;server is running on port 3000&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>来源：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d8260cc0fa68">https://www.jianshu.com/p/d8260cc0fa68</a></p>
</li>
</ul>
<p>2.7 去文档查看 res.setHeader</p>
<ul>
<li>1.<a target="_blank" rel="noopener" href="http://nodejs.cn/api/http.html#http_response_setheader_name_value">http://nodejs.cn/api/http.html#http_response_setheader_name_value</a></li>
<li>2.语法：response.setHeader(name, value)</li>
</ul>
<p>2.8 无果，搜索关键词：Location</p>
<ul>
<li><p>1.<a target="_blank" rel="noopener" href="http://nodejs.cn/api/http.html#http_message_headers">http://nodejs.cn/api/http.html#http_message_headers</a></p>
</li>
<li><p>2.找到！</p>
</li>
<li><p>3.不过还是没啥作用</p>
</li>
<li><p>4.发现：</p>
<p><img src="../../img/15.1/3.png" alt="3"></p>
</li>
<li><p>5.如果结合2.7里面的语法：response.setHeader(name, value)</p>
<ul>
<li><p>1.难道这里的名称就是response.setHeader(name, value)的name吗？</p>
</li>
<li><p>2.我觉得完全有可能</p>
</li>
<li><p>3.因为：在2.6里面，在网上找到了一个东西：</p>
<p><code>res.setHeader(&quot;Location&quot;, &quot;https://www.baidu.com/&quot;);</code></p>
</li>
</ul>
</li>
</ul>
<p>2.9 打印res.writeHead，看有没有什么东西</p>
<ul>
<li><p>1.</p>
</li>
<li><p>2.返回结果：</p>
<p>返回了一堆东西，但是没有location</p>
</li>
</ul>
<h5 id="3-破案重定向"><a href="#3-破案重定向" class="headerlink" title="3.破案重定向"></a>3.破案重定向</h5><p>1.结果，在2.3那里破案了</p>
<p>2.为什么里面是个对象，而这个对象又有什么属性？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(<span class="number">301</span>, &#123;</span><br><span class="line">    Location: <span class="string">&#x27;/list&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.答：里面是响应头对象header，更多信息来自：res.setHeader</p>
<blockquote>
<p>2.7 去文档查看 res.setHeader</p>
<ul>
<li>1.<a target="_blank" rel="noopener" href="http://nodejs.cn/api/http.html#http_response_setheader_name_value">http://nodejs.cn/api/http.html#http_response_setheader_name_value</a></li>
<li>2.语法：response.setHeader(name, value)</li>
</ul>
</blockquote>
<p>4.而res.writeHead本身，则是在 2.2重定向-2.3里面；第一个参数状态码，是必写参数，</p>
<p>不写要报错；</p>
<h5 id="4-无效又不报错"><a href="#4-无效又不报错" class="headerlink" title="4. 无效又不报错"></a>4. 无效又不报错</h5><p>1.找到了</p>
<p><code>await User_collections.findOneAndDelete(&#123; remove_id &#125;);</code></p>
<p>2.改为：</p>
<p><code>await User_collections.findOneAndDelete(&#123; _id:remove_id &#125;);</code></p>
<ul>
<li>等等，为什么必须写这样的格式？</li>
<li>查询条件具体是怎样的</li>
</ul>
<p>2.1 为什么要把 键值对都写出来；</p>
<ul>
<li>1.是因为，没有具体指向哪一个对象，所以事先并不知道 键：_id</li>
<li>2.这种假设合理；</li>
</ul>
<p>3.但还是有3个，无法删除</p>
<ul>
<li>1.最后不知道怎么的，就只剩一个了；</li>
</ul>
<p>3.1 看代码无果，去F12看了看报文：</p>
<ul>
<li>1.发现了一个这个：Provisional headers are shown</li>
</ul>
<p><img src="../../img/15.1/4.png" alt="4"></p>
<hr>
<h3 id="10-7-案例优化"><a href="#10-7-案例优化" class="headerlink" title="10.7 案例优化"></a>10.7 案例优化</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=65&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=65&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.我们把所有的代码，都写在了同一个文件当中。</p>
<ul>
<li>1.在实际开发中，肯定不能这样</li>
<li>2.难以维护</li>
</ul>
<p>2.使用了模板字符串，进行了很多拼接</p>
<ul>
<li>1.模板字符串不报错，很容易出错</li>
<li>2.如果后面，要修改html，如何修改？修改起来很麻烦</li>
</ul>
<h4 id="1-模块开发"><a href="#1-模块开发" class="headerlink" title="1. 模块开发"></a>1. 模块开发</h4><h5 id="1-0-分离数据库"><a href="#1-0-分离数据库" class="headerlink" title="1.0 分离数据库"></a>1.0 分离数据库</h5><p>1.在js中，我们要采用模块化，开发方式。</p>
<p>2.要根据功能，分离到不同的模块里去。</p>
<p>3.像数据库的代码，至少不能和服务器写在一起se；</p>
<p>4.视频里面说，他们一般在文件夹下面会创建一个叫：model的文件夹</p>
<ul>
<li>用来放数据库的操作</li>
<li>我个人肯定还不习惯；2021-4-24 21:34:43</li>
</ul>
<p>5.然后他在model文件下，创建了index.js</p>
<ul>
<li>就只放了，数据库链接的代码</li>
</ul>
<p>6.接着创建了user.js</p>
<ul>
<li>只放了，创建集合规则，与创建集合的代码</li>
</ul>
<p>6.1 在这里，还说了一下，在两个文件中，都引入了同样的模块。会不会浪费资源？</p>
<ul>
<li>1.不会</li>
<li>2.有缓存；第一次引入使用后就缓存了，第二次直接从缓存里面拿，还说非常快；</li>
</ul>
<h5 id="1-1-开放出去"><a href="#1-1-开放出去" class="headerlink" title="1.1 开放出去"></a>1.1 开放出去</h5><p>0.在笔记：15-2.1-567；有模块成员导出，导入的笔记；</p>
<p>7.在app.js当中，好多地方都用了创建集合的，构造函数的，那个变量名；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.3 创建用户集合</span></span><br><span class="line"><span class="keyword">const</span> User_collections = mongoose.model(<span class="string">&#x27;User&#x27;</span>, user);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>就是 User_collections</p>
</li>
<li><p>2.如果你觉得app.js懵的，就直接设为x.js用了y.js的函数</p>
</li>
</ul>
<p>7.1 等等 const创建的是变量吗？</p>
<ul>
<li><p>1.我们去文件：25.4-A1.2-3. let、const、var 的区别；查看</p>
</li>
<li><blockquote>
<p>1.使用 var 声明的变量，其作用域为该语句所在的函数内，且存在变量提升现象。</p>
<p>2.使用 let 声明的变量，其作用域为该语句所在的代码块内，不存在变量提升。</p>
<p>3.使用 const 声明的是常量，在后面出现的代码中不能再修改该常量的值。</p>
<ul>
<li>复杂数据的值可以变化</li>
</ul>
<table>
<thead>
<tr>
<th><strong>var</strong></th>
<th><strong>let</strong></th>
<th><strong>const</strong></th>
</tr>
</thead>
<tbody><tr>
<td>函数级作用域</td>
<td>块级作用域</td>
<td>块级作用域</td>
</tr>
<tr>
<td>变量提升</td>
<td>不存在变量提升</td>
<td>不存在变量提升</td>
</tr>
<tr>
<td>值可更改</td>
<td>值可更改</td>
<td>值不可更改</td>
</tr>
</tbody></table>
</blockquote>
</li>
<li><p>2.他是常量；</p>
</li>
</ul>
<p>8.所以要开放出去。这里我懵了</p>
<ul>
<li><p>1.代码：</p>
<p><code>module.exports = User_collections;</code></p>
<ul>
<li>module.exports：模块出口；</li>
</ul>
</li>
<li><p>2.他说的是：在其他文件中，引入user.js的时候，才可以拿到；</p>
<ul>
<li>还要引入js？</li>
</ul>
</li>
<li><p>3.</p>
</li>
</ul>
<h5 id="1-2-引入其他模块"><a href="#1-2-引入其他模块" class="headerlink" title="1.2 引入其他模块"></a>1.2 引入其他模块</h5><p>1.app.js里面的数据库模块，单独出去作为一个js了</p>
<p>2.要引入才有的用</p>
<ul>
<li><p>1.代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入其他模块</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./model/index.js&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./model/user.js&#x27;</span>);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>3.user.js开放了一个User_collections构造集合函数。</p>
<ul>
<li><p>1.我们可以创建一个常量去接收它。</p>
<ul>
<li>1.开放</li>
<li>2.引入</li>
<li>3.接收</li>
<li>4.才可以用，额；</li>
</ul>
</li>
<li><p>2.代码：</p>
<p><code>const User_collections = require(&#39;./model/user.js&#39;);</code></p>
</li>
</ul>
<p>4.那么，数据库的代码，分离到其他模块。就完毕了；</p>
<h5 id="1-3-测试分离数据库"><a href="#1-3-测试分离数据库" class="headerlink" title="1.3 测试分离数据库"></a>1.3 测试分离数据库</h5><p>1.分离了数据库后，测试一下，看能用不</p>
<p>2.测试：</p>
<ul>
<li>1.添加用户</li>
<li>2.修改用户</li>
<li>3.删除用户</li>
<li>4.哦，没有查找功能；</li>
</ul>
<p>3.引入其他模块，可以省略.js；</p>
<ul>
<li>1.视频里面只省略了user的.js</li>
<li>2.我去试试index的可以省略不；</li>
</ul>
<p>3.1 省略+测试</p>
<ul>
<li><p>1.每一步，都去数据库那边刷新查看了</p>
</li>
<li><p>2.没有问题</p>
</li>
<li><p>3.都可以省略</p>
</li>
<li><p>4.同时可以想到：</p>
<ul>
<li><p>1.上面的那些引入代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.搭建网站服务器，实现客户端与服务器端的通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.1 引入url</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.也许，也都是这样，后面都是省略了.js。可能都是js文件；</p>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2-字符串拼接"><a href="#2-字符串拼接" class="headerlink" title="2. 字符串拼接"></a>2. 字符串拼接</h4><p>1.字符串的拼接，不像模块开发那么简单。</p>
<p>2.需要学习模板引擎；</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=66&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=66&amp;spm_id_from=pageDriver</a></p>
<p>2021-4-24 22:10:54</p>
</blockquote>
<hr>
<h1 id="5-模板引擎artTemplate"><a href="#5-模板引擎artTemplate" class="headerlink" title="5. 模板引擎artTemplate"></a>5. 模板引擎artTemplate</h1><p>1.目标：</p>
<p> 能够使用模板引擎渲染数据<br> 能够使用模板引擎进行原文输出<br> 能够使用循环输出数据<br> 能够知道如何引用子模板<br> 能够知道如何如何进行模板继承</p>
<p>2.</p>
<h2 id="5-1-模板引擎的基础概念"><a href="#5-1-模板引擎的基础概念" class="headerlink" title="5.1 模板引擎的基础概念"></a>5.1 模板引擎的基础概念</h2><h3 id="1-模板引擎"><a href="#1-模板引擎" class="headerlink" title="1. 模板引擎"></a>1. 模板引擎</h3><p>1.模板引擎是第三方模块。<br>让开发者以更加友好的方式拼接字符串，使项目代码更加清晰、更加易于维护。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未使用模板引擎的写法</span></span><br><span class="line"><span class="keyword">var</span> ary = [&#123; <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;];</span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;&lt;ul&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ary.length; i++) &#123; </span><br><span class="line">   str += <span class="string">&#x27;&lt;li&gt;\</span></span><br><span class="line"><span class="string">       &lt;span&gt;&#x27;</span>+ ary[i].name +<span class="string">&#x27;&lt;/span&gt;\</span></span><br><span class="line"><span class="string">       &lt;span&gt;&#x27;</span>+ ary[i].age +<span class="string">&#x27;&lt;/span&gt;\</span></span><br><span class="line"><span class="string">   &lt;/li&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">str += <span class="string">&#x27;&lt;/ul&gt;&#x27;</span>; </span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- 使用模板引擎的写法 --&gt; </span><br><span class="line">&lt;ul&gt;</span><br><span class="line">   &#123;&#123;each ary&#125;&#125;</span><br><span class="line">       &lt;li&gt;&#123;&#123;$value.name&#125;&#125;&lt;/li&gt;</span><br><span class="line">       &lt;li&gt;&#123;&#123;$value.age&#125;&#125;&lt;/li&gt;</span><br><span class="line">   &#123;&#123;/each&#125;&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>



<h3 id="2-art-template模板引擎"><a href="#2-art-template模板引擎" class="headerlink" title="2. art-template模板引擎"></a>2. art-template模板引擎</h3><p>1.是腾讯公司出品的，文档也是中文</p>
<ul>
<li>1.也是视频那个时候最快的。视频说的，所以是视频创作之时</li>
</ul>
<p>2.下载</p>
<ul>
<li>1.在命令行工具中使用 npm install art-template 命令进行下载</li>
</ul>
<p>3.引入</p>
<ul>
<li><p>1.使用const template[^1] = require(‘art-template’)引入模板引擎</p>
<ul>
<li><p>1.通过require引入模板模块后，会返回一个方法。</p>
</li>
<li><p>2.前面刚开始说的，不是返回一个对象么，exports对象，这里怎么直接就是方法了？</p>
</li>
<li><p>我们将这个方法，命名为template。</p>
<ul>
<li>是不是忘记复习开放和导入了</li>
<li>去复习</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>3.1 我决定，还是打印一下</p>
<ul>
<li>1.打印代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> b = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre></td></tr></table></figure>



<ul>
<li><p>2.返回代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">Function</span>: template] &#123;</span><br><span class="line">  render: [<span class="built_in">Function</span>: render],</span><br><span class="line">  compile: [<span class="built_in">Function</span>: compile] &#123;</span><br><span class="line">    Compiler: [<span class="built_in">Function</span>: Compiler] &#123; <span class="attr">CONSTS</span>: [<span class="built_in">Object</span>] &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  defaults: &#123; <span class="string">&#x27;$extend&#x27;</span>: [<span class="built_in">Function</span> (anonymous)] &#125;,</span><br><span class="line">  extension: [<span class="built_in">Function</span>: extension]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>3.还真的是，返回了一个方法；</p>
</li>
<li><p>4.我们再引入user，看看那边导出。我们接收的是不是exports对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> c = <span class="built_in">require</span>(<span class="string">&#x27;./user&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(c);</span><br></pre></td></tr></table></figure>

<ul>
<li>打印出：Model { User }</li>
<li>是对象，不过有名；</li>
</ul>
</li>
</ul>
<p>3.2 那么问题又来了。require(‘art-template’); 为什么是返回的方法（函数），而不是对象呢？</p>
<ul>
<li>2021-4-25 21:51:23；</li>
</ul>
<p>4.模板引擎的功能，是将html拼接，所以要告诉模板引擎要拼接的数据和模板在哪。</p>
<ul>
<li><p>1.const html = template(‘模板路径’, 数据);</p>
</li>
<li><p>2.第一个参数是模板路径。</p>
<ul>
<li>1.template方法，可以让html单独为一个文件。</li>
<li>2.数据，是一个对象。但可以直接写里面的属性名，就用了</li>
</ul>
</li>
<li><p>3.返回值，是拼接好的模板字符串；</p>
</li>
</ul>
<p>5.示例代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入模板引擎模块</span></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="comment">// 将特定模板与特定数据进行拼接</span></span><br><span class="line"><span class="keyword">const</span> html = template(<span class="string">&#x27;./views/index.art&#x27;</span>,&#123;</span><br><span class="line">   data: &#123;</span><br><span class="line">       name: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">       age: <span class="number">20</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>



<ul>
<li>1.虽然模板的后缀，是.art。<ul>
<li>1.这是模板引擎规定好了。</li>
<li>2.里面是html</li>
<li>3.不过无论模板引擎的后缀是什么，里面都是html；</li>
</ul>
</li>
<li>2.第二个参数，就是传递的是，要在模板里面展示的数据。<ul>
<li>1.属性又是一个对象，里面有名字和年龄</li>
</ul>
</li>
</ul>
<p>5.1 接下来看模板当中的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">   &lt;span&gt;&#123;&#123;data.name&#125;&#125;&lt;/span&gt;</span><br><span class="line">   &lt;span&gt;&#123;&#123;data.age&#125;&#125;&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>1.有两对花括号（大括号，我是这么叫的）</li>
<li>2.最外面的花括号，是把里面那个花括号当中的模板变量替换成数据，</li>
</ul>
<h4 id="2-1-代码练习"><a href="#2-1-代码练习" class="headerlink" title="2.1 代码练习"></a>2.1 代码练习</h4><h5 id="1-创建"><a href="#1-创建" class="headerlink" title="1. 创建"></a>1. 创建</h5><p>1.创建一个单独的文件夹template;</p>
<ul>
<li><p>1.下面创建app.js</p>
</li>
<li><p>2.下面创建文件夹views[^2]，视频说，大家都用这个单词作为模板文件夹。</p>
<ul>
<li>1.创建index.art; art!</li>
</ul>
</li>
</ul>
<h5 id="2-art"><a href="#2-art" class="headerlink" title="2. art"></a>2. art</h5><ul>
<li><p>3.写的就是html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> &#123;&#123;name&#125;&#125;</span><br><span class="line"> &#123;&#123;age&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>不过右下角，可以选择art格式；</li>
<li>视频里面还是html格式</li>
</ul>
</li>
</ul>
<h5 id="3-JS"><a href="#3-JS" class="headerlink" title="3. JS"></a>3. JS</h5><p>2.然后app.js这边代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入模板引擎</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.模板路径，建议用绝对路径</span></span><br><span class="line"><span class="keyword">const</span> views = path.join(__dirname, <span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;index.art&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> html = template(views, &#123;</span><br><span class="line">    name: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    age: <span class="number">20</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html);</span><br></pre></td></tr></table></figure>



<ul>
<li>1.路径说的用绝对路径，不过也是动态的绝对路径；</li>
<li><code>__dirname</code>获取，当前文件所在的路径，是相对个人电脑的路径。所以是动态的</li>
</ul>
<h5 id="4-扩展"><a href="#4-扩展" class="headerlink" title="4. 扩展"></a>4. 扩展</h5><h6 id="4-1-path-join"><a href="#4-1-path-join" class="headerlink" title="4.1 path.join"></a>4.1 path.join</h6><p>2.1 可以查查path.join，看能不能找到规范的资料；</p>
<ul>
<li><p>官方文档：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/path.html#path_path">http://nodejs.cn/api/path.html#path_path</a></p>
</blockquote>
</li>
<li><p>具体的join文档</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/path.html#path_path_join_paths">http://nodejs.cn/api/path.html#path_path_join_paths</a></p>
</blockquote>
</li>
<li><p>新增于: v0.1.16</p>
<ul>
<li><code>...paths</code> <a target="_blank" rel="noopener" href="http://url.nodejs.cn/9Tw2bK">string</a> 路径片段的序列。</li>
<li>返回: <a target="_blank" rel="noopener" href="http://url.nodejs.cn/9Tw2bK">string</a></li>
</ul>
<p><code>path.join()</code> 方法会将所有给定的 <code>path</code> 片段连接到一起（使用平台特定的分隔符作为定界符），然后规范化生成的路径。</p>
<p>长度为零的 <code>path</code> 片段会被忽略。 如果连接后的路径字符串为长度为零的字符串，则返回 <code>&#39;.&#39;</code>，表示当前工作目录。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">path.join(<span class="string">&#x27;/目录1&#x27;</span>, <span class="string">&#x27;目录2&#x27;</span>, <span class="string">&#x27;目录3/目录4&#x27;</span>, <span class="string">&#x27;目录5&#x27;</span>, <span class="string">&#x27;..&#x27;</span>);</span><br><span class="line"><span class="comment">// 返回: &#x27;/目录1/目录2/目录3/目录4&#x27;</span></span><br><span class="line"></span><br><span class="line">path.join(<span class="string">&#x27;目录1&#x27;</span>, &#123;&#125;, <span class="string">&#x27;目录2&#x27;</span>);</span><br><span class="line"><span class="comment">// 抛出 &#x27;TypeError: Path must be a string. Received &#123;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如果任何的路径片段不是字符串，则抛出 <a target="_blank" rel="noopener" href="http://nodejs.cn/api/errors.html#errors_class_typeerror"><code>TypeError</code></a>。</p>
</li>
</ul>
<h6 id="4-2-dirname"><a href="#4-2-dirname" class="headerlink" title="4.2 __dirname"></a>4.2 __dirname</h6><p>1.官方文档：</p>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api/modules.html#modules_dirname">http://nodejs.cn/api/modules.html#modules_dirname</a></p>
<p>2.上面好像有好东西。</p>
<ul>
<li>1.是说一些node机制的。学了肯定会知道很多；</li>
<li>2.但怕用很多时间；</li>
</ul>
<p>2.1 看了一些，没写笔记，有点模糊；</p>
<ul>
<li>1.CommonJS 模块<ul>
<li>好像就是创建导出，导入的机制的玩意</li>
</ul>
</li>
<li>2.访问主模块<ul>
<li>1.这个不懂啥意思；</li>
</ul>
</li>
<li>3.附录：包管理器的技巧<ul>
<li>1.这个大概是管理复杂的创造吧</li>
</ul>
</li>
<li>4.缓存<ul>
<li>1.导入了一次有缓存；</li>
</ul>
</li>
<li>5.等等</li>
</ul>
<p>2.2 这个我在意：模块封装器</p>
<p>在执行模块代码之前，Node.js 会使用一个如下的函数封装器将其封装：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line"><span class="comment">// 模块的代码实际上在这里</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通过这样做，Node.js 实现了以下几点：</p>
<ul>
<li>它保持了顶层的变量（用 <code>var</code>、 <code>const</code> 或 <code>let</code> 定义）作用在模块范围内，而不是全局对象。</li>
<li>它有助于提供一些看似全局的但实际上是模块特定的变量，例如：<ul>
<li>实现者可以用于从模块中导出值的 <code>module</code> 和 <code>exports</code> 对象。</li>
<li>包含模块绝对文件名和目录路径的快捷变量 <code>__filename</code> 和 <code>__dirname</code> 。</li>
</ul>
</li>
</ul>
<ul>
<li>1.以上是直接复制，从复制结果可以看出，那边的文字，大概是typora文档的语法；</li>
<li>2.我想去看看封装函数；</li>
</ul>
<h6 id="4-3-封装函数，函数封装"><a href="#4-3-封装函数，函数封装" class="headerlink" title="4.3 封装函数，函数封装"></a>4.3 封装函数，函数封装</h6><p>2.3 从已有的笔记25.1看出</p>
<ul>
<li>1.封装函数，就和普通的创建函数，没什么区别。。。</li>
<li>2.百度吗？还是停在这一步，去学习？<ul>
<li>1.先停在这一步吧，算了，去百度！</li>
<li>2.从这一篇文章可以看出：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ab_dk/article/details/104907471">https://blog.csdn.net/ab_dk/article/details/104907471</a><ul>
<li>1.确实，像普通的创建函数。继续</li>
</ul>
</li>
<li>3.~<a target="_blank" rel="noopener" href="https://blog.csdn.net/jiang7701037/article/details/80100753">https://blog.csdn.net/jiang7701037/article/details/80100753</a><ul>
<li>1.也是普通的创建函数</li>
<li>2.但同时，也说了，这是入门的封装。继续！</li>
</ul>
</li>
<li>4.~<a target="_blank" rel="noopener" href="https://blog.csdn.net/Coveragehe/article/details/80845020">https://blog.csdn.net/Coveragehe/article/details/80845020</a><ul>
<li>1.这篇文章说了两个：对象原型封装，与闭包封装。</li>
<li>2.我知道了，要继续学习原生的js才行；</li>
<li>3.因为毕设，我是跳过了，来node学习；2021-4-26 11:06:12</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>2.4 over；2021-4-26 11:06:21</p>
<hr>
<h3 id="3-语法"><a href="#3-语法" class="headerlink" title="3. 语法"></a>3. 语法</h3><p>1.art-template同时支持两种模板语法：标准语法和原始语法。</p>
<ul>
<li>1.在入门案例中，使用的是标准语法；</li>
</ul>
<p>1.1 标准语法可以让模板更容易读写，原始语法具有强大的逻辑处理能力。</p>
<p>2.标准语法： <br>原始语法：&lt;%=数据  %&gt;</p>
<h4 id="3-1-输出"><a href="#3-1-输出" class="headerlink" title="3.1 输出"></a>3.1 输出</h4><p>1.将某项数据输出在模板中，标准语法和原始语法如下：</p>
<ul>
<li><p>标准语法：<br>原始语法：&lt;%=数据 %&gt;</p>
</li>
<li><pre><code class="html">  <span class="comment">&lt;!-- 标准语法 --&gt;</span>
 <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="comment">&#123;&#123;value&#125;&#125;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span>
 <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="comment">&#123;&#123;a ? b : c&#125;&#125;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span>
 <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="comment">&#123;&#123;a + b&#125;&#125;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span>

  <span class="comment">&lt;!-- 原始语法 --&gt;</span>
 <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">value</span> %&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span>
 <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">a</span> ? <span class="attr">b</span> <span class="attr">:</span> <span class="attr">c</span> %&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span>
 <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">a</span> + <span class="attr">b</span> %&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span>

<span class="comment">&lt;!--hexoPostRenderEscape:&lt;figure class="highlight"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;1.1 原始语法里的=号，是输出的意思；&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;1.2 代码示例：&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;```html&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&amp;lt;body&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    &amp;#123;&amp;#123;name&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    &amp;#123;&amp;#123;1+1&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;    &amp;lt;%=1+2%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;        &amp;lt;!-- 3. 三步运算符 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;        &amp;#123;&amp;#123; 1+2 == 3 ? &amp;#x27;正确&amp;#x27; : &amp;#x27;错误&amp;#x27;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;        &amp;lt;%=1+1==3 ? &amp;#x27;正确&amp;#x27; : &amp;#x27;错误&amp;#x27; %&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</span>


</code></pre>
</li>
</ul>
<ul>
<li>1.里面可以直接运算</li>
<li>2.三步运算符也是可以的；</li>
</ul>
<p>1.3 不解析标签</p>
<ul>
<li>1.防止恶意代码；什么输出几万遍之类的，可以用html写么？。。。</li>
</ul>
<p><img src="../../img/15.1/5.png" alt="5"></p>
<h4 id="3-2-原文输出"><a href="#3-2-原文输出" class="headerlink" title="3.2 原文输出"></a>3.2 原文输出</h4><p>1.如果数据中携带HTML标签，默认模板引擎不会解析标签，会将其转义后输出。</p>
<p>2.语法：</p>
<p>标准语法：<code>&#123;&#123;@ 数据 &#125;&#125;</code><br>原始语法：<code>&lt;%-数据 %&gt;</code></p>
<p>3.代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 标准语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;@ value &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 原始语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">%-</span> <span class="attr">value</span> %&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>



<hr>
<h4 id="3-3-条件判断"><a href="#3-3-条件判断" class="headerlink" title="3.3 条件判断"></a>3.3 条件判断</h4><h5 id="1-标准语法"><a href="#1-标准语法" class="headerlink" title="1. 标准语法"></a>1. 标准语法</h5><p>1.在模块中可以根据条件来决定显示哪块html代码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 标准语法 --&gt;</span> </span><br><span class="line">&#123;&#123;if 条件&#125;&#125; ... &#123;&#123;/if&#125;&#125;</span><br><span class="line">&#123;&#123;if v1&#125;&#125; ... &#123;&#123;else if v2&#125;&#125; ... &#123;&#123;/if&#125;&#125;</span><br><span class="line"><span class="comment">&lt;!-- 原始语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">value</span>) &#123; %&gt;</span> ... <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">v1</span>) &#123; %&gt;</span> ... <span class="tag">&lt;<span class="name">%</span> &#125; <span class="attr">else</span> <span class="attr">if</span> (<span class="attr">v2</span>) &#123; %&gt;</span> ... <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br></pre></td></tr></table></figure>



<p>1.1 单条件判断</p>
<p><code>&#123;&#123;if 条件&#125;&#125; ... &#123;&#123;/if&#125;&#125;</code></p>
<ul>
<li><p><code>&#123;&#123;if 条件&#125;&#125;</code> 开始</p>
</li>
<li><p><code>&#123;&#123;/if&#125;&#125;</code>结束</p>
</li>
<li><p>中间写条件；</p>
</li>
</ul>
<p>2.多条件判断：</p>
<ul>
<li>1.<code>&#123;&#123;if v1&#125;&#125; ... &#123;&#123;else if v2&#125;&#125; ... &#123;&#123;/if&#125;&#125;</code></li>
<li>条件满足v1，就执行v1后面的，满足v2，就执行v2后面的。</li>
</ul>
<p>3.代码示例：2.art+2.js</p>
<ul>
<li>0.如果年龄大于18，输出年龄大于18；<ul>
<li>1.如果年龄小于15，输出小于15；</li>
<li>2.否者年龄不符合要求；</li>
</ul>
</li>
</ul>
<blockquote>
<p>F:\2-3ciyuan\11-data base-shujuk\3-lianxi\5-template</p>
</blockquote>
<ul>
<li><p>1.art代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;&#123;if age2 &gt; 18&#125;&#125;</span><br><span class="line">    年龄大于18</span><br><span class="line">    &#123;&#123;else if age2<span class="tag">&lt;<span class="name">15&#125;&#125;</span></span></span><br><span class="line"><span class="tag">    年龄小于<span class="attr">15</span></span></span><br><span class="line"><span class="tag">    &#123;&#123;<span class="attr">else</span>&#125;&#125;</span></span><br><span class="line"><span class="tag">    年龄不符合要求</span></span><br><span class="line"><span class="tag">    &#123;&#123;/<span class="attr">if</span>&#125;&#125;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.JS代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入模板引擎</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.模板路径，建议用绝对路径</span></span><br><span class="line"><span class="keyword">const</span> views = path.join(__dirname, <span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;2.art&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> html = template(views, &#123;</span><br><span class="line">    name: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    age: <span class="number">20</span>,</span><br><span class="line">    content: <span class="string">&#x27;&lt;h1&gt;我是标题1&lt;/h1&gt;&#x27;</span>,</span><br><span class="line">    age1: <span class="number">14</span>,</span><br><span class="line">    age2: <span class="number">16</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html);</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.</p>
</li>
</ul>
<h5 id="2-原始语法"><a href="#2-原始语法" class="headerlink" title="2. 原始语法"></a>2. 原始语法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 标准语法 --&gt; </span><br><span class="line">&#123;&#123;<span class="keyword">if</span> 条件&#125;&#125; ... &#123;&#123;/<span class="keyword">if</span>&#125;&#125;</span><br><span class="line">&#123;&#123;<span class="keyword">if</span> v1&#125;&#125; ... &#123;&#123;<span class="keyword">else</span> <span class="keyword">if</span> v2&#125;&#125; ... &#123;&#123;/<span class="keyword">if</span>&#125;&#125;</span><br><span class="line">&lt;!-- 原始语法 --&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span> (value) &#123; %&gt; ... &lt;% &#125; %&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span> (v1) &#123; %&gt; ... &lt;% &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v2) &#123; %&gt; ... &lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>





<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &#123;&#123;<span class="keyword">if</span> age2 &gt; <span class="number">18</span>&#125;&#125;</span><br><span class="line">    年龄大于<span class="number">18</span></span><br><span class="line">    &#123;&#123;<span class="keyword">else</span> <span class="keyword">if</span> age2&lt;<span class="number">15</span>&#125;&#125;</span><br><span class="line">    年龄小于<span class="number">15</span></span><br><span class="line">    &#123;&#123;<span class="keyword">else</span>&#125;&#125;</span><br><span class="line">    年龄不符合要求</span><br><span class="line">    &#123;&#123;/<span class="keyword">if</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 原始语法</span></span><br><span class="line">    &lt;% <span class="keyword">if</span>(age&gt;<span class="number">18</span>)&#123;%&gt; 年龄大于<span class="number">18</span> &lt;%&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (age &lt; <span class="number">15</span>) &#123;%&gt; 年龄小于<span class="number">15</span> &lt;%&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;%&gt; 年龄不符合要求 &lt;%&#125;</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>



<h5 id="3-自写："><a href="#3-自写：" class="headerlink" title="3. 自写："></a>3. 自写：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 标准语法</span><br><span class="line">&#123;&#123; if age &gt; 18&#125;&#125;</span><br><span class="line">    年龄大于18</span><br><span class="line">&#123;&#123;else if age <span class="tag">&lt;<span class="name">15&#125;&#125;</span></span></span><br><span class="line"><span class="tag">年龄小于<span class="attr">15</span></span></span><br><span class="line"><span class="tag">&#123;&#123;<span class="attr">else</span>&#125;&#125;</span></span><br><span class="line"><span class="tag">年龄不符合要求</span></span><br><span class="line"><span class="tag">&#123;&#123;/<span class="attr">if</span>&#125;&#125;</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">// 原始语法</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line">&lt;% </span><br><span class="line">if (age&gt;18) </span><br><span class="line">&#123;%&gt;年龄大于18<span class="tag">&lt;<span class="name">%&#125;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line">else if (age &lt; 15 ) </span><br><span class="line">&#123;%&gt;年龄小于15<span class="tag">&lt;<span class="name">%&#125;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">else</span> </span></span><br><span class="line"><span class="tag">&#123;%&gt;</span>年龄不符合要求<span class="tag">&lt;<span class="name">%&#125;</span></span></span><br><span class="line"><span class="tag">%&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="3-4-循环"><a href="#3-4-循环" class="headerlink" title="3.4 循环"></a>3.4 循环</h4><p>1.当我们使用find方法，从数据库中查询数据的时候。</p>
<ul>
<li>1.它会返回一个数组，数组的值是对象。</li>
<li>2.对于数组里面又是对象的数据，我们要如何展示在页面当中呢？<ul>
<li>1.通常采用循环的方式</li>
<li>2.</li>
</ul>
</li>
</ul>
<p>2.在模板引擎中，如何循环与展示数据？</p>
<h5 id="1-语法"><a href="#1-语法" class="headerlink" title="1. 语法"></a>1. 语法</h5><h6 id="1-1-标准语法"><a href="#1-1-标准语法" class="headerlink" title="1.1 标准语法"></a>1.1 标准语法</h6><p>3.标准语法：<code>&#123;&#123;each 数据&#125;&#125; &#123;&#123;/each&#125;&#125;</code><br>原始语法：<code>&lt;% for() &#123; %&gt; &lt;% &#125; %&gt;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 标准语法 --&gt;</span><br><span class="line">&#123;&#123;each target&#125;&#125;</span><br><span class="line">    &#123;&#123;$index&#125;&#125; &#123;&#123;$value&#125;&#125;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br><span class="line"> &lt;!-- 原始语法 --&gt;</span><br><span class="line">&lt;% <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; target.length; i++)&#123; %&gt;</span><br><span class="line">    &lt;%= i %&gt; &lt;%= target[i] %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>



<p>3.1 在标准语法中，两对花括号里面，用each[^3]代表循环的开始。</p>
<ul>
<li>0.target是要循环的数据；不懂；<ul>
<li>1.也是要循环的那个数组；</li>
<li>2.重温，each target，就这两个词语，就已经完成了循环，所以，target就是被循环的数据；</li>
<li>3.这个数据，可能，只能是数组；</li>
</ul>
</li>
</ul>
<ul>
<li><p>1.$index 索引</p>
</li>
<li><p>2.$value 这一次的数据</p>
<ul>
<li>1.因为数组的值是对象，所以，每一次数据，都是那一次的对象；</li>
<li>2.能使用对象的语法，获得对象里面的属性和方法；</li>
</ul>
</li>
</ul>
<p>3.2 在原始语法中，有点JS的风格；target是那个数组；</p>
<p>4.代码：</p>
<ul>
<li><p>0.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> views = path.join(__dirname, <span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;3.art&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> html = template(views, &#123;</span><br><span class="line">    users: [&#123;</span><br><span class="line">        name: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">        age: <span class="number">20</span>,</span><br><span class="line">        sex: <span class="string">&#x27;男&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&#x27;爱丽丝&#x27;</span>,</span><br><span class="line">        age: <span class="number">10</span>,</span><br><span class="line">        sex: <span class="string">&#x27;女&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&#x27;小红帽&#x27;</span>,</span><br><span class="line">        age: <span class="number">16</span>,</span><br><span class="line">        sex: <span class="string">&#x27;女&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>1.art：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;&#123;each users&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;&#123;$value&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.$value,是每一次循环的值。</p>
</li>
<li><p>2.第一次循环，是数组第一个值，也就是第一个对象</p>
</li>
<li><p>3.这些，应该可以拿到3个对象。试试；</p>
<ul>
<li><p>1.乱码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;<span class="symbol">&amp;#34;</span>name<span class="symbol">&amp;#34;</span>:<span class="symbol">&amp;#34;</span>张三<span class="symbol">&amp;#34;</span>,<span class="symbol">&amp;#34;</span>age<span class="symbol">&amp;#34;</span>:20,<span class="symbol">&amp;#34;</span>sex<span class="symbol">&amp;#34;</span>:<span class="symbol">&amp;#34;</span>男<span class="symbol">&amp;#34;</span>&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;<span class="symbol">&amp;#34;</span>name<span class="symbol">&amp;#34;</span>:<span class="symbol">&amp;#34;</span>爱丽丝<span class="symbol">&amp;#34;</span>,<span class="symbol">&amp;#34;</span>age<span class="symbol">&amp;#34;</span>:10,<span class="symbol">&amp;#34;</span>sex<span class="symbol">&amp;#34;</span>:<span class="symbol">&amp;#34;</span>女<span class="symbol">&amp;#34;</span>&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;<span class="symbol">&amp;#34;</span>name<span class="symbol">&amp;#34;</span>:<span class="symbol">&amp;#34;</span>小红帽<span class="symbol">&amp;#34;</span>,<span class="symbol">&amp;#34;</span>age<span class="symbol">&amp;#34;</span>:16,<span class="symbol">&amp;#34;</span>sex<span class="symbol">&amp;#34;</span>:<span class="symbol">&amp;#34;</span>女<span class="symbol">&amp;#34;</span>&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.用原文输出：<code>&#123;&#123;@$value&#125;&#125;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        [object Object]</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        [object Object]</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        [object Object]</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.把@放在$后面：<code>&#123;&#123;$@value&#125;&#125;</code></p>
<p>报错：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi\node_modules\art-template\lib\compile\index.js:<span class="number">94</span></span><br><span class="line">            throw error;</span><br><span class="line">            ^</span><br><span class="line"></span><br><span class="line">[Error [TemplateError]: F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi\<span class="number">5</span>-template\views\<span class="number">3.</span>art:<span class="number">4</span>:<span class="number">9</span></span><br><span class="line">    <span class="number">2</span>|     &#123;&#123;each users&#125;&#125;</span><br><span class="line">    <span class="number">3</span>|     &lt;li&gt;</span><br><span class="line"> &gt;&gt; <span class="number">4</span>|         &#123;&#123;$@value&#125;&#125;</span><br><span class="line">    <span class="number">5</span>|     &lt;/li&gt;</span><br><span class="line">    <span class="number">6</span>|     &#123;&#123;/each&#125;&#125;</span><br><span class="line">    <span class="number">7</span>| &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">CompileError: missing ) after argument list</span><br><span class="line">   generated: $$<span class="keyword">out</span>+=$escape($@value)]</span><br><span class="line">[nodemon] app crashed - waiting <span class="keyword">for</span> file changes before starting...</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>4.1 只好跟着视频来了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;&#123;each users&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;&#123;$value.name&#125;&#125;</span><br><span class="line">        &#123;&#123;$value.age&#125;&#125;</span><br><span class="line">        &#123;&#123;$value.sex&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>1.返回值</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        张三</span><br><span class="line">        20</span><br><span class="line">        男</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        爱丽丝</span><br><span class="line">        10</span><br><span class="line">        女</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        小红帽</span><br><span class="line">        16</span><br><span class="line">        女</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2.没有问题。。。。</li>
</ul>
<h6 id="1-2-原始语法"><a href="#1-2-原始语法" class="headerlink" title="1.2 原始语法"></a>1.2 原始语法</h6><p>1.先不看视频。先自己写</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &lt;% for(var i=0; i&lt;users.length; i++) &#123; %&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">%=i%</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">%=users[i].name%</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">%=users[i].age%</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">%=users[i].sex%</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>1.好吧，这个最后，还是看视频写的；</li>
</ul>
<h6 id="1-3-总代码"><a href="#1-3-总代码" class="headerlink" title="1.3 总代码"></a>1.3 总代码</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;&#123;each users&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;&#123;$value.name&#125;&#125;</span><br><span class="line">        &#123;&#123;$value.age&#125;&#125;</span><br><span class="line">        &#123;&#123;$value.sex&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- // 原始语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &lt;% for(var i=0; i&lt;users.length; i++) &#123; %&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">%=i%</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">%=users[i].name%</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">%=users[i].age%</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">%=users[i].sex%</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="2-复习"><a href="#2-复习" class="headerlink" title="2. 复习"></a>2. 复习</h5><p>1.把3.art删了，重写一遍；2021-4-26 15:06:41</p>
<p>2.代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.报错：</p>
<p><code>CompileError: Unexpected token &#39;catch&#39;</code></p>
<p>4.结果是最后面符号没对；</p>
<ul>
<li><p>但报的啥？报的第一行；</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi\<span class="number">5</span>-template&gt; node .\<span class="number">3.</span>js</span><br><span class="line">F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi\node_modules\art-template\lib\compile\index.js:<span class="number">94</span></span><br><span class="line">            throw error;</span><br><span class="line">            ^</span><br><span class="line"></span><br><span class="line">[Error [TemplateError]: F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi\<span class="number">5</span>-template\views\<span class="number">3.</span>art:<span class="number">1</span>:<span class="number">1</span></span><br><span class="line"> &gt;&gt; <span class="number">1</span>| &lt;ul&gt;</span><br><span class="line">    <span class="number">2</span>|     &#123;&#123;each users&#125;&#125;</span><br><span class="line">    <span class="number">3</span>|     &lt;li&gt;</span><br><span class="line">    <span class="number">4</span>|         &#123;&#123;$index&#125;&#125;</span><br><span class="line"></span><br><span class="line">CompileError: Unexpected token <span class="string">&#x27;catch&#x27;</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>傻逼；2021-4-26 15:22:34</li>
</ul>
</li>
</ul>
<p><img src="../../img/15.1/6.png" alt="6"></p>
<p>​    </p>
<hr>
<h4 id="3-5-子模板"><a href="#3-5-子模板" class="headerlink" title="3.5 子模板"></a>3.5 子模板</h4><p>1.使用子模板可以将网站公共区块(头部、底部)抽离到单独的文件中。</p>
<ul>
<li>1.假如有一百个页面，都有相同的头部，底部；</li>
<li>2.这样改的时候，就一次可以改100个；</li>
</ul>
<p>2.标准语法：<code>&#123;&#123;include '模板'&#125;&#125;</code><br>原始语法：<code>&lt;%include(&#39;模板&#39;) %&gt;</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 标准语法 --&gt;</span></span><br><span class="line">&#123;&#123;include &#x27;./header.art&#x27;&#125;&#125;</span><br><span class="line"> <span class="comment">&lt;!-- 原始语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span>(&#x27;<span class="attr">.</span>/<span class="attr">header.art</span>&#x27;) %&gt;</span></span><br></pre></td></tr></table></figure>



<p>2.1 子模板与循环条件不一样，是单标签。（好啊，这里也有）</p>
<ul>
<li>循环or条件有开始与结束；</li>
</ul>
<p>2.2 在标准语法中，include是一个关键字。但在原始语法中，include是一个方法，要加括号；</p>
<h5 id="1-代码"><a href="#1-代码" class="headerlink" title="1. 代码"></a>1. 代码</h5><p>3.接下来，我们去编辑器中，验证这个代码</p>
<ul>
<li>1.创建新文件夹common；放头部和底部的；</li>
<li>2.创建头部header.art</li>
<li>3.创建底部：footer.art</li>
</ul>
<p>4.代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;include &#x27;../common/header.art&#x27;&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span> &#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;&#123;include &#x27;../common/footer.art&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>header.art文件里面有：我是头部</li>
<li>footer.art：我是底部</li>
</ul>
<p>4.1 返回值：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS F:\<span class="number">2</span><span class="number">-3</span>ciyuan\<span class="number">11</span>-data base-shujuk\<span class="number">3</span>-lianxi\<span class="number">5</span>-template&gt; node .\<span class="number">4.</span>js</span><br><span class="line">我是头部</span><br><span class="line">&lt;div&gt; 我是首页&lt;/div&gt;</span><br><span class="line">我是底部</span><br></pre></td></tr></table></figure>



<h5 id="2-原始语法-1"><a href="#2-原始语法-1" class="headerlink" title="2. 原始语法"></a>2. 原始语法</h5><p>1.代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span>(&#x27;<span class="attr">..</span>/<span class="attr">common</span>/<span class="attr">header.art</span>&#x27;) %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span> &#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span>(&#x27;<span class="attr">..</span>/<span class="attr">common</span>/<span class="attr">footer.art</span>&#x27;) %&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="3-6-模板继承"><a href="#3-6-模板继承" class="headerlink" title="3.6 模板继承"></a>3.6 模板继承</h4><p>0.</p>
<p>1.使用模板继承可以将网站HTML骨架抽离到单独的文件中，其他页面模板可以继承骨架文件。</p>
<p><img src="../../img/15.1/7.png" alt="7"></p>
<p>2.虽然同一个骨架，但每个页面的css，js链接是不一样的。可以在骨架留坑</p>
<p><img src="../../img/15.1/8.png" alt="8"></p>
<ul>
<li>1.不过看上面这张图，是看不出什么玩意；</li>
</ul>
<p>3.示例代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>HTML骨架模板<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        &#123;&#123;block &#x27;head&#x27;&#125;&#125;&#123;&#123;/block&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        &#123;&#123;block &#x27;content&#x27;&#125;&#125;&#123;&#123;/block&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>1.预留位置怎么留？block；</li>
<li>2.后面的是名字，用于区分不同的block；</li>
</ul>
<p>4.其他模板，如何继承骨架模板？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.art 首页模板--&gt;</span></span><br><span class="line">&#123;&#123;extend &#x27;./layout.art&#x27;&#125;&#125;</span><br><span class="line">&#123;&#123;block &#x27;head&#x27;&#125;&#125; <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;custom.css&quot;</span>&gt;</span> &#123;&#123;/block&#125;&#125;</span><br><span class="line">&#123;&#123;block &#x27;content&#x27;&#125;&#125; <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is just an awesome page.<span class="tag">&lt;/<span class="name">p</span>&gt;</span> &#123;&#123;/block&#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>1.比如，现在是首页模板</li>
<li>2.extend就是继承的意思；</li>
<li>3.填坑，也需要写block。</li>
</ul>
<h5 id="2-代码演示"><a href="#2-代码演示" class="headerlink" title="2. 代码演示"></a>2. 代码演示</h5><p>1.新建5.js与5.art；</p>
<ul>
<li><p>5.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> views = path.join(__dirname, <span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;4.art&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> html = template(views, &#123;</span><br><span class="line">    msg: <span class="string">&#x27;我是首页&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html);</span><br></pre></td></tr></table></figure>

<ul>
<li>和4.js一样；</li>
</ul>
</li>
<li><p>5.art</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>2.在common文件夹，新建layout[^5].art（骨架文件）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;&#123;block &#x27;link&#x27;&#125;&#125; &#123;&#123;/block&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;&#123;block &#x27;content&#x27;&#125;&#125; &#123;&#123;/block&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3.在5.art里面继承骨架模板；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;extend &#x27;../common/layout.art&#x27;&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;block &#x27;link&#x27;&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">&#123;&#123;/block&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;block &#x27;content&#x27;&#125;&#125;<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#123;&#123;/block&#125;&#125;</span><br></pre></td></tr></table></figure>



<p>4.运行5.js，查看打印结果，看有没有骨架和填坑的；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PS F:\2-3ciyuan\11-data base-shujuk\3-lianxi\5-template&gt; node .\5.js</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是首页<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>继承骨架成功</li>
<li>填坑成功</li>
</ul>
<h5 id="3-总结"><a href="#3-总结" class="headerlink" title="3. 总结"></a>3. 总结</h5><p>1.所谓的模板继承，就是把页面当中的骨架放在一个单独的模板</p>
<p>2.其他的页面模板，可以用继承的方式，获得这个骨架</p>
<p>3.</p>
<h4 id="3-7-模板配置"><a href="#3-7-模板配置" class="headerlink" title="3.7 模板配置"></a>3.7 模板配置</h4><h5 id="1-导入变量"><a href="#1-导入变量" class="headerlink" title="1. 导入变量"></a>1. 导入变量</h5><p>0.变量可以是，第三方模块的方法；用这些方法，可以处理数据；</p>
<p>1.向模板中导入变量 template.defaults[^6].imports.变量名 = 变量值;</p>
<ul>
<li>1.比如说，我们从数据库中，查出了文章的发布时间。</li>
<li>2.但是，时间的格式，是原始的格式。</li>
<li>3.我们需要对时间的格式，格式化，或者自定义<ul>
<li>1.如何格式化？</li>
<li>2.最简单的，用别人写好的方法</li>
</ul>
</li>
<li>4.在模板中，允许调用方法吗？直接调用不行，用变量装着可以；</li>
</ul>
<p>1.1 找一个处理时间的第三方模块</p>
<ul>
<li>1.dateformat</li>
<li>2.下载它：npm install dateformat</li>
<li>3.引入</li>
<li>4.引入之后返回一个方法</li>
<li>5.第一个参数，是要处理的时间，</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=72&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=72&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.2 创建6.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dateformat = <span class="built_in">require</span>(<span class="string">&#x27;dateformat&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> views = path.join(__dirname, <span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;6.art&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入模板变量</span></span><br><span class="line">template.defaults.imports.date_format = dateformat;</span><br><span class="line"><span class="keyword">const</span> html = template(views, &#123;</span><br><span class="line">    time: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html);</span><br></pre></td></tr></table></figure>



<p>1.3 创建模板6.art；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; date_format(time, &#x27;yyyy-mm-dd&#x27;) &#125;&#125;</span><br></pre></td></tr></table></figure>



<p>1.4 打印测试结果；</p>
<p>1.5 复习一下，看能根据笔记，自己写出来不；</p>
<ul>
<li><p>1.dateformat的文档：<a target="_blank" rel="noopener" href="https://github.com/felixge/node-dateformat">https://github.com/felixge/node-dateformat</a></p>
</li>
<li><p>2.js一致，art自写：</p>
<p><code>&#123;&#123; date_format(time,'yyyy-mm-dd HH:MM:ss 星期N') &#125;&#125;</code></p>
</li>
</ul>
<h5 id="2-设置根目录"><a href="#2-设置根目录" class="headerlink" title="2. 设置根目录"></a>2. 设置根目录</h5><p>1.art-template，允许我们去配置全局根目录；</p>
<p>2.模板根目录 template.defaults.root = 模板目录</p>
<p>3.虽然视频里面看着不像是全局；</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=73&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=73&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>4.设置根目录后，可以直接在template方法里面写文件名；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dateformat = <span class="built_in">require</span>(<span class="string">&#x27;dateformat&#x27;</span>);</span><br><span class="line"><span class="comment">//const views = path.join(__dirname, &#x27;views&#x27;, &#x27;6.art&#x27;);</span></span><br><span class="line"><span class="comment">// 设置模板的根目录</span></span><br><span class="line">template.defaults.root = path.join(__dirname, <span class="string">&#x27;views&#x27;</span>);</span><br><span class="line"><span class="comment">// 导入模板变量</span></span><br><span class="line">template.defaults.imports.date_format = dateformat;</span><br><span class="line"><span class="keyword">const</span> html = template(<span class="string">&#x27;6.art&#x27;</span>, &#123;</span><br><span class="line">    time: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(html);</span><br></pre></td></tr></table></figure>



<h5 id="3-后缀"><a href="#3-后缀" class="headerlink" title="3. 后缀"></a>3. 后缀</h5><p>1.设置模板默认后缀 template.defaults.extname = ‘.art’</p>
<p><img src="../../img/15.1/9.png" alt="9"></p>
<ul>
<li>1.强行不想写；</li>
<li>2.设置了默认的后缀后，会自动渲染（添加）那个后缀；</li>
</ul>
<p>2.代码：<code>template.defaults.extname = &#39;.art&#39;;</code></p>
<p>3.报错：</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PS F:<span class="symbol">\2</span>-3ciyuan<span class="symbol">\1</span>1-data base-shujuk<span class="symbol">\3</span>-lianxi<span class="symbol">\5</span>-template&gt; node .<span class="symbol">\6</span>.js</span><br><span class="line">F:<span class="symbol">\2</span>-3ciyuan<span class="symbol">\1</span>1-data base-shujuk<span class="symbol">\3</span>-lianxi<span class="symbol">\n</span>ode_modules<span class="symbol">\a</span>rt-template<span class="symbol">\l</span>ib<span class="symbol">\c</span>ompile<span class="symbol">\i</span>ndex.js:79</span><br><span class="line">                throw error;</span><br><span class="line">                ^</span><br><span class="line"></span><br><span class="line">[Error [TemplateError]: template not found: ENOENT: no such file or directory, open &#x27;F:<span class="symbol">\2</span>-3ciyuan<span class="symbol">\1</span>1-data base-shujuk<span class="symbol">\3</span>-lianxi<span class="symbol">\5</span>-template<span class="symbol">\v</span>iews<span class="symbol">\6</span>.1&#x27;]</span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.说没有找到文件</p>
</li>
<li><p>2.难道这里的方法更新了？</p>
</li>
<li><p>3.稍微百度了一下：template.defaults.extname;</p>
<ul>
<li>没啥结果，这种可能得找art-template文档；</li>
<li>说好的腾讯创建，中文文档呢？怎么连官网都没有？</li>
</ul>
</li>
</ul>
<p>3.1 找到原因：</p>
<p><img src="../../img/15.1/10.png" alt="10"></p>
<hr>
<h2 id="5-2-案例介绍-–-学生档案管理"><a href="#5-2-案例介绍-–-学生档案管理" class="headerlink" title="5.2 案例介绍 – 学生档案管理"></a>5.2 案例介绍 – 学生档案管理</h2><p>1.目标：模板引擎应用，强化node.js项目制作流程。</p>
<p>2.知识点：http请求响应、数据库、模板引擎、静态资源访问。</p>
<h3 id="1-制作流程"><a href="#1-制作流程" class="headerlink" title="1. 制作流程"></a>1. 制作流程</h3><p>建立项目文件夹并生成项目描述文件<br>创建网站服务器实现客户端和服务器端通信<br>连接数据库并根据需求设计学员信息表<br>创建路由并实现页面模板呈递<br>实现静态资源访问<br>实现学生信息添加功能<br>实现学生信息展示功能</p>
<h4 id="1-1-初始化创建"><a href="#1-1-初始化创建" class="headerlink" title="1.1 初始化创建"></a>1.1 初始化创建</h4><p>1.建立项目文件夹并生成项目描述文件</p>
<p>1.1 创建文件夹：文件名随便，我自己：Student_management_cases</p>
<p>1.2 初始化：npm init -y</p>
<ul>
<li><p>1.话说这一步的作用是什么？百度一下；</p>
</li>
<li><p>2.百度无果</p>
</li>
<li><p>3.查找以前的笔记</p>
</li>
<li><p>4.在15里面找到了，说的是项目的描述文档；记录文件？</p>
</li>
</ul>
<h4 id="1-2-创建本地服务器"><a href="#1-2-创建本地服务器" class="headerlink" title="1.2 创建本地服务器"></a>1.2 创建本地服务器</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入http模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 2.创建网站服务器</span></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br></pre></td></tr></table></figure>



<p>2.创建网站服务器实现客户端和服务器端通信</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.当客户端访问服务器端的时候</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="1-3-链接数据库"><a href="#1-3-链接数据库" class="headerlink" title="1.3 链接数据库"></a>1.3 链接数据库</h4><p>3.连接数据库并根据需求设计学员信息表</p>
<p>3.1 链接数据库</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/playground&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接成功&#x27;</span>))</span><br><span class="line">    .catch(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;数据库链接失败&#x27;</span>))</span><br></pre></td></tr></table></figure>



<p>3.2 分离链接数据库</p>
<ul>
<li>1.创建model文件夹，创建connect.js</li>
<li>2.把代码剪切过去；</li>
</ul>
<p>3.3 在app.js引入链接数据库模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.引入链接数据库模块</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./model/connect&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.因为在这里模块，没有导出</p>
</li>
<li><p>2.所以不需要变量或常量来接收返回结果；</p>
</li>
<li><p>3.突发奇想：打印出来看看？</p>
<ul>
<li><pre><code class="js">app.on(<span class="string">'request'</span>, (req, res) =&gt; &#123;
    <span class="built_in">console</span>.log(<span class="built_in">require</span>(<span class="string">'./model/connect'</span>));
    res.end(<span class="string">'ok'</span>);
&#125;)
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight yaml"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;56&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;+&lt;/span&gt; &lt;span class="string"&gt;返回的是空对象；&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;+&lt;/span&gt; &lt;span class="string"&gt;接收一下再打印试试；&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;+&lt;/span&gt; &lt;span class="string"&gt;还是空对象。。。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="string"&gt;+&lt;/span&gt; &lt;span class="number"&gt;3.1&lt;/span&gt; &lt;span class="string"&gt;哦，我想到了，是因为那边本来就没有什么键值对；那边就是连接数据库，就完了；&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="string"&gt;+&lt;/span&gt; &lt;span class="number"&gt;4&lt;/span&gt;&lt;span class="string"&gt;.所以才不需要导出，不需要变量接收引入的返回值；因为也用不到调用某一个；&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="string"&gt;+&lt;/span&gt; &lt;span class="number"&gt;5&lt;/span&gt;&lt;span class="string"&gt;.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="number"&gt;3.4&lt;/span&gt; &lt;span class="string"&gt;创建学员集合规则模块；&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="string"&gt;+&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="string"&gt;.在model文件夹下，创建user.js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="string"&gt;+&lt;/span&gt; &lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="string"&gt;.引入模块，创建规则与集合&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;```js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;const&lt;/span&gt; &lt;span class="string"&gt;mongoose&lt;/span&gt; &lt;span class="string"&gt;=&lt;/span&gt; &lt;span class="string"&gt;require(&amp;#x27;mongoose&amp;#x27;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;//&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="string"&gt;.创建学员集合规则&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;const&lt;/span&gt; &lt;span class="string"&gt;students_Schema&lt;/span&gt; &lt;span class="string"&gt;=&lt;/span&gt; &lt;span class="string"&gt;new&lt;/span&gt; &lt;span class="string"&gt;mongoose.Schema(&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="attr"&gt;name:&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;type:&lt;/span&gt; &lt;span class="string"&gt;String&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;required:&lt;/span&gt; &lt;span class="literal"&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;minlength:&lt;/span&gt; &lt;span class="number"&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;maxlength:&lt;/span&gt; &lt;span class="number"&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &amp;#125;&lt;span class="string"&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="attr"&gt;age:&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;type:&lt;/span&gt; &lt;span class="string"&gt;Number&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;min:&lt;/span&gt; &lt;span class="number"&gt;10&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;max:&lt;/span&gt; &lt;span class="number"&gt;30&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &amp;#125;&lt;span class="string"&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="attr"&gt;sex:&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;type:&lt;/span&gt; &lt;span class="string"&gt;String&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &amp;#125;&lt;span class="string"&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="attr"&gt;email:&lt;/span&gt; &lt;span class="string"&gt;String,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="attr"&gt;hobbies:&lt;/span&gt; [&lt;span class="string"&gt;String&lt;/span&gt;]&lt;span class="string"&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="string"&gt;//&lt;/span&gt; &lt;span class="string"&gt;所属学院&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="attr"&gt;collage:&lt;/span&gt; &lt;span class="string"&gt;String,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="string"&gt;//&lt;/span&gt; &lt;span class="string"&gt;入学日期&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &lt;span class="attr"&gt;enterDate:&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;type:&lt;/span&gt; &lt;span class="string"&gt;Date&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="string"&gt;//&lt;/span&gt; &lt;span class="string"&gt;默认&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;          &lt;span class="attr"&gt;default:&lt;/span&gt; &lt;span class="string"&gt;Date.now&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;&amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;//&lt;/span&gt; &lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="string"&gt;.创建集合&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;const&lt;/span&gt; &lt;span class="string"&gt;students&lt;/span&gt; &lt;span class="string"&gt;=&lt;/span&gt; &lt;span class="string"&gt;mongoose.model(&amp;#x27;Students&amp;#x27;,&lt;/span&gt; &lt;span class="string"&gt;students_Schema);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;  &lt;span class="string"&gt;module.exports&lt;/span&gt; &lt;span class="string"&gt;=&lt;/span&gt; &lt;span class="string"&gt;students;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;


</code></pre>
</li>
</ul>
</li>
</ul>
<p>3.5 设计学员信息表</p>
<ul>
<li>1.好像没说这个，视频就到创建路由了；</li>
</ul>
<h4 id="1-4-路由"><a href="#1-4-路由" class="headerlink" title="1.4 路由"></a>1.4 路由</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=75&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=75&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.创建路由并实现页面模板呈递</p>
<p>2.记得以前写的路由，杂乱，不好维护；</p>
<h5 id="1-第三方模块-router"><a href="#1-第三方模块-router" class="headerlink" title="1. 第三方模块 router"></a>1. 第三方模块 router</h5><p>功能：实现路由<br>使用步骤：<br>1.获取路由对象<br>2.调用路由对象提供的方法创建路由<br>3.启用路由，使路由生效</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.获取路由对象</span></span><br><span class="line"><span class="keyword">const</span> getRouter = <span class="built_in">require</span>(<span class="string">&#x27;router&#x27;</span>)</span><br><span class="line"><span class="comment">//2.调用路由对象提供的方法创建路由</span></span><br><span class="line"><span class="keyword">const</span> router = getRouter();</span><br><span class="line"><span class="comment">//2.调用路由对象提供的方法创建路由</span></span><br><span class="line">router.get(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line">&#125;) </span><br><span class="line"><span class="comment">//3.启用路由，使路由生效</span></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    router(req, res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>1.router.get，就是get请求响应的方法</li>
<li>2.router.post，是post请求响应的方法；</li>
<li>3.里面的第一个参数，就是路径；</li>
<li>4.第二个参数，就是写，如何处理这个请求，是一个回调函数。<ul>
<li>1.里面有两个参数，分别是请求对象和响应对象；</li>
</ul>
</li>
<li>5.</li>
</ul>
<p>3.1 启用路由，使路由生效</p>
<ul>
<li>1.require(‘router’)返回的，是一个函数。router所以也是一个函数</li>
<li>2.要调用，才能启用</li>
<li>3.调用这个路由，需要传递两个参数，分别是请求对象，响应对象<ul>
<li>为啥</li>
</ul>
</li>
<li>4.所以这个方法，需要在服务器对象下的request事件，调用；</li>
<li>5.每次客户端发来请求时，都会调用这个函数。</li>
<li>6.在方法内部，会判断，当前的请求方式与请求地址是什么。</li>
<li>7.然后在方法内部，会执行请求对应的处理函数。</li>
<li>8.也就是自己写的回调函数。</li>
</ul>
<p>4.使用</p>
<ul>
<li><p>1.先下载；npm install router</p>
</li>
<li><pre><code class="js"><span class="comment">// 6.引入router模块</span>
<span class="keyword">const</span> getRouter = <span class="built_in">require</span>(<span class="string">'router'</span>);
<span class="comment">// 6.1获取路由对象</span>
<span class="keyword">const</span> router = getRouter();
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight coffeescript"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ ```&lt;span class="javascript"&gt;js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &lt;span class="comment"&gt;// 7.呈递学生档案信息页面&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  router.get(&lt;span class="string"&gt;&amp;#x27;/add&amp;#x27;&lt;/span&gt;, &lt;span class="function"&gt;(&lt;span class="params"&gt;req, res&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;      res.end(&lt;span class="string"&gt;&amp;#x27;test&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="javascript"&gt;  &amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;


</code></pre>
</li>
</ul>
<p>4.1 但是这里报错；</p>
<p><img src="../../img/15.1/11.png" alt="11"></p>
<p>4.2 确实没有get</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">Function</span>: router] &#123;</span><br><span class="line">  caseSensitive: <span class="literal">undefined</span>,</span><br><span class="line">  mergeParams: <span class="literal">undefined</span>,</span><br><span class="line">  params: &#123;&#125;,</span><br><span class="line">  strict: <span class="literal">undefined</span>,</span><br><span class="line">  stack: [</span><br><span class="line">    Layer &#123;</span><br><span class="line">      handle: [<span class="built_in">Function</span>: handle],</span><br><span class="line">      name: <span class="string">&#x27;handle&#x27;</span>,</span><br><span class="line">      params: <span class="literal">undefined</span>,</span><br><span class="line">      path: <span class="literal">undefined</span>,</span><br><span class="line">      keys: [],</span><br><span class="line">      regexp: <span class="regexp">/^\/add\/?$/i</span>,</span><br><span class="line">      route: [Route]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>4.3 这个得去官方文档查看一下，是不是变更了方法；</p>
<ul>
<li><p>1.这个是第三方模块</p>
</li>
<li><p>2.百度无果；</p>
</li>
<li><p>3.奇想：试试有没有效果</p>
</li>
<li><p>4.启用路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.当客户端访问服务器端的时候</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    router(req, res, <span class="function">() =&gt;</span> &#123; &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.报错：</p>
<p><img src="../../img/15.1/12.png" alt="12"></p>
</li>
<li><p>2.还在报错；</p>
</li>
<li><p>3.不管！</p>
</li>
</ul>
</li>
<li><p>5.请求，响应，成功！</p>
</li>
<li><p>6.快速修复，禁止检查。滚！</p>
<ul>
<li><p>1.首先，不知道这个检测是哪来的</p>
<ul>
<li>1.百度说自带的；</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>7.那百度一下：此表达式不可调用，类型“Router”没有调用签名。</p>
<ul>
<li>1.无果</li>
</ul>
</li>
</ul>
<p>4.4 解决办法：// @ts-ignore；让ts检查无视这些错误；</p>
<ul>
<li>1.一个小时过去了；</li>
</ul>
<h4 id="1-5-页面模板呈递"><a href="#1-5-页面模板呈递" class="headerlink" title="1.5 页面模板呈递"></a>1.5 页面模板呈递</h4><p>1.当客户端，访问对应的路由的时候，我们要把对应的页面，呈递给用户</p>
<p>2.这需要模板引擎</p>
<ul>
<li>1.没下的，下载：npm install art-template</li>
</ul>
<p>3.在项目文件夹下面，创建，views[^2]文件夹；</p>
<p>4.在这个views文件夹下，我们要放模板文件；</p>
<ul>
<li><p>1.把前端文件复制过来</p>
</li>
<li><p>2.只留下html</p>
</li>
<li><p>3.CSS，JS剪切到上级文件里的public文件夹（新建）</p>
</li>
<li><p>同时，这些文件，也被称为，静态资源文件；</p>
</li>
</ul>
<p>5.回到app.js，引入模板引擎；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8.引入模板引擎</span></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>6.接下来，在对应的路由里面，渲染模板；并把渲染的结果，响应给客户端；</p>
<ul>
<li><p>1.template方法第一个参数是路径</p>
<ul>
<li><p>1.去配置模板的根目录</p>
</li>
<li><p>2.需要引入模块path；</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 9.2 引入path模板</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9.1 配置根目录</span></span><br><span class="line"><span class="keyword">const</span> views = template.defaults.root = path.join(__dirname, <span class="string">&#x27;views&#x27;</span>);</span><br></pre></td></tr></table></figure>



<ul>
<li>2.修改views下面的html为art；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line">router.get(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 9.渲染模板</span></span><br><span class="line">    <span class="keyword">let</span> html = template(<span class="string">&#x27;index.art&#x27;</span>, &#123;&#125;);</span><br><span class="line">    res.end(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<ul>
<li>3.页面一直在转：说明在等待返回结果。我们不是写了end返回了结果了吗？<ul>
<li>1.点击X；</li>
</ul>
</li>
</ul>
<p><img src="../../img/15.1/13.png" alt="13"></p>
<ul>
<li><p>4.会看到，加载出来的html；</p>
<p><img src="../../img/15.1/14.png" alt="14"></p>
<ul>
<li>1.还是问：为什么一直转？</li>
<li>2.因为html页面里面有link链接css；而这里找不到css；</li>
</ul>
</li>
<li><p>5.需要对静态资源做处理</p>
</li>
</ul>
<h5 id="1-第三方模块-serve-static"><a href="#1-第三方模块-serve-static" class="headerlink" title="1. 第三方模块 serve-static"></a>1. 第三方模块 serve-static</h5><p>0.服务serve-static静态</p>
<p>1.静态资源的代码，我们之前是写过的。但有更好的办法；</p>
<ul>
<li>1.做项目的时候，想把更多的关注点，放在项目的逻辑上；</li>
<li>2.如果在考虑项目逻辑的同时，还要想开放静态资源这样的底层代码，项目的开发结构就会被破坏；</li>
</ul>
<p>2.所以，一般会选择，使用第三方模板，来实现这功能；</p>
<p>3.功能：实现静态资源访问服务<br>4.步骤：</p>
<ul>
<li>1.引入serve-static模块获取创建静态资源服务功能的方法<ul>
<li>1.这个的返回值也是方法（现在返回值是对象变少了？）</li>
<li>2.require(‘serve-static’)返回的是一个方法<ul>
<li>1.第一个参数是静态资源目录；</li>
<li>2.返回的还是一个方法，也就是serve</li>
<li>3.这个方法是为了启用；</li>
</ul>
</li>
</ul>
</li>
<li>2.调用方法创建静态资源服务并指定静态资源服务目录</li>
<li>3.启用静态资源服务功能<ul>
<li>1.第三个参数，和路由的启用一样，是一个回调函数。必须参数；</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> serveStatic = <span class="built_in">require</span>(<span class="string">&#x27;serve-static&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> serve = serveStatic(<span class="string">&#x27;public&#x27;</span>)</span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">() =&gt;</span> &#123; </span><br><span class="line">    serve(req, res)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5.在app.js中，有了app.listen，就不需要server.listen了；</p>
<p>6.刷新页面；css获取成功；</p>
<p>7.app.js的代码样子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10. 引入静态资源访问模块</span></span><br><span class="line"><span class="keyword">const</span> serveStatic = <span class="built_in">require</span>(<span class="string">&#x27;serve-static&#x27;</span>);</span><br><span class="line"><span class="comment">// 10.1 实现静态资源访问服务</span></span><br><span class="line"><span class="keyword">const</span> serve = serveStatic(path.join(__dirname, <span class="string">&#x27;public&#x27;</span>));</span><br><span class="line"><span class="comment">// 3.当客户端访问服务器端的时候</span></span><br><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    router(req, res, <span class="function">() =&gt;</span> &#123; &#125;);</span><br><span class="line">    <span class="comment">// 10.2 启用静态资源访问功能</span></span><br><span class="line">    serve(req, res, <span class="function">() =&gt;</span> &#123; &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>7.1 之前写的原生代码的样子：</p>
<ul>
<li>1.是模板继承吗？</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.art 首页模板--&gt;</span></span><br><span class="line">&#123;&#123;extend &#x27;./layout.art&#x27;&#125;&#125;</span><br><span class="line">&#123;&#123;block &#x27;head&#x27;&#125;&#125; <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;custom.css&quot;</span>&gt;</span> &#123;&#123;/block&#125;&#125;</span><br><span class="line">&#123;&#123;block &#x27;content&#x27;&#125;&#125; <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is just an awesome page.<span class="tag">&lt;/<span class="name">p</span>&gt;</span> &#123;&#123;/block&#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>2.如果是老办法，一百个模板，岂不是写一百次；</li>
</ul>
<p>8.复习；</p>
<h5 id="2-列表页面"><a href="#2-列表页面" class="headerlink" title="2. 列表页面"></a>2. 列表页面</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/list&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> html = template(<span class="string">&#x27;list.art&#x27;</span>, &#123;&#125;);</span><br><span class="line">    res.end(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>就完了；</li>
</ul>
<p>1.不用到各个页面模板写css了；</p>
<p>2.不需要再处理，第二个渲染模板的静态资源了；</p>
<h4 id="1-6-传递数据库"><a href="#1-6-传递数据库" class="headerlink" title="1.6 传递数据库"></a>1.6 传递数据库</h4><p>添加学生信息功能步骤分析</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=77">https://www.bilibili.com/video/BV1j5411K7EH?p=77</a></p>
</blockquote>
<p>1.在模板的表单中指定请求地址与请求方式</p>
<p>2.为每一个表单项添加name属性</p>
<p>3.添加实现学生信息功能路由</p>
<p>4.接收客户端传递过来的学生信息</p>
<p>5.将学生信息添加到数据库中</p>
<p>6.将页面重定向到学生信息列表页面</p>
<h5 id="1-表单操作"><a href="#1-表单操作" class="headerlink" title="1.表单操作"></a>1.表单操作</h5><p>1.给index.art修改代码</p>
<ul>
<li><p>1.<code>&lt;form action=&quot;/add&quot; method=&quot;POST&quot;&gt;</code></p>
</li>
<li><p>2.给input添加name；</p>
<ul>
<li>1.注意name，要与数据库集合的规则名相同；</li>
<li>2.所以name是name，不是username，集合规则那边是name，不是username；</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>

<ul>
<li><p>3.有一个下拉菜单，这个把name写在哪？</p>
<ul>
<li><p>1.写在select那里；</p>
<p><code>&lt;select class=&quot;normal&quot; name=&quot;collage&quot;&gt;</code></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-路由"><a href="#2-路由" class="headerlink" title="2. 路由"></a>2. 路由</h5><p>1.新写一个router.post</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 11.实现学生信息添加功能路由</span></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line">router.post(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接受post请求参数</span></span><br><span class="line">    <span class="keyword">let</span> formData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">param</span> =&gt;</span> &#123;</span><br><span class="line">        formData += param;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(formData);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>2.处理成对象，好像是新方法；</p>
<ul>
<li>1.不，是老办法；</li>
<li>2.引入querystring模块</li>
<li>3.querystring.parse</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 11.1 引入querystring模块</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line">    req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 11.2 对象化</span></span><br><span class="line">        <span class="keyword">let</span> date = querystring.parse(formData);</span><br><span class="line">        <span class="built_in">console</span>.log(date);</span><br><span class="line">        res.end(<span class="string">&#x27;响应成功，结束&#x27;</span>);</span><br><span class="line">        <span class="comment">// 12. 乱码</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="3-传递给数据库"><a href="#3-传递给数据库" class="headerlink" title="3. 传递给数据库"></a>3. 传递给数据库</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">req.on(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 11.2 对象化</span></span><br><span class="line">    <span class="keyword">let</span> date = querystring.parse(formData);</span><br><span class="line">    <span class="comment">// 13.传递数据库</span></span><br><span class="line">    <span class="comment">// 13.1 异步函数，await</span></span><br><span class="line">    <span class="keyword">await</span> student.create(date);</span><br><span class="line">    res.writeHead(<span class="number">301</span>, &#123;</span><br><span class="line">        Location: <span class="string">&#x27;/list&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(date);</span><br><span class="line">    res.end();</span><br><span class="line">    <span class="comment">// 12. 乱码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>1.异步：await student.create(date);</p>
<p>2.直接返回返回值，省略回调函数；</p>
<ul>
<li><p>1.这里的回调函数是什么？去15-4.2-2. 创建文档–增；看以前笔记</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Course.create(&#123;<span class="attr">name</span>: <span class="string">&#x27;JavaScript基础&#x27;</span>, <span class="attr">author</span>: <span class="string">&#x27;黑马讲师&#x27;</span>, <span class="attr">isPublish</span>: <span class="literal">true</span>&#125;, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123; </span><br><span class="line">     <span class="comment">//  错误对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">     <span class="comment">//  当前插入的文档</span></span><br><span class="line">    <span class="built_in">console</span>.log(doc)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>




</li>
</ul>
<p>2.1 老样子；问：await之后，怎么输出错误信息？</p>
<ul>
<li>1.百度了一下，全是try/catch；</li>
<li>2.还没有.then+.catch方便</li>
<li>3.也许后面的Express框架会说；</li>
</ul>
<h5 id="4-完毕"><a href="#4-完毕" class="headerlink" title="4. 完毕"></a>4. 完毕</h5><p>1.完毕，现在我们实习了数据添加到数据库当中；</p>
<p>2.不过在list那边，还不会呈现出来；</p>
<h4 id="1-7-list呈现"><a href="#1-7-list呈现" class="headerlink" title="1.7 list呈现"></a>1.7 list呈现</h4><h5 id="1-分析"><a href="#1-分析" class="headerlink" title="1. 分析"></a>1. 分析</h5><p>0.学生信息列表页面分析.</p>
<p>1.从数据库中将所有的学生信息查询出来<br>2.通过模板引擎将学生信息和HTML模板进行拼接<br>3.将拼接好的HTML模板响应给客户端</p>
<h5 id="2-模板拼接"><a href="#2-模板拼接" class="headerlink" title="2. 模板拼接"></a>2. 模板拼接</h5><p>4.找到呈现信息列表的路由；</p>
<p>5.查询学生信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 14. 查询学生信息</span></span><br><span class="line"><span class="keyword">let</span> students = <span class="keyword">await</span> student.find();</span><br></pre></td></tr></table></figure>



<p>6.找到了学生信息，与模板拼接；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/list&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 14. 查询学生信息</span></span><br><span class="line">    <span class="keyword">let</span> students = <span class="keyword">await</span> student.find();</span><br><span class="line">    <span class="keyword">let</span> html = template(<span class="string">&#x27;list.art&#x27;</span>, &#123;</span><br><span class="line">        students: students,</span><br><span class="line">    &#125;);</span><br><span class="line">    res.end(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.let students = await student.find();<ul>
<li>1.students是一个数组；</li>
</ul>
</li>
</ul>
<p>7.在list.art写循环，自动生成列表；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>学员信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/list.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">caption</span>&gt;</span>学员信息<span class="tag">&lt;/<span class="name">caption</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>邮箱地址<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>所属学院<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>入学时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;&#123;each students&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.age&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.sex&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.email&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.hobbies&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.collage&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.enterDate&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;&#123;/each&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>变化：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;each students&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.age&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.sex&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.email&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.hobbies&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.collage&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$value.enterDate&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;&#123;/each&#125;&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-格式问题"><a href="#3-格式问题" class="headerlink" title="3. 格式问题"></a>3. 格式问题</h5><p>1.list能呈现了；但是：</p>
<p><img src="../../img/15.1/15.png" alt="15"></p>
<p>这些格式有问题；</p>
<p>2.性别</p>
<p>2.1 去添加数据的模块，看单选框里面存的值是什么？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">                性别:</span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span> 男</span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span> 女</span><br><span class="line">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.2 value是0与1</p>
<ul>
<li>1.改成男和女吗？</li>
<li>2.不，有时候会这样，value会写一些代替的数字</li>
</ul>
<p>2.3 在模板那边改；</p>
<p><code>&lt;th&gt;&#123;&#123;$value.sex == 0 ? '男' : '女'&#125;&#125;&lt;/th&gt;</code></p>
<p>3.同理去爱好修改：</p>
<ul>
<li>1.可能这里有三个吧，岂不是又是一个循环？</li>
<li>2.视频里面直接改value了</li>
</ul>
<p><img src="../../img/15.1/16.png" alt="16"></p>
<p>3.1 但是里面是数组，而且以前的也没变；</p>
<ul>
<li>1.还是要循环；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;each students&#125;&#125;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;th&gt;&#123;&#123;$value.name&#125;&#125;&lt;/th&gt;</span><br><span class="line">    &lt;th&gt;&#123;&#123;$value.age&#125;&#125;&lt;/th&gt;</span><br><span class="line">    &lt;th&gt;&#123;&#123;$value.sex == <span class="number">0</span> ? <span class="string">&#x27;男&#x27;</span> : <span class="string">&#x27;女&#x27;</span>&#125;&#125;&lt;/th&gt;</span><br><span class="line">    &lt;th&gt;&#123;&#123;$value.email&#125;&#125;&lt;/th&gt;</span><br><span class="line">    &lt;th&gt;</span><br><span class="line">        &#123;&#123;each $value.hobbies&#125;&#125;</span><br><span class="line">        &lt;span&gt;&#123;&#123;$value&#125;&#125;&lt;/span&gt;</span><br><span class="line">        &#123;&#123;/each&#125;&#125;</span><br><span class="line">    &lt;/th&gt;</span><br><span class="line">    &lt;th&gt;&#123;&#123;$value.collage&#125;&#125;&lt;/th&gt;</span><br><span class="line">    &lt;th&gt;&#123;&#123;$value.enterDate&#125;&#125;&lt;/th&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br></pre></td></tr></table></figure>



<p>4.时间格式</p>
<ul>
<li><p>1.依然像上次一样，用第三方模块处理；</p>
</li>
<li><p>2.先引入：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 14. 引入时间模块</span></span><br><span class="line"><span class="keyword">const</span> dateformat = <span class="built_in">require</span>(<span class="string">&#x27;dateformat&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>4.1 导入时间模板变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 14.1 导入时间模板变量</span></span><br><span class="line">template.defaults.imports.date_format = dateformat;</span><br></pre></td></tr></table></figure>



<p>4.2 去list.art直接使用方法，格式化；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;th&gt;</span><br><span class="line">    &#123;&#123;each $value.hobbies&#125;&#125;</span><br><span class="line">    &lt;span&gt;&#123;&#123;$value&#125;&#125;&lt;/span&gt;</span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line">&lt;/th&gt;</span><br><span class="line">&lt;th&gt;&#123;&#123;$value.collage&#125;&#125;&lt;/th&gt;</span><br><span class="line">&lt;!-- <span class="number">14.3</span> --&gt;</span><br><span class="line">&lt;th&gt;&#123;&#123;date_format($value.enterDate,<span class="string">&#x27;yyyy-mm-dd HH:MM:ss 星期N&#x27;</span>)&#125;&#125;&lt;/th&gt;</span><br><span class="line">&lt;/tr&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>1.为什么可以直接使用方法date_format？</p>
</li>
<li><p>2.app.js与list.art它们到底是什么关系？</p>
<ul>
<li><p>1.感觉这个是联系点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> html = template(<span class="string">&#x27;list.art&#x27;</span>, &#123;</span><br><span class="line">    students: students,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.const html = template(‘模板路径’, 数据);</p>
</li>
<li><p>3.第一个参数，只是模板路径；表示我用了某某模板</p>
</li>
<li><p>4.然后这个模板也能用app.js的方法了吗？</p>
</li>
<li><p>5.还是说，就像原生代码一样，只是有合在一起的效果，但视觉上是分离的</p>
</li>
<li><p>6.我认为上面假设合理；</p>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-优化"><a href="#2-优化" class="headerlink" title="2. 优化"></a>2. 优化</h3><p>1.有没有相对独立的代码</p>
<p>2.路由；</p>
<h4 id="2-1-路由"><a href="#2-1-路由" class="headerlink" title="2.1 路由"></a>2.1 路由</h4><p>1.把路由分离</p>
<p>2.在案例文件夹下面创建route文件夹，route文件夹下创建index.js文件</p>
<p>3.剪切代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7.呈递学生档案信息页面</span></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line">router.get(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 9.渲染模板</span></span><br><span class="line">    <span class="keyword">let</span> html = template(<span class="string">&#x27;index.art&#x27;</span>, &#123;&#125;);</span><br><span class="line">    res.end(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line">router.get(<span class="string">&#x27;/list&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 14. 查询学生信息</span></span><br><span class="line">    <span class="keyword">let</span> students = <span class="keyword">await</span> student.find();</span><br><span class="line">    <span class="keyword">let</span> html = template(<span class="string">&#x27;list.art&#x27;</span>, &#123;</span><br><span class="line">        students: students,</span><br><span class="line">    &#125;);</span><br><span class="line">    res.end(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 11.实现学生信息添加功能路由</span></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line">router.post(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接受post请求参数</span></span><br><span class="line">    <span class="keyword">let</span> formData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">param</span> =&gt;</span> &#123;</span><br><span class="line">        formData += param;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// 11.2 对象化</span></span><br><span class="line">        <span class="keyword">let</span> date = querystring.parse(formData);</span><br><span class="line">        <span class="comment">// 13.传递数据库</span></span><br><span class="line">        <span class="comment">// 13.1 异步函数，await</span></span><br><span class="line">        <span class="keyword">await</span> student.create(date);</span><br><span class="line">        res.writeHead(<span class="number">301</span>, &#123;</span><br><span class="line">            Location: <span class="string">&#x27;/list&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">console</span>.log(date);</span><br><span class="line">        res.end();</span><br><span class="line">        <span class="comment">// 12. 乱码</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>4.剪切需要的模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.引入数据库集合模块</span></span><br><span class="line"><span class="keyword">const</span> student = <span class="built_in">require</span>(<span class="string">&#x27;../model/user&#x27;</span>);</span><br><span class="line"><span class="comment">// 6.引入router模块</span></span><br><span class="line"><span class="keyword">const</span> getRouter = <span class="built_in">require</span>(<span class="string">&#x27;router&#x27;</span>);</span><br><span class="line"><span class="comment">// 6.1获取路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = getRouter();</span><br><span class="line"><span class="comment">// 11.1 引入querystring模块</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.注意user.js的路径</li>
</ul>
<p>5.需要复制的代码模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8.引入模板引擎</span></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>6.导出router；引入router</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 15. 引入分离出去的router</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./route/index&#x27;</span>);</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="6-Express框架"><a href="#6-Express框架" class="headerlink" title="6. Express框架"></a>6. Express框架</h1><p> 目标：</p>
<p>能够使用Express创建web服务器<br> 能够使用Express处理请求参数<br> 能够使用Express处理静态资源<br> 能够使用中间件处理请求<br> 能够在Express中集成art-template模板引擎</p>
<p>目录：</p>
<p> Express框架简介及初体验<br> Express框架请求处理<br> express-art-template模板引擎<br> Express中间件</p>
<h2 id="6-1-Express框架简介及初体验"><a href="#6-1-Express框架简介及初体验" class="headerlink" title="6.1 Express框架简介及初体验"></a>6.1 Express框架简介及初体验</h2><h3 id="1-Express框架是什么"><a href="#1-Express框架是什么" class="headerlink" title="1. Express框架是什么"></a>1. Express框架是什么</h3><p>1.Express是一个基于Node平台的web应用开发框架，它提供了一系列的强大特性，帮助你创建各种Web应用。我们可以使用 npm install express 命令进行下载。</p>
<h3 id="2-Express框架特性"><a href="#2-Express框架特性" class="headerlink" title="2. Express框架特性"></a>2. Express框架特性</h3><p>1.提供了方便简洁的路由定义方式</p>
<ul>
<li>1.第三方模块router，出至于express</li>
</ul>
<p>2.对获取HTTP请求参数进行了简化处理</p>
<p>3.对模板引擎支持程度高，方便渲染动态HTML页面</p>
<p>4.提供了中间件机制有效控制HTTP请求</p>
<p>5.拥有大量第三方中间件对功能进行扩展</p>
<h3 id="3-对比之路由"><a href="#3-对比之路由" class="headerlink" title="3. 对比之路由"></a>3. 对比之路由</h3><p>1.原生Node.js与Express框架对比之路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取客户端的请求路径</span></span><br><span class="line">    <span class="keyword">let</span> &#123; pathname &#125; = url.parse(req.url);</span><br><span class="line">    <span class="comment">// 对请求路径进行判断 不同的路径地址响应不同的内容</span></span><br><span class="line">    <span class="keyword">if</span> (pathname == <span class="string">&#x27;/&#x27;</span> || pathname == <span class="string">&#x27;index&#x27;</span>) &#123;</span><br><span class="line">       res.end(<span class="string">&#x27;欢迎来到首页&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname == <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">       res.end(<span class="string">&#x27;欢迎来到列表页页&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname == <span class="string">&#x27;/about&#x27;</span>) &#123;</span><br><span class="line">       res.end(<span class="string">&#x27;欢迎来到关于我们页面&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       res.end(<span class="string">&#x27;抱歉, 您访问的页面出游了&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当客户端以get方式访问/时</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 对客户端做出响应</span></span><br><span class="line">    res.send(<span class="string">&#x27;Hello Express&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当客户端以post方式访问/add路由时</span></span><br><span class="line">app.post(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   res.send(<span class="string">&#x27;使用post方式请求了/add路由&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="4-对比之获取请求参数"><a href="#4-对比之获取请求参数" class="headerlink" title="4. 对比之获取请求参数"></a>4. 对比之获取请求参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 获取GET参数</span></span><br><span class="line">   <span class="keyword">let</span> &#123;query&#125; = url.parse(req.url, <span class="literal">true</span>);</span><br><span class="line">   <span class="comment">// 获取POST参数</span></span><br><span class="line">   <span class="keyword">let</span> postData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">   req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">       postData += chunk;</span><br><span class="line">   &#125;);</span><br><span class="line">   req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(querystring.parse(postData)</span><br><span class="line">   &#125;)); </span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 获取GET参数</span></span><br><span class="line">   <span class="built_in">console</span>.log(req.query);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 获取POST参数</span></span><br><span class="line">   <span class="built_in">console</span>.log(req.body);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-Express初体验"><a href="#5-Express初体验" class="headerlink" title="5. Express初体验"></a>5. Express初体验</h3><p>1.下载框架：npm install express</p>
<p>2.创建文件夹 7-express，创建 1.js</p>
<p>3.引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入express框架</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>4.引入了express，就不需要http了</p>
<p>4.1 创建网站服务器（不是本地服务器吗？）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.创建网站服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br></pre></td></tr></table></figure>

<ul>
<li>1.直接就是调用方法。。。</li>
</ul>
<p>4.2 监听端口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>5.创建路由。</p>
<ul>
<li>1.在express方法里面，有get方法与post方法；等于app有</li>
</ul>
<p><code>app.get()</code></p>
<ul>
<li><p>2.当客户端什么都不写，只访问localhost:3000；</p>
<ul>
<li>1.默认的地址是‘/’；</li>
<li>2.<code>app.get(&#39;/&#39;)</code></li>
</ul>
</li>
<li><p>3.第二个参数，是请求处理函数，也是回调函数。</p>
<ul>
<li><code>app.get(&#39;/&#39;, (req,res)=&gt;&#123;&#125;)</code></li>
</ul>
</li>
<li><p>4.对客户端响应；</p>
<ul>
<li><p>1.这里不用end了，而是send[^9]；</p>
</li>
<li><p>2.在send方法里面，会自动检查响应数据的类型，并自动写在响应报头中；</p>
<ul>
<li>1.同时也会设置响应类型的编码，以防止乱码的情况</li>
</ul>
</li>
<li><p>3.还会自动设置http状态码；</p>
</li>
<li><p>4.可以去F12-network看</p>
</li>
<li><p>5.找不到页面也进行了优化；</p>
</li>
<li><p>6.还可以写json数据，以前的end是不行的；</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.创建路由</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Hello Express&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/list&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(&#123; <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>6.以上是入门案例与基础；</p>
<hr>
<h2 id="6-2-中间件"><a href="#6-2-中间件" class="headerlink" title="6.2 中间件"></a>6.2 中间件</h2><h3 id="1-什么是中间件"><a href="#1-什么是中间件" class="headerlink" title="1. 什么是中间件"></a>1. 什么是中间件</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=81&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=81&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.中间件就是express提供的一堆方法，可以接收客户端发来的请求、可以对请求做出响应，也可以将请求继续交给下一个中间件继续处理。</p>
<ul>
<li>1.中间件，是专门接收请求与处理请求的。视频说的</li>
<li>2.中间件，像阀门；</li>
</ul>
<p><img src="../../img/15.1/17.png" alt="17"></p>
<p>2.中间件主要由两部分构成，中间件方法以及请求处理函数。<br>中间件方法由Express提供，负责拦截请求，请求处理函数由开发人员提供，负责处理请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;请求路径&#x27;</span>, <span class="string">&#x27;处理函数&#x27;</span>)   <span class="comment">// 接收并处理get请求</span></span><br><span class="line">app.post(<span class="string">&#x27;请求路径&#x27;</span>, <span class="string">&#x27;处理函数&#x27;</span>)  <span class="comment">// 接收并处理post请求</span></span><br></pre></td></tr></table></figure>

<ul>
<li>1.刚使用的路由，就是中间件</li>
</ul>
<p>3.可以针对同一个请求设置多个中间件，对同一个请求进行多次处理。<br>默认情况下，请求从上到下依次匹配中间件，一旦匹配成功，终止匹配。</p>
<p>3.1 请求处理函数，除了请求参数，响应参数，还有第三个参数，next方法；</p>
<ul>
<li>可以调用next方法将请求的控制权交给下一个中间件，直到遇到结束请求的中间件。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/request&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    req.name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">&#x27;/request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(req.name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="2-app-use中间件用法"><a href="#2-app-use中间件用法" class="headerlink" title="2. app.use中间件用法"></a>2. app.use中间件用法</h3><p>1.app.use 匹配所有的请求方式，可以直接传入请求处理函数，代表接收所有的请求。</p>
<ul>
<li>1.无论get，post；</li>
<li>2.当然如果它在后面，前面的请求被其他路由处理了，也不会接收到；</li>
<li>3.用变量常量的说话：没有变量提升；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>2.app.use 第一个参数也可以传入请求地址，代表不论什么请求方式，只要是这个请求地址就接收这个请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>3.注意，上面两者，不会互相阻断。两个路由都可以处理/admin；</p>
<h3 id="3-中间件应用"><a href="#3-中间件应用" class="headerlink" title="3. 中间件应用"></a>3. 中间件应用</h3><p>1.路由保护，客户端在访问需要登录的页面时，可以先使用中间件判断用户登录状态，用户如果未登录，则拦截请求，直接响应，禁止用户进入需要登录的页面。</p>
<p>1.1 代码：</p>
<ul>
<li>1.然而真实的判断是否登录，这里不是。</li>
<li>2.只是模拟的；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 1.引入express框架</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.创建网站服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.判断是否登录</span></span><br><span class="line">app.use(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 用户没有登录</span></span><br><span class="line">    <span class="keyword">let</span> isLogin = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isLogin) &#123;</span><br><span class="line">        next();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.send(<span class="string">&#x27;还没有登录，不能访问admin&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.创建需要登录才能访问的路由</span></span><br><span class="line">app.get(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;已经登录，可以访问&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>2.网站维护公告，在所有路由的最上面定义接收所有请求的中间件，直接为客户端做出响应，网站正在维护中。</p>
<p>2.1 在所有路由前面，写use路由；不写next()即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6.网站公告</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;当前网站正在维护，可以问文杰&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>3.自定义404页面</p>
<p>3.1 这个就是放在最下面，上面的所有路由都没有接收到请求，那么这个请求的地址，就是404了</p>
<ul>
<li>1.但是，send返回的状态码是200</li>
<li>2.如果想改成404；<ul>
<li>1.使用res.status[^10]()</li>
<li>2.参数是状态码；</li>
</ul>
</li>
<li>3.它可以链式调用；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7. 自定义404</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 为客户端响应404状态码，以及提示信息</span></span><br><span class="line">    res.status(<span class="number">404</span>).send(<span class="string">&#x27;404，没有找到这个地址的路由&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="4-错误处理中间件"><a href="#4-错误处理中间件" class="headerlink" title="4. 错误处理中间件"></a>4. 错误处理中间件</h3><h4 id="4-1-同步出错"><a href="#4-1-同步出错" class="headerlink" title="4.1 同步出错"></a>4.1 同步出错</h4><p>1.在程序执行的过程中，不可避免的会出现一些无法预料的错误，比如文件读取失败，数据库连接失败。错误处理中间件是一个集中处理错误的地方。</p>
<ul>
<li>1.逻辑错误，在开发阶段</li>
<li>2.读取文件，文件不在，或者等等错误，必须是执行后</li>
<li>3.而一旦出错，代码就会中断。也不会返回东西</li>
<li>4.必须要在开发阶段，处理错误才行；</li>
</ul>
<p>1.1 如果在每个可能出错的地方添加处理错误的代码；就很多了</p>
<ul>
<li>1.中间件提供了一个集合</li>
<li>2.注意有4个参数，不过next用不到的话，就可以不写；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">500</span>).send(<span class="string">&#x27;服务器发生未知错误&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>1.2 去代码验证：创建4.js</p>
<ul>
<li><p>1.创建错误处理中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.错误处理中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">500</span>).send(<span class="string">&#x27;服务器端错误&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.创建故意错误</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.创建故意错误</span></span><br><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">Error</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>1.3 Error()</p>
<ul>
<li><p>1.在node.js当中，有一个构造函数，叫Error()</p>
<ul>
<li>构造函数，是包对象的；</li>
</ul>
</li>
<li><p>2.它的作用：创建错误；</p>
</li>
<li><p>3.代码：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.创建故意错误</span></span><br><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;程序发生了未知错误&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>1.4 在处理错误中间中的 err参数，其实就是 new Error对象；</p>
<ul>
<li>1.下面的一个键名：message，就是里面的信息；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.错误处理中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// res.status(500).send(&#x27;服务器端错误&#x27;);</span></span><br><span class="line">    res.status(<span class="number">500</span>).send(err.message);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>1.5 执行文件，nodemon 4.js</p>
<p>1.6 没有错误，不会执行错误中间件；</p>
<p>1.7 注意，错误中间件，只能捕获到同步代码出错；</p>
<p>1.8 上面的总代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入express框架</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.创建网站服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.创建故意错误</span></span><br><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;程序发生了未知错误&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.错误处理中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// res.status(500).send(&#x27;服务器端错误&#x27;);</span></span><br><span class="line">    res.status(<span class="number">500</span>).send(err.message);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h4 id="4-2-异步出错"><a href="#4-2-异步出错" class="headerlink" title="4.2 异步出错"></a>4.2 异步出错</h4><p>1.异步出错的时候，需要我们手动去调用错误中间件；</p>
<p>2.当程序出现错误时，调用next()方法，并且将错误信息通过参数的形式传递给next()方法，即可触发错误处理中间件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">     fs.readFile(<span class="string">&quot;/file-does-not-exist&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            next(err);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>3.代码验证：</p>
<p>3.1 引入读取文件模块</p>
<p>3.2 故意读取错误文件</p>
<p>3.3 记得要添加next参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 3.1</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.创建故意错误</span></span><br><span class="line"><span class="comment">// 3.3 记得要添加next参数</span></span><br><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// throw new Error(&#x27;程序发生了未知错误&#x27;);</span></span><br><span class="line">    <span class="comment">// 3.2 故意读取错误文件</span></span><br><span class="line">    fs.readFile(<span class="string">&#x27;./dem.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            next(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.send(<span class="string">&#x27;木问题&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">500</span>).send(err.message);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>





<h3 id="5-捕获错误"><a href="#5-捕获错误" class="headerlink" title="5. 捕获错误"></a>5. 捕获错误</h3><p>1.在node.js中，异步API的错误信息都是通过回调函数获取的，支持Promise对象的异步API发生错误可以通过catch方法捕获。</p>
<p>2.异步函数执行如果发生错误要如何捕获错误呢？</p>
<ul>
<li>异步函数就特殊了，它是异步代码，但是写成了同步形式；</li>
</ul>
<p>2.1 try catch 可以捕获异步函数以及其他同步代码在执行过程中发生的错误，但是不能其他类型的API发生的错误。</p>
<ul>
<li><p>try/catch，是node.js专门来捕获异步函数的出错的；</p>
</li>
<li><p>1.同时也能捕获同步错误；但不能捕获 除了异步函数的，异步错误</p>
</li>
<li><p>2.同时也为前面解惑了；</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> User.find(&#123;<span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>&#125;)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(ex) &#123;</span><br><span class="line">        next(ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>2.2 语法解析</p>
<ul>
<li>1.try[^11]与catch后面都是大括号</li>
<li>2.try里面写可能出错的代码<ul>
<li>1.没有错误，跳出try/catch</li>
<li>2.报错：进入catch</li>
</ul>
</li>
<li>3.catch[^12]的参数，是错误信息；</li>
</ul>
<p>2.3 代码验证：创建5.js</p>
<ul>
<li>1.我们还是读取文件，但要改造成支持异步函数的形式；</li>
<li>2.需要引入新的模块；fs默认不支持异步函数；<ul>
<li>1.它是util模块下的方法，util模块不熟。但这里先不去查阅了解；</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promisify = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>).promisify;</span><br></pre></td></tr></table></figure>



<ul>
<li>3.异步API化 fs.readFile , 异步函数化 回调函数，</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 3.1</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promisify = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>).promisify;</span><br><span class="line"><span class="comment">// 1.异步API化 fs.readFile</span></span><br><span class="line"><span class="keyword">const</span> readFile = promisify(fs.readFile);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.异步函数化 回调函数</span></span><br><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如果这样，命名行那边会报错，但是客户端看不到</span></span><br><span class="line">    <span class="comment">// await readFile(&#x27;./1111.js&#x27;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.try/catch</span></span><br><span class="line">    <span class="comment">// 3.1 这样写之后，命名行那边不会报错，因为有处理报错</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> readFile(<span class="string">&#x27;./1111.js&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        next(err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">500</span>).send(err.message);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>2.4 这样写之后，命名行那边不会报错，因为有处理报错。</p>
<ul>
<li>1.程序不会因为某个文件没读取到，而终止所有运行；</li>
</ul>
<h2 id="6-3-Express框架请求处理"><a href="#6-3-Express框架请求处理" class="headerlink" title="6.3 Express框架请求处理"></a>6.3 Express框架请求处理</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=86&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=86&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<h3 id="1-构建模块化路由"><a href="#1-构建模块化路由" class="headerlink" title="1. 构建模块化路由"></a>1. 构建模块化路由</h3><h4 id="1-1-创建路由"><a href="#1-1-创建路由" class="headerlink" title="1.1 创建路由"></a>1.1 创建路由</h4><p>1.项目的路由是很多的；</p>
<p>2.有时候多了，就要分类；分成各个模块</p>
<p>3.先看一个代码：二级路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>) </span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> home = express.Router();</span><br><span class="line"><span class="comment">// 将路由和请求路径进行匹配</span></span><br><span class="line">app.use(<span class="string">&#x27;/home&#x27;</span>, home);</span><br><span class="line"> <span class="comment">// 在home路由下继续创建路由</span></span><br><span class="line">home.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">         <span class="comment">//  /home/index</span></span><br><span class="line">        res.send(<span class="string">&#x27;欢迎来到博客展示页面&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3.1 这句代码：<code>app.use(&#39;/home&#39;, home);</code></p>
<ul>
<li>1.以前home那里，都是写的回调函数，而这里，写的是路由对象；</li>
<li>查看app.use；没看到什么信息</li>
</ul>
<p>3.2  express.Router();的文档倒是没问题，就是创建路由对象。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://expressjs.com/en/api.html#express.router">http://expressjs.com/en/api.html#express.router</a></p>
</blockquote>
<ul>
<li>1.平常在express的框架下，处理get请求，post请求，都是在app(服务器)下处理的</li>
<li>2.而这个路由对象，居然可以替代app；来形成几个层次的路由；</li>
</ul>
<p>4.这个怎么模块化了？模块化到底是什么？</p>
<ul>
<li><p>1.回想刚学node的时候</p>
<blockquote>
<p>Node.js规定一个==JavaScript文件==就是一个模块，模块==内部定义的变量和函数==默认情况下在==外部无法得到==</p>
</blockquote>
</li>
<li><p>2.也就是说，express的路由，会和上面没用express框架的路由一样，会在一个单独的js文件。不在app.js里</p>
</li>
</ul>
<p>5.视频说，上面是创建路由的基础代码。上面才是创建路由？那之前的app.get，app.post，其实不是在创建路由？</p>
<ul>
<li>1.不，我感觉是路由，反正是路由的功能；</li>
</ul>
<h4 id="1-2-路由模块化"><a href="#1-2-路由模块化" class="headerlink" title="1.2 路由模块化"></a>1.2 路由模块化</h4><p>6.看代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// home.js</span></span><br><span class="line"><span class="keyword">const</span> home = express.Router(); </span><br><span class="line">home.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;欢迎来到博客展示页面&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = home;</span><br></pre></td></tr></table></figure>



<p>6.1 先是创建了home路由，再用home.get；路由再路由，创建了2级路由；</p>
<p>7.上面，其实就已经是一个模块</p>
<p>8.看另一个模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// admin.js</span></span><br><span class="line"><span class="keyword">const</span> admin = express.Router();</span><br><span class="line">admin.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;欢迎来到博客管理页面&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = admin;</span><br></pre></td></tr></table></figure>



<p>8.1 和6一模一样；最后，要记得导出路由对象；</p>
<ul>
<li>1.创建路由对象</li>
<li>2.路由再路由，二级路由。</li>
<li>3.res.send返回什么；</li>
</ul>
<p>8.2 二级路由的回调函数里面，都没看到req，与res；</p>
<p>9.要想使用路由模块，还是需要在app引入，然后为每个路由模块，匹配请求路径；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> home = <span class="built_in">require</span>(<span class="string">&#x27;./route/home.js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> admin = <span class="built_in">require</span>(<span class="string">&#x27;./route/admin.js&#x27;</span>);</span><br><span class="line">app.use(<span class="string">&#x27;/home&#x27;</span>, home);</span><br><span class="line">app.use(<span class="string">&#x27;/admin&#x27;</span>, admin);</span><br></pre></td></tr></table></figure>



<p>10.代码验证：上面的6.js没写东西，就写使用路由模块吧；</p>
<ul>
<li><p>1.要创建新文件了；route，路由文件夹；装路由模块；为啥少一个r，不是router；查查两个单词；</p>
</li>
<li><blockquote>
<p>route<br>英 [ruːt]   美 [ruːt]<br>n.路线;路途;(公共汽车和列车等的)常规路线，固定线路;途径;渠道<br>v.按某路线发送</p>
</blockquote>
<blockquote>
<p>router<br>英 [ˈruːtə(r) , ˈraʊtə(r)]  美 [ˈruːtər , ˈraʊtər]<br>n.路由器(传送信息的专用网络设备)<br>n.槽刨</p>
</blockquote>
</li>
<li><p>2.感觉不出什么区别，不过，规律是：文件夹使用route，代码里面基本都是router；模块名，方法名也是router</p>
</li>
</ul>
<p>10.1 route文件夹下，创建home.js，admin.js</p>
<ul>
<li><p>1.写入上面的代码；要引入express模块，而且二级路由回调函数写了参数！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// home.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"> <span class="keyword">const</span> home = express.Router(); </span><br><span class="line"> home.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">     res.send(<span class="string">&#x27;欢迎来到博客展示页面&#x27;</span>);</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="built_in">module</span>.exports = home;</span><br></pre></td></tr></table></figure>
</li>
<li><pre><code class="js"> <span class="comment">// admin.js</span>
<span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
 <span class="keyword">const</span> admin = express.Router();
 admin.get(<span class="string">'/index'</span>, (req,res) =&gt; &#123;
     res.send(<span class="string">'欢迎来到博客管理页面'</span>);
 &#125;);
 <span class="built_in">module</span>.exports = admin;
&lt;!--hexoPostRenderEscape:&lt;figure class="highlight http"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10.2 等等！这个创建路由对象，是不是为了分离而用的？以前不用express框架是怎么分离路由的？&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&amp;lt;img src=&amp;quot;../../img/15.1/18.png&amp;quot; alt=&amp;quot;18&amp;quot; style=&amp;quot;zoom:80%;&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;+ 1.为什么是二级路由？都是这个过程，以前就不是；因为↑&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;10.3 app.js使用模块：&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;```js&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;const express = require(&amp;#x27;express&amp;#x27;);&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;const app = express();&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;const home = require(&amp;#x27;./route/home&amp;#x27;);&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;const admin = require(&amp;#x27;./route/admin&amp;#x27;);&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;app.use(&amp;#x27;/home&amp;#x27;, home);&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;app.use(&amp;#x27;/admin&amp;#x27;, admin);&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;/span&gt;&lt;br&gt;&lt;span class="line"&gt;&lt;span class="attribute"&gt;app.listen(3000);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre>
</li>
<li><p>1.app.js就这点代码，现在真的变整洁了；</p>
</li>
</ul>
<p>10.4 运行测试；</p>
<p><a target="_blank" rel="noopener" href="http://localhost:3000/admin/index">http://localhost:3000/admin/index</a></p>
<p><a target="_blank" rel="noopener" href="http://localhost:3000/home/index">http://localhost:3000/home/index</a></p>
<hr>
<h3 id="2-GET参数的获取"><a href="#2-GET参数的获取" class="headerlink" title="2. GET参数的获取"></a>2. GET参数的获取</h3><p>1.Express框架中使用req.query即可获取GET参数，框架内部会将GET参数转换为对象并返回。</p>
<ul>
<li><p>1.不需要引入url模块了；</p>
</li>
<li><p>2.不过实验证明，即使没有引入url模块，req.url仍然有效果；</p>
</li>
<li><p>3.假设：是你记错了，url模块不是这个功能</p>
<ul>
<li>1.找笔记</li>
</ul>
<blockquote>
<ul>
<li><p>1.在node里面，有一种模块叫内置模块。</p>
</li>
<li><p>2.而这里面有一个叫url的内置模块。用于处理url地址；</p>
</li>
<li><p>3.url有一个解析的方法：url.parse。</p>
<ul>
<li>3.1 它都够把url转换成对象的形式；</li>
<li>url.parse(req.url)；转换请求地址</li>
</ul>
</li>
</ul>
</blockquote>
</li>
<li><p>4.那么，在不引入的情况下，url.parse有效果吗？即使是弃用的方法，在引入url的情况是有效果的，实验不引入有没有效果；</p>
<ul>
<li>1.如果有效果，那么不引入也没事。</li>
<li>2.如果没效果，那确实需要引入；</li>
<li>3.结果：引入了才有效果；</li>
</ul>
</li>
<li><p>5.那么新方法需要引入吗？不需要引入；</p>
<ul>
<li>1.那也是应该的，因为没有使用url.xxoo；</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收地址栏中问号后面的参数</span></span><br><span class="line"><span class="comment">// 例如: http://localhost:3000/?name=zhangsan&amp;age=30</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(req.query); <span class="comment">// &#123;&quot;name&quot;: &quot;zhangsan&quot;, &quot;age&quot;: &quot;30&quot;&#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>2.验证代码；</p>
<ul>
<li>1.创建新文件：7.js；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.query); <span class="comment">// &#123;&quot;name&quot;: &quot;zhangsan&quot;, &quot;age&quot;: &quot;30&quot;&#125;</span></span><br><span class="line">    res.send(req.query);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>2.然后网址：<a target="_blank" rel="noopener" href="http://localhost:3000/?name=zhangsan&amp;age=30">http://localhost:3000/?name=zhangsan&amp;age=30</a><ul>
<li>1.返回：{“name”:”zhangsan”,”age”:”30”}</li>
</ul>
</li>
<li>3.如果没有问候后面的，就是空对象；</li>
</ul>
<p>3.获取get参数，很轻松，express框架</p>
<h3 id="3-post参数获取"><a href="#3-post参数获取" class="headerlink" title="3. post参数获取"></a>3. post参数获取</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j5411K7EH?p=89&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1j5411K7EH?p=89&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p>1.Express中接收post请求参数需要借助第三方包 body-parser[^13]。</p>
<ul>
<li>1.urlencoded = url_encoded[^14]</li>
<li>2.extended[^15]</li>
<li>3.这个模块是express官方提供的；<ul>
<li>1.为了使express小。要用的时候再npm下载</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入body-parser模块</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="comment">// 配置body-parser模块</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"><span class="comment">// 接收请求</span></span><br><span class="line">app.post(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 接收请求参数</span></span><br><span class="line">   <span class="built_in">console</span>.log(req.body);</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>



<p>1.1  app.use(bodyParser.urlencoded({ extended: false }));</p>
<ul>
<li>1.抢先在所有请求前，先用bodyParser下的urlencoded方法处理；</li>
<li>2.该方法会检测当前请求中是否有请求参数，如果有，会接收请求参数，处理成对象类型；</li>
<li>3.然后再为req对象，添加一个属性，属性的名字是body，并把请求参数的值，赋值了req.body</li>
<li>4.最后在方法内部，调用了next()方法，将请求控制权，交给了下一个中间件</li>
<li>5.所以，在接下来的路由中，我们可以通过req.body拿到这个对象类型的请求参数。</li>
</ul>
<p>1.2 extended: false</p>
<ul>
<li><p>0.这还是个必选参数；</p>
</li>
<li><p>1.扩展</p>
</li>
<li><p>2.当为false时，会使用querystring系统模块处理；</p>
</li>
<li><p>3.当为true时，会使用一个叫QS的第三方模块处理，QS也能把请求参数，转换为对象类型，而且比querystring系统模块功能，更加强大；</p>
</li>
<li><p>4.但是现在flase就够用，加上官方也建议不用的不用；</p>
</li>
</ul>
<p>1.3 代码验证：</p>
<ul>
<li>1.新建文件9.js</li>
<li>2.下载body-parser；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br></pre></td></tr></table></figure>

<ul>
<li>3.说bodyParser被弃用。。。</li>
<li>4.百度了一番，无果，如果有作用效果，那无视弃用信息；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入body-parser模块</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置body-parser模块</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"><span class="comment">// 接收请求</span></span><br><span class="line">app.post(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接收请求参数</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.body);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>1.3.1 创建表单：express文件夹下，创建post.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://localhost:3000/add&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>1.3.2 验证；没问题；</p>
<h3 id="4-app-user方法疑惑"><a href="#4-app-user方法疑惑" class="headerlink" title="4. app.user方法疑惑"></a>4. app.user方法疑惑</h3><p>0.app.use(bodyParser.urlencoded({ extended: false }));</p>
<p>1.app.user方法，需要传递一个请求处理函数进去，为什么这里又是方法的调用呢？</p>
<ul>
<li>实际上这个方法的返回值，还是一个方法（函数）。</li>
</ul>
<p>2.代码验证：</p>
<p>2.1 创建新的js；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入body-parser模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// app.use(fn());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1可以等于</span></span><br><span class="line"><span class="comment">// app.use(function (req, res, next) &#123;</span></span><br><span class="line"><span class="comment">//     console.log(req.method);</span></span><br><span class="line"><span class="comment">//     next();</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(req.method);</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>2.2 证明，函数里面的函数，能被调用；</p>
<p>2.3 好处：在调用某个请求函数的同时，可以向这个函数内部，添加一些额外的参数。</p>
<ul>
<li><p>1.在请求函数内部，可以根据参数，改变行为；</p>
</li>
<li><p>2.演示</p>
<ul>
<li>1.我们在<code>app.use(fn());</code>内部写入一个对象；</li>
<li>2.<code>app.use(fn(&#123;a: 1&#125;))</code></li>
<li>3.写入了一个实参，那么这个函数那边必须要有一个形参</li>
<li>4.<code>function fn(obj)</code></li>
<li>5.写一个判断</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 5</span></span><br><span class="line">        <span class="keyword">if</span> (obj.a == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(req.url)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(req.method)</span><br><span class="line">        &#125;</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.这样就改变了行为….虽然我现在还不知道具体能干嘛；</p>
</li>
</ul>
<p>2.4 总代码；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入body-parser模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line">app.use(fn(&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1可以等于</span></span><br><span class="line"><span class="comment">// app.use(function (req, res, next) &#123;</span></span><br><span class="line"><span class="comment">//     console.log(req.method);</span></span><br><span class="line"><span class="comment">//     next();</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 5</span></span><br><span class="line">        <span class="keyword">if</span> (obj.a == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(req.url)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(req.method)</span><br><span class="line">        &#125;</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="5-Express路由参数"><a href="#5-Express路由参数" class="headerlink" title="5. Express路由参数"></a>5. Express路由参数</h3><p>1.在express框架下，接收get请求的参数，还有另一种方式；</p>
<ul>
<li>1.被称作为路由参数；</li>
<li>2.这个参数，可以让请求地址更美观；</li>
</ul>
<p>2.请求地址是<code>/find</code>，<code>/:id</code>是请求参数；这个<code>:</code>不是实际的东西，url里面没有的，是一个占位符；表示请求当前路由，需要传递一个id作为参数</p>
<ul>
<li>这个参数，就没 ？分隔了？</li>
</ul>
<p>2.1 这是在服务器端指定路由方式；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/find/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="comment">// 服务器端接收参数</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.params); <span class="comment">// &#123;id: 123&#125; </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>2.2 在客户端书写请求地址，只不过不是问号？，分隔了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost:<span class="number">3000</span>/find/<span class="number">123</span></span><br></pre></td></tr></table></figure>



<p>2.3 服务器端接收参数</p>
<ul>
<li>1.在req对象里，有一个params的属性。这个属性的值，是一个对象，对象中就存储着路由参数；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器端接收参数</span></span><br><span class="line"><span class="built_in">console</span>.log(req.params); <span class="comment">// &#123;id: 123&#125; </span></span><br></pre></td></tr></table></figure>



<p>2.4 代码验证；</p>
<ul>
<li><p>1.如果只写路径，不写参数，是匹配不到路由的</p>
</li>
<li><p>2.和问号不一样；</p>
</li>
<li><p>3.如果想写问个参数，直接加</p>
<p><code>/xxx/:id/:name/:age</code></p>
</li>
<li><p>4.</p>
</li>
</ul>
<p>2.5 路由参数与get参数，没有具体好坏之分。都可以使用；</p>
<h3 id="6-静态资源的处理"><a href="#6-静态资源的处理" class="headerlink" title="6. 静态资源的处理"></a>6. 静态资源的处理</h3><p>1.通过Express内置的express.static可以方便地托管静态文件，例如img、CSS、JavaScript 文件等。</p>
<ul>
<li>1.这个方法有一个参数，就是静态资源目录；</li>
</ul>
<p><code>app.use(express.static(&#39;public&#39;));</code></p>
<p>2.现在，public 目录下面的文件就可以访问了。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://localhost:3000/images/kitten.jpg">http://localhost:3000/images/kitten.jpg</a><br><a target="_blank" rel="noopener" href="http://localhost:3000/css/style.css">http://localhost:3000/css/style.css</a><br><a target="_blank" rel="noopener" href="http://localhost:3000/js/app.js">http://localhost:3000/js/app.js</a><br><a target="_blank" rel="noopener" href="http://localhost:3000/images/bg.png">http://localhost:3000/images/bg.png</a><br><a target="_blank" rel="noopener" href="http://localhost:3000/hello.html">http://localhost:3000/hello.html</a> </p>
</li>
<li><p>等于</p>
</li>
<li><pre><code>http://localhost:3000/public/images/kitten.jpg
http://localhost:3000/public/css/style.css
http://localhost:3000/public/js/app.js
http://localhost:3000/public/images/bg.png
http://localhost:3000/public/hello.html 
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight lua&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;3.&lt;/span&gt;接下来代码验证：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;span class=&quot;number&quot;&gt;1.&lt;/span&gt;又是拦截所有请求，那多个拦截所有请求，咋办…&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  + &lt;span class=&quot;built_in&quot;&gt;next&lt;/span&gt;()几个！？&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;span class=&quot;number&quot;&gt;2.&lt;/span&gt;目录路径，推荐写绝对路径，引入&lt;span class=&quot;built_in&quot;&gt;path&lt;/span&gt;；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;```js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;const &lt;span class=&quot;built_in&quot;&gt;path&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;path&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;let static_url = &lt;span class=&quot;built_in&quot;&gt;path&lt;/span&gt;.join(__dirname, &lt;span class=&quot;string&quot;&gt;&amp;#x27;public&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;app.use(express.static(static_url));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;


</code></pre></li>
</ul>
<ul>
<li>3.还可以指定虚拟路径；</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">3000</span><span class="regexp">/static/im</span>ages/kitten.jpg</span><br><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">3000</span><span class="regexp">/static/</span>css/style.css</span><br><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">3000</span><span class="regexp">/static/</span>js/app.js</span><br><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">3000</span><span class="regexp">/static/im</span>ages/bg.png</span><br><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">3000</span><span class="regexp">/static/</span>hello.html</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入body-parser模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> static_url = path.join(__dirname, <span class="string">&#x27;public&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/static&#x27;</span>, express.static(static_url));</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="7-express-art-template模板引擎"><a href="#7-express-art-template模板引擎" class="headerlink" title="7. express-art-template模板引擎"></a>7. express-art-template模板引擎</h3><p>1.在express使用模板引擎是怎样的？</p>
<p>2.为了使art-template模板引擎能够更好的和Express框架配合，模板引擎官方在原art-template模板引擎的基础上封装了express-art-template。</p>
<ul>
<li>使用npm install art-template express-art-template命令进行安装。</li>
<li>1.模板语法一样，模板配置有些变化</li>
</ul>
<p>3.<code>app.engine(&#39;art&#39;, require(&#39;express-art-template&#39;));</code></p>
<ul>
<li>1.告诉express框架，你使用的模板引擎是什么；什么时候使用（第一个参数）</li>
<li>engine：引擎；</li>
</ul>
<p>3.1 告诉模板文件的地方：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 设置模板存放目录</span></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, path.join(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>app.set很有多效果；是用来配置express的</li>
<li>1.第一个参数，是配置什么，配置模板的关键字 就是 views；</li>
<li>2.第二个参数，是模板的位置信息；推荐写绝对路径；</li>
<li></li>
</ul>
<p>3.2 设置模板后缀</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 渲染模板时不写后缀 默认拼接art后缀</span></span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;art&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>1.express可以同时使用多个模板引擎；</li>
<li>2.配置模板后缀的关键字：view engine</li>
<li>3.当写了这个关键字后，第二个参数，就是后缀名了；</li>
</ul>
<p>3.3 写这些的好处是什么？</p>
<ul>
<li>1.为了使用res.render[^16]</li>
<li>2.是res，是响应下的方法；</li>
<li>3.在方法内部，做了很多事情；<ul>
<li>1.里面写模板名称。</li>
<li>2.自动拼接，模板路径，模板后缀，模板文件使用哪个模板引擎；这些不都是自己先set了吗？</li>
<li>3.然后把拼接好的结果响应给客户端</li>
</ul>
</li>
<li>4.还有第二个参数，就是向模板中传入的数据；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 当渲染后缀为art的模板时 使用express-art-template</span></span><br><span class="line">app.engine(<span class="string">&#x27;art&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>));</span><br><span class="line"> <span class="comment">// 设置模板存放目录</span></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, path.join(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line"> <span class="comment">// 渲染模板时不写后缀 默认拼接art后缀</span></span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;art&#x27;</span>);</span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    res.render(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>



<p>4.代码验证：</p>
<p>4.1 需要创建views文件夹，和.art文件</p>
<ul>
<li><code>&#123;&#123; msg &#125;&#125;</code>art文件里面写一个这个就可以了；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入body-parser模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当渲染后缀为art的模板时 使用express-art-template</span></span><br><span class="line">app.engine(<span class="string">&#x27;art&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>));</span><br><span class="line"><span class="comment">// 设置模板存放目录</span></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, path.join(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line"><span class="comment">// 渲染模板时不写后缀 默认拼接art后缀</span></span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;art&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    res.render(<span class="string">&#x27;index&#x27;</span>, &#123;</span><br><span class="line">        msg: <span class="string">&#x27;index&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/list&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    res.render(<span class="string">&#x27;list&#x27;</span>, &#123;</span><br><span class="line">        msg: <span class="string">&#x27;list&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 不需要res.send了！</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>







<h3 id="8-app-locals-对象"><a href="#8-app-locals-对象" class="headerlink" title="8. app.locals 对象"></a>8. app.locals 对象</h3><p>1.将变量设置到app.locals对象下面，这个数据在所有的模板中都可以获取到。</p>
<ul>
<li>1.不用每次在调用模板后面写数据对象了！ye！</li>
<li>2021-4-29 11:15:28</li>
</ul>
<p>1.1 不过这里，只能写公共数据，特定的还是要在自己那里写；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> app.locals.users = [&#123;</span><br><span class="line">     name: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">     age: <span class="number">20</span></span><br><span class="line"> &#125;,&#123;</span><br><span class="line">     name: <span class="string">&#x27;李四&#x27;</span>,</span><br><span class="line">     age: <span class="number">20</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>



<p>2.代码验证：</p>
<p>2.1 app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入body-parser模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当渲染后缀为art的模板时 使用express-art-template</span></span><br><span class="line">app.engine(<span class="string">&#x27;art&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>));</span><br><span class="line"><span class="comment">// 设置模板存放目录</span></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, path.join(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line"><span class="comment">// 渲染模板时不写后缀 默认拼接art后缀</span></span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;art&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.locals.users = [&#123;</span><br><span class="line">    name: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    age: <span class="number">20</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    name: <span class="string">&#x27;李四&#x27;</span>,</span><br><span class="line">    age: <span class="number">20</span></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    res.render(<span class="string">&#x27;index&#x27;</span>, &#123;</span><br><span class="line">        msg: <span class="string">&#x27;index&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/list&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    res.render(<span class="string">&#x27;list&#x27;</span>, &#123;</span><br><span class="line">        msg: <span class="string">&#x27;list&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 不需要res.send了！</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;网站服务器启动成功&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>2.2 art</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; msg &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;&#123;each users&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;$value.age&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2.3 地址：<a target="_blank" rel="noopener" href="http://localhost:3000/list">http://localhost:3000/list</a></p>
<ul>
<li>有效；</li>
</ul>
<p>下一个文件15.2</p>
<h1 id="X-题注"><a href="#X-题注" class="headerlink" title="X. 题注"></a>X. 题注</h1><p>[^1]:template英 [ˈtempleɪt]   美 [ˈtemplət]  n.样板;模板;型板;模框;标准</p>
<p>[^2]:views 英 [vjuːz]   美 [vjuːz]  <br>n.(个人的)看法，意见，见解;态度;(理解或思维的)方法，方式;观看;看;视野;视域;视线<br>v.把…视为;以…看待;看;观看;(尤指)仔细察看;查看，察看(房子等，以便购买或租用)<br>view的第三人称单数和复数</p>
<p>[^3]:each英 [iːtʃ]   美 [iːtʃ]  det./pron.(两个或两个以上的人或物中)各自，各个，每个</p>
<p>[^4]:target 英 [ˈtɑːɡɪt]   美 [ˈtɑːrɡɪt]  n.目标;指标;(攻击的)目标，对象;靶;靶子v.把…作为攻击目标;把…作为批评的对象;面向，把…对准(某群体)</p>
<p>[^5]:layout 英 [ˈleɪaʊt]   美 [ˈleɪaʊt]  n.布局;布置;设计;安排<br>[^6]:defaults英 [dɪˈfɔːlts]   美 [dɪˈfɔːlts]  v.违约;不履行义务(尤指不偿还债务);默认;预设;预置default的第三人称单数<br>[^7]:format英 [ˈfɔːmæt]   美 [ˈfɔːrmæt]  n.总体安排;计划;设计;(出版物的)版式，开本;格式v.格式化;安排…的版式</p>
<p>[^8]:router英 [ˈruːtə(r) , ˈraʊtə(r)]  美 [ˈruːtər , ˈraʊtər]  n.路由器(传送信息的专用网络设备)n.槽刨</p>
<p>[^9]:send英 [send]   美 [send]  v.邮寄;发送;传达;转致;告知;派遣;打发;安排去<br>[^10]:status英 [ˈsteɪtəs]   美 [ˈsteɪtəs]  n.状态;地位;身份;职位;高级职位;社会上层地位<br>[^11]:try 英 [traɪ]   美 [traɪ]  v.试图;想要;设法;努力;试;试用;试做;试验;审理;审讯;审判n.尝试;试图;努力;在对方球门线后带球触地;持球触地得分<br>[^12]:catch 英 [kætʃ]   美 [kætʃ]  v.接住;截住;拦住;接(落下的液体);抓住;握住n.接(球等);总捕获量;扣拴物;扣件<br>[^13]:parser 英 [ˈpɑːzə]   美 [ˈpɑrsər]  解析器;分析器;剖析器;解析;语法分析器<br>[^14]:encoded英 [ɪnˈkəʊdɪd]   美 [ɪnˈkoʊdɪd]  v.把…译成电码(或密码);把…编码;把…译成外语encode的过去分词和过去式<br>[^15]:extended英 <br>[ɪkˈstendɪd]   美 [ɪkˈstendɪd]   <br>adj.延长了的;扩展了的 <br>v.使伸长;扩大;扩展;延长;使延期;扩大…的范围(或影响) <br>extend的过去分词和过去式</p>
<p>[^16]:render英 [ˈrendə(r)]   美 [ˈrendər]  v.使成为;使变得;使处于某状态;给予;提供;回报;递交;呈献;提交</p>
<h2 id="末尾"><a href="#末尾" class="headerlink" title="末尾"></a>末尾</h2><p>​    </p>
<p>​    </p>
<p>​</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/node/" rel="tag"># node</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/1-(0~50)/25.5-JS%E6%8F%92%E4%BB%B6/" rel="prev" title="25.5-JS插件">
      <i class="fa fa-chevron-left"></i> 25.5-JS插件
    </a></div>
      <div class="post-nav-item">
    <a href="/1-(0~50)/15.2-nodeJS/" rel="next" title="15.2-node.js">
      15.2-node.js <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qilin</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">759k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">11:30</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    new Valine(Object.assign({
      el  : '#valine-comments',
      path: location.pathname,
    }, {"enable":true,"appId":"l9X7oYVrse5t6umGkFbQyhXs-gzGzoHsz","appKey":"dcwRazDbDakW6HdC3xERrYHu","placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"language":null,"visitor":true,"comment_count":true,"recordIP":true,"serverURLs":null}
    ));
  }, window.Valine);
});
</script>


  
  <script type="text/javascript" onmobile="true" color="0,0,0" opacity='0.7' zIndex="-1" count="120" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  

</body>
</html>
